<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì°¨ ì•ˆì „ ê²½ê³  ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #fa709a 0%, #fee140 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b 0%, #ffa500 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .setting-group {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        .setting-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .setting-group input, .setting-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .map-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        #map {
            height: 400px;
            width: 100%;
        }
        
        .status {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: bold;
            color: #666;
        }
        
        .status-value {
            font-size: 14px;
            color: #333;
        }
        
        .alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff4757 0%, #ff3838 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(255,71,87,0.3);
            z-index: 9999;
            text-align: center;
            animation: alertPulse 1s infinite;
            display: none;
        }
        
        .alert h2 {
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .alert p {
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .alert .btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
        }
        
        @keyframes alertPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }
        
        .train-info {
            background: rgba(255,255,255,0.95);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid #4facfe;
        }
        
        .train-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .train-item:last-child {
            border-bottom: none;
        }
        
        .distance-warning {
            color: #ff4757;
            font-weight: bold;
        }
        
        .distance-safe {
            color: #2ed573;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .settings {
                grid-template-columns: 1fr;
            }
            
            #map {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸšŠ ê¸°ì°¨ ì•ˆì „ ê²½ê³  ì‹œìŠ¤í…œ</h1>
            <p>GPS ì¶”ì  ë˜ëŠ” ìˆ˜ë™ ìœ„ì¹˜ ì„¤ì •ìœ¼ë¡œ ê¸°ì°¨ ê·¼ì ‘ ì‹œ ì•ˆì „ ê²½ê³ ë¥¼ ë°›ìœ¼ì„¸ìš”</p>
        </div>
        
        <div class="controls">
            <div class="button-group">
                <button id="startGpsBtn" class="btn btn-primary">ğŸ“ GPS ì¶”ì  ì‹œì‘</button>
                <button id="stopGpsBtn" class="btn btn-secondary" disabled>â¹ï¸ GPS ì¶”ì  ì¤‘ì§€</button>
                <button id="manualModeBtn" class="btn btn-secondary">ğŸ“ ìˆ˜ë™ ìœ„ì¹˜ ì„¤ì •</button>
                <button id="clearMarkersBtn" class="btn btn-danger">ğŸ—‘ï¸ ë§ˆì»¤ ì§€ìš°ê¸°</button>
            </div>
            
            <div class="settings">
                <div class="setting-group">
                    <label for="alertDistance">ê²½ê³  ê±°ë¦¬ (ë¯¸í„°)</label>
                    <input type="number" id="alertDistance" value="500" min="100" max="2000" step="100">
                </div>
                <div class="setting-group">
                    <label for="updateInterval">ì—…ë°ì´íŠ¸ ê°„ê²© (ì´ˆ)</label>
                    <input type="number" id="updateInterval" value="30" min="10" max="300" step="10">
                </div>
                <div class="setting-group">
                    <label for="alertSound">ê²½ê³ ìŒ</label>
                    <select id="alertSound">
                        <option value="beep">ë¹„í”„ìŒ</option>
                        <option value="siren">ì‚¬ì´ë Œ</option>
                        <option value="bell">ë²¨ì†Œë¦¬</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="vibration">ì§„ë™ ì‚¬ìš©</label>
                    <select id="vibration">
                        <option value="true">ì‚¬ìš©í•¨</option>
                        <option value="false">ì‚¬ìš© ì•ˆí•¨</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
        </div>
        
        <div class="status">
            <h3>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h3>
            <div class="status-item">
                <span class="status-label">í˜„ì¬ ëª¨ë“œ:</span>
                <span id="currentMode" class="status-value">ëŒ€ê¸° ì¤‘</span>
            </div>
            <div class="status-item">
                <span class="status-label">GPS ìƒíƒœ:</span>
                <span id="gpsStatus" class="status-value">ë¹„í™œì„±</span>
            </div>
            <div class="status-item">
                <span class="status-label">í˜„ì¬ ìœ„ì¹˜:</span>
                <span id="currentPosition" class="status-value">ìœ„ì¹˜ ì •ë³´ ì—†ìŒ</span>
            </div>
            <div class="status-item">
                <span class="status-label">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</span>
                <span id="lastUpdate" class="status-value">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">ê·¼ì²˜ ê¸°ì°¨ ìˆ˜:</span>
                <span id="nearbyTrains" class="status-value">0</span>
            </div>
        </div>
        
        <div class="train-info" id="trainInfo" style="display: none;">
            <h4>ğŸšŠ ê·¼ì²˜ ê¸°ì°¨ ì •ë³´</h4>
            <div id="trainList"></div>
        </div>
    </div>
    
    <div id="alertModal" class="alert">
        <h2>âš ï¸ ê¸°ì°¨ ì ‘ê·¼ ê²½ê³ !</h2>
        <p id="alertMessage">ê·¼ì²˜ì— ê¸°ì°¨ê°€ ì ‘ê·¼í•˜ê³  ìˆìŠµë‹ˆë‹¤!</p>
        <button class="btn" onclick="hideAlert()">í™•ì¸</button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let map;
        let currentLocationMarker;
        let manualMarker;
        let gpsWatchId;
        let isGpsActive = false;
        let isManualMode = false;
        let trainMarkers = [];
        let alertAudio;
        let monitoringInterval;
        
        // API í‚¤
        const SEOUL_SUBWAY_API_KEY = '4a4d5943506f73633531764f4d6854';
        const KORAIL_API_KEY = 'b94e2e220ed1c348f7fe613a70da4ac557a1888a5d25f0e6e3d0e91e41ce4618';
        
        // ì„œìš¸ ì§€í•˜ì²  ì—­ ë°ì´í„° (ì£¼ìš” ì—­ë§Œ ìƒ˜í”Œ)
        const seoulSubwayStations = [
            {name: 'ê°•ë‚¨ì—­', line: '2í˜¸ì„ ', lat: 37.4979, lng: 127.0276},
            {name: 'í™ëŒ€ì…êµ¬ì—­', line: '2í˜¸ì„ ', lat: 37.5579, lng: 126.9245},
            {name: 'ì„œìš¸ì—­', line: '1í˜¸ì„ ', lat: 37.5547, lng: 126.9707},
            {name: 'ì¢…ë¡œ3ê°€ì—­', line: '1í˜¸ì„ ', lat: 37.5705, lng: 126.9923},
            {name: 'ëª…ë™ì—­', line: '4í˜¸ì„ ', lat: 37.5632, lng: 126.9854},
            {name: 'ì ì‹¤ì—­', line: '2í˜¸ì„ ', lat: 37.5133, lng: 127.1000},
            {name: 'ì‹ ë¦¼ì—­', line: '2í˜¸ì„ ', lat: 37.4843, lng: 126.9297},
            {name: 'ì‚¬ë‹¹ì—­', line: '2í˜¸ì„ ', lat: 37.4767, lng: 126.9815}
        ];
        
        // ì½”ë ˆì¼ ì£¼ìš”ì—­ ë°ì´í„° (ìƒ˜í”Œ)
        const korailStations = [
            {name: 'ì„œìš¸ì—­', lat: 37.5547, lng: 126.9707},
            {name: 'ìš©ì‚°ì—­', lat: 37.5299, lng: 126.9645},
            {name: 'ì˜ë“±í¬ì—­', lat: 37.5156, lng: 126.9073},
            {name: 'ìˆ˜ì›ì—­', lat: 37.2656, lng: 127.0011},
            {name: 'ëŒ€ì „ì—­', lat: 36.3315, lng: 127.4344}
        ];
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            initEventListeners();
            initAudio();
        });
        
        // ì§€ë„ ì´ˆê¸°í™”
        function initMap() {
            // ì„œìš¸ ì¤‘ì‹¬ìœ¼ë¡œ ì§€ë„ ìƒì„±
            map = L.map('map').setView([37.5665, 126.9780], 12);
            
            // OpenStreetMap íƒ€ì¼ ë ˆì´ì–´ ì¶”ê°€
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);
            
            // ì§€í•˜ì² ì—­ ë§ˆì»¤ ì¶”ê°€
            seoulSubwayStations.forEach(station => {
                L.marker([station.lat, station.lng])
                    .addTo(map)
                    .bindPopup(`ğŸš‡ ${station.name} (${station.line})`);
            });
            
            // ì½”ë ˆì¼ì—­ ë§ˆì»¤ ì¶”ê°€
            korailStations.forEach(station => {
                L.marker([station.lat, station.lng])
                    .addTo(map)
                    .bindPopup(`ğŸš„ ${station.name}`);
            });
            
            // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ (ìˆ˜ë™ ëª¨ë“œì—ì„œ ì‚¬ìš©)
            map.on('click', function(e) {
                if (isManualMode) {
                    setManualLocation(e.latlng.lat, e.latlng.lng);
                }
            });
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
        function initEventListeners() {
            document.getElementById('startGpsBtn').addEventListener('click', startGpsTracking);
            document.getElementById('stopGpsBtn').addEventListener('click', stopGpsTracking);
            document.getElementById('manualModeBtn').addEventListener('click', toggleManualMode);
            document.getElementById('clearMarkersBtn').addEventListener('click', clearMarkers);
        }
        
        // ì˜¤ë””ì˜¤ ì´ˆê¸°í™”
        function initAudio() {
            alertAudio = new Audio();
        }
        
        // GPS ì¶”ì  ì‹œì‘
        function startGpsTracking() {
            if (!navigator.geolocation) {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            };
            
            gpsWatchId = navigator.geolocation.watchPosition(
                onLocationUpdate,
                onLocationError,
                options
            );
            
            isGpsActive = true;
            isManualMode = false;
            updateUI();
            startMonitoring();
        }
        
        // GPS ì¶”ì  ì¤‘ì§€
        function stopGpsTracking() {
            if (gpsWatchId) {
                navigator.geolocation.clearWatch(gpsWatchId);
                gpsWatchId = null;
            }
            
            isGpsActive = false;
            updateUI();
            stopMonitoring();
        }
        
        // ìˆ˜ë™ ëª¨ë“œ í† ê¸€
        function toggleManualMode() {
            isManualMode = !isManualMode;
            
            if (isManualMode) {
                stopGpsTracking();
                alert('ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”.');
            } else {
                if (manualMarker) {
                    map.removeLayer(manualMarker);
                    manualMarker = null;
                }
                stopMonitoring();
            }
            
            updateUI();
        }
        
        // ìˆ˜ë™ ìœ„ì¹˜ ì„¤ì •
        function setManualLocation(lat, lng) {
            if (manualMarker) {
                map.removeLayer(manualMarker);
            }
            
            manualMarker = L.marker([lat, lng], {
                icon: L.icon({
                    iconUrl: 'data:image/svg+xml;base64,' + btoa(`
                        <svg width="25" height="25" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12.5" cy="12.5" r="10" fill="#ff4757" stroke="#fff" stroke-width="2"/>
                            <text x="12.5" y="17" text-anchor="middle" fill="white" font-size="12">ğŸ“</text>
                        </svg>
                    `),
                    iconSize: [25, 25],
                    iconAnchor: [12.5, 12.5]
                })
            }).addTo(map);
            
            manualMarker.bindPopup('ğŸƒ í˜„ì¬ ì„¤ì •ëœ ìœ„ì¹˜').openPopup();
            
            // ìœ„ì¹˜ ì •ë³´ ì—…ë°ì´íŠ¸
            updateCurrentPosition(lat, lng);
            startMonitoring();
        }
        
        // ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ì½œë°±
        function onLocationUpdate(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            
            updateCurrentPosition(lat, lng);
            
            // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì—…ë°ì´íŠ¸
            if (currentLocationMarker) {
                map.removeLayer(currentLocationMarker);
            }
            
            currentLocationMarker = L.marker([lat, lng], {
                icon: L.icon({
                    iconUrl: 'data:image/svg+xml;base64,' + btoa(`
                        <svg width="25" height="25" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12.5" cy="12.5" r="10" fill="#4facfe" stroke="#fff" stroke-width="2"/>
                            <text x="12.5" y="17" text-anchor="middle" fill="white" font-size="12">ğŸ“</text>
                        </svg>
                    `),
                    iconSize: [25, 25],
                    iconAnchor: [12.5, 12.5]
                })
            }).addTo(map);
            
            currentLocationMarker.bindPopup('ğŸƒ í˜„ì¬ ìœ„ì¹˜').openPopup();
            
            // ì§€ë„ ì¤‘ì‹¬ì„ í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™
            map.setView([lat, lng], 14);
        }
        
        // ìœ„ì¹˜ ì—ëŸ¬ ì½œë°±
        function onLocationError(error) {
            let message = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message += 'ìœ„ì¹˜ ì ‘ê·¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    message += 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    break;
                case error.TIMEOUT:
                    message += 'ìœ„ì¹˜ ìš”ì²­ì´ ì‹œê°„ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    break;
                default:
                    message += 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    break;
            }
            
            alert(message);
            document.getElementById('gpsStatus').textContent = 'ì˜¤ë¥˜';
        }
        
        // í˜„ì¬ ìœ„ì¹˜ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateCurrentPosition(lat, lng) {
            document.getElementById('currentPosition').textContent = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
        }
        
        // ëª¨ë‹ˆí„°ë§ ì‹œì‘
        function startMonitoring() {
            const interval = document.getElementById('updateInterval').value * 1000;
            
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
            }
            
            monitoringInterval = setInterval(() => {
                checkTrainProximity();
            }, interval);
            
            // ì¦‰ì‹œ í•œ ë²ˆ ì²´í¬
            checkTrainProximity();
        }
        
        // ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
        function stopMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
        }
        
        // ê¸°ì°¨ ê·¼ì ‘ë„ ì²´í¬
        async function checkTrainProximity() {
            let currentLat, currentLng;
            
            // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
            if (isGpsActive && currentLocationMarker) {
                const pos = currentLocationMarker.getLatLng();
                currentLat = pos.lat;
                currentLng = pos.lng;
            } else if (isManualMode && manualMarker) {
                const pos = manualMarker.getLatLng();
                currentLat = pos.lat;
                currentLng = pos.lng;
            } else {
                return;
            }
            
            const alertDistance = parseInt(document.getElementById('alertDistance').value);
            let nearbyTrainCount = 0;
            const nearbyTrains = [];
            
            // ì§€í•˜ì² ì—­ê³¼ì˜ ê±°ë¦¬ ì²´í¬
            seoulSubwayStations.forEach(station => {
                const distance = calculateDistance(currentLat, currentLng, station.lat, station.lng);
                
                if (distance <= alertDistance) {
                    nearbyTrainCount++;
                    nearbyTrains.push({
                        name: station.name,
                        line: station.line,
                        distance: Math.round(distance),
                        type: 'ì§€í•˜ì² '
                    });
                }
            });
            
            // ì½”ë ˆì¼ì—­ê³¼ì˜ ê±°ë¦¬ ì²´í¬
            korailStations.forEach(station => {
                const distance = calculateDistance(currentLat, currentLng, station.lat, station.lng);
                
                if (distance <= alertDistance) {
                    nearbyTrainCount++;
                    nearbyTrains.push({
                        name: station.name,
                        distance: Math.round(distance),
                        type: 'ì¼ë°˜ì² ë„'
                    });
                }
            });
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('nearbyTrains').textContent = nearbyTrainCount;
            
            if (nearbyTrains.length > 0) {
                showTrainInfo(nearbyTrains);
                
                // ê²½ê³  ë°œìƒ
                if (nearbyTrains.some(train => train.distance <= alertDistance / 2)) {
                    triggerAlert(`${nearbyTrains[0].name}ê¹Œì§€ ${nearbyTrains[0].distance}m`);
                }
            } else {
                hideTrainInfo();
            }
            
            // ì‹¤ì œ API í˜¸ì¶œ (ë°ëª¨ìš©ìœ¼ë¡œ ì£¼ì„ ì²˜ë¦¬)
            // await fetchSeoulSubwayData();
            // await fetchKorailData();
        }
        
        // ê±°ë¦¬ ê³„ì‚° (í•˜ë²„ì‚¬ì¸ ê³µì‹)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
            const Ï†1 = lat1 * Math.PI/180;
            const Ï†2 = lat2 * Math.PI/180;
            const Î”Ï† = (lat2-lat1) * Math.PI/180;
            const Î”Î» = (lng2-lng1) * Math.PI/180;
            
            const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
                    Math.cos(Ï†1) * Math.cos(Ï†2) *
                    Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            
            return R * c;
        }
        
        // ê²½ê³  ë°œìƒ
        function triggerAlert(message) {
            document.getElementById('alertMessage').textContent = message;
            document.getElementById('alertModal').style.display = 'block';
            
            // ì§„ë™
            if (document.getElementById('vibration').value === 'true' && 'vibrate' in navigator) {
                navigator.vibrate([500, 200, 500, 200, 500]);
            }
            
            // ì†Œë¦¬
            playAlertSound();
        }
        
        // ê²½ê³  ì†Œë¦¬ ì¬ìƒ
        function playAlertSound() {
            const soundType = document.getElementById('alertSound').value;
            let frequency = 800;
            let duration = 500;
            
            switch(soundType) {
                case 'siren':
                    frequency = 1000;
                    duration = 1000;
                    break;
                case 'bell':
                    frequency = 600;
                    duration = 800;
                    break;
                default: // beep
                    frequency = 800;
                    duration = 500;
            }
            
            // Web Audio APIë¥¼ ì‚¬ìš©í•œ ì†Œë¦¬ ìƒì„±
            if (typeof(AudioContext) !== "undefined" || typeof(webkitAudioContext) !== "undefined") {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration/1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration/1000);
            }
        }
        
        // ê²½ê³  ìˆ¨ê¸°ê¸°
        function hideAlert() {
            document.getElementById('alertModal').style.display = 'none';
        }
        
        // ê¸°ì°¨ ì •ë³´ í‘œì‹œ
        function showTrainInfo(trains) {
            const trainInfo = document.getElementById('trainInfo');
            const trainList = document.getElementById('trainList');
            
            trainList.innerHTML = '';
            
            trains.forEach(train => {
                const trainItem = document.createElement('div');
                trainItem.className = 'train-item';
                
                const distanceClass = train.distance <= 200 ? 'distance-warning' : 'distance-safe';
                
                trainItem.innerHTML = `
                    <div>
                        <strong>${train.name}</strong>
                        ${train.line ? `<span>(${train.line})</span>` : ''}
                        <small>[${train.type}]</small>
                    </div>
                    <div class="${distanceClass}">${train.distance}m</div>
                `;
                
                trainList.appendChild(trainItem);
            });
            
            trainInfo.style.display = 'block';
        }
        
        // ê¸°ì°¨ ì •ë³´ ìˆ¨ê¸°ê¸°
        function hideTrainInfo() {
            document.getElementById('trainInfo').style.display = 'none';
        }
        
        // ë§ˆì»¤ ì§€ìš°ê¸°
        function clearMarkers() {
            if (currentLocationMarker) {
                map.removeLayer(currentLocationMarker);
                currentLocationMarker = null;
            }
            
            if (manualMarker) {
                map.removeLayer(manualMarker);
                manualMarker = null;
            }
            
            trainMarkers.forEach(marker => {
                map.removeLayer(marker);
            });
            trainMarkers = [];
            
            stopGpsTracking();
            isManualMode = false;
            updateUI();
        }
        
        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            const startBtn = document.getElementById('startGpsBtn');
            const stopBtn = document.getElementById('stopGpsBtn');
            const manualBtn = document.getElementById('manualModeBtn');
            const currentMode = document.getElementById('currentMode');
            const gpsStatus = document.getElementById('gpsStatus');
            
            if (isGpsActive) {
                startBtn.disabled = true;
                stopBtn.disabled = false;
                manualBtn.disabled = true;
                currentMode.textContent = 'GPS ìë™ ì¶”ì ';
                gpsStatus.textContent = 'í™œì„±';
                gpsStatus.style.color = '#2ed573';
            } else if (isManualMode) {
                startBtn.disabled = true;
                stopBtn.disabled = true;
                manualBtn.disabled = false;
                manualBtn.textContent = 'ğŸƒ ìˆ˜ë™ ëª¨ë“œ (í™œì„±)';
                currentMode.textContent = 'ìˆ˜ë™ ìœ„ì¹˜ ì„¤ì •';
                gpsStatus.textContent = 'ë¹„í™œì„±';
                gpsStatus.style.color = '#ff6b6b';
            } else {
                startBtn.disabled = false;
                stopBtn.disabled = true;
                manualBtn.disabled = false;
                manualBtn.textContent = 'ğŸ“ ìˆ˜ë™ ìœ„ì¹˜ ì„¤ì •';
                currentMode.textContent = 'ëŒ€ê¸° ì¤‘';
                gpsStatus.textContent = 'ë¹„í™œì„±';
                gpsStatus.style.color = '#ff6b6b';
            }
        }
        
        // ì„œìš¸ì‹œ ì§€í•˜ì²  API í˜¸ì¶œ (ì‹¤ì œ êµ¬í˜„)
        async function fetchSeoulSubwayData() {
            try {
                const response = await fetch(`http://swopenAPI.seoul.go.kr/api/subway/${SEOUL_SUBWAY_API_KEY}/json/realtimeStationArrival/0/100/`);
                const data = await response.json();
                
                // API ë°ì´í„° ì²˜ë¦¬ ë¡œì§
                console.log('ì„œìš¸ì‹œ ì§€í•˜ì²  ë°ì´í„°:', data);
                
            } catch (error) {
                console.error('ì„œìš¸ì‹œ ì§€í•˜ì²  API ì˜¤ë¥˜:', error);
            }
        }
        
        // ì½”ë ˆì¼ API í˜¸ì¶œ (ì‹¤ì œ êµ¬í˜„)
        async function fetchKorailData() {
            try {
                const response = await fetch(`http://apis.data.go.kr/B551457/run/v2/routeWithWay?serviceKey=${KORAIL_API_KEY}&numOfRows=100&pageNo=1&_type=json`);
                const data = await response.json();
                
                // API ë°ì´í„° ì²˜ë¦¬ ë¡œì§
                console.log('ì½”ë ˆì¼ ë°ì´í„°:', data);
                
            } catch (error) {
                console.error('ì½”ë ˆì¼ API ì˜¤ë¥˜:', error);
            }
        }
    </script>
</body>
</html>
