<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì°¨ ì•ˆì „ ê²½ê³  ì‹œìŠ¤í…œ</title>
    
    <!-- HTTPS í•„ìˆ˜ ì•Œë¦¼ -->
    <meta name="description" content="GPS ê¸°ë°˜ ê¸°ì°¨ ì•ˆì „ ê²½ê³  ì‹œìŠ¤í…œ - HTTPS í™˜ê²½ í•„ìš”">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            border-radius: 15px;
            color: white;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .https-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .https-warning.show {
            display: block;
        }

        .https-warning.hide {
            display: none;
        }

        .mode-selector {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 4px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .status-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-indicator {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .status-safe {
            background: #4caf50;
        }

        .status-warning {
            background: #ff9800;
            animation: pulse 1.5s infinite;
        }

        .status-danger {
            background: #f44336;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .control-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        #map {
            width: 100%;
            height: 300px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .info-panel {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-panel h3 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .warning-message {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
            display: none;
            position: sticky;
            top: 10px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .warning-message.show {
            display: block;
            animation: shake 0.5s ease-in-out, persistentGlow 2s infinite;
        }

        @keyframes persistentGlow {
            0%, 100% { 
                box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
                border-color: #ffc107;
            }
            50% { 
                box-shadow: 0 4px 20px rgba(255, 87, 34, 0.5);
                border-color: #ff5722;
            }
        }

        .warning-header {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .warning-time {
            font-size: 12px;
            opacity: 0.8;
            font-weight: normal;
        }

        .train-item.urgent {
            animation: urgentPulse 1s infinite;
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
        }

        .train-item.warning {
            animation: warningPulse 2s infinite;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.2);
        }

        @keyframes urgentPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes warningPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .distance-input, select.distance-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            background: white;
            color: #333;
        }

        select.distance-input {
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23666" d="m0 1 2 2 2-2z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
        }

        .train-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .train-item {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
            font-size: 14px;
        }

        .train-item.subway {
            border-left-color: #2196f3;
        }

        .train-item.korail {
            border-left-color: #ff5722;
        }

        .train-item .train-line {
            font-weight: bold;
            color: #333;
        }

        .train-item .train-info {
            color: #666;
            margin-top: 5px;
        }

        .train-item .train-distance {
            color: #ff6b6b;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error-message {
            background: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #c62828;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
            border-top: 1px solid #e9ecef;
            margin-top: 30px;
        }

        .nearby-stations {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
        }

        .station-item {
            background: white;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 5px;
            font-size: 13px;
            border-left: 3px solid #4caf50;
        }

        .gps-debug {
            background: #e1f5fe;
            border: 1px solid #b3e5fc;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #01579b;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš† ê¸°ì°¨ ì ‘ê·¼ ì•Œë¦¼ v1.2</h1>
            <p>GPS ê¸°ë°˜ ì‹¤ì‹œê°„ ì•ˆì „ ëª¨ë‹ˆí„°ë§</p>
        </div>

        <!-- HTTPS ê²½ê³  -->
        <div id="https-warning" class="https-warning">
            <strong>âš ï¸ ì¤‘ìš”!</strong><br>
            GPS ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ <strong>HTTPS í™˜ê²½</strong>ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>
            <small>GitHub Pagesì— ë°°í¬í•˜ë©´ ìë™ìœ¼ë¡œ HTTPSê°€ ì ìš©ë©ë‹ˆë‹¤.</small>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" onclick="switchMode('gps')">GPS ê¸°ë°˜ ê²½ê³ </button>
            <button class="mode-btn" onclick="switchMode('manual')">ìˆ˜ë™ ìœ„ì¹˜ ì„ íƒ</button>
        </div>

        <!-- GPS ê¸°ë°˜ ëª¨ë“œ -->
        <div id="gps-mode" class="content-section active">
            <div class="status-card">
                <div id="gps-status-indicator" class="status-indicator status-safe">ğŸ“</div>
                <h3 id="gps-status-text">GPS ìœ„ì¹˜ í™•ì¸ ì¤‘...</h3>
                <p id="gps-location-text">ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤</p>
            </div>

            <!-- GPS ë””ë²„ê·¸ ì •ë³´ -->
            <div id="gps-debug" class="gps-debug" style="display:none;">
                <strong>GPS ë””ë²„ê·¸ ì •ë³´:</strong><br>
                <span id="debug-info">í™•ì¸ ì¤‘...</span>
            </div>

            <div class="control-panel">
                <button id="start-monitoring" class="button btn-primary">ëª¨ë‹ˆí„°ë§ ì‹œì‘</button>
                <button id="stop-monitoring" class="button btn-danger" style="display:none;">ëª¨ë‹ˆí„°ë§ ì¤‘ì§€</button>
                <button id="retry-gps" class="button btn-secondary" style="display:none;">GPS ì¬ì‹œë„</button>
                
                <div style="margin-top: 15px;">
                    <label for="alert-distance">ê²½ê³  ê±°ë¦¬ (ë¯¸í„°):</label>
                    <input type="number" id="alert-distance" class="distance-input" value="500" min="100" max="2000">
                    
                    <label for="update-interval">ê°±ì‹  ì£¼ê¸°:</label>
                    <select id="update-interval" class="distance-input" style="height: 50px;">
                        <option value="5000">âš¡ 5ì´ˆ (ê³ ì„±ëŠ¥)</option>
                        <option value="10000">ğŸ”¥ 10ì´ˆ (ë¹ ë¦„)</option>
                        <option value="20000">âš–ï¸ 20ì´ˆ (ê· í˜•)</option>
                        <option value="30000" selected>ğŸ”‹ 30ì´ˆ (ì ˆì•½)</option>
                        <option value="60000">ğŸ’¤ 60ì´ˆ (ì €ì „ë ¥)</option>
                    </select>
                </div>
            </div>

            <div id="gps-warning" class="warning-message">
                <!-- JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ë‚´ìš© ìƒì„± -->
            </div>

            <div class="info-panel">
                <h3>ğŸ“Š ëª¨ë‹ˆí„°ë§ ì •ë³´</h3>
                <div class="info-item">
                    <span>ìƒíƒœ:</span>
                    <span id="monitoring-status">ëŒ€ê¸° ì¤‘</span>
                </div>
                <div class="info-item">
                    <span>ê²½ê³  ìƒíƒœ:</span>
                    <span id="warning-status">ì•ˆì „</span>
                </div>
                <div class="info-item">
                    <span>ê°±ì‹  ì£¼ê¸°:</span>
                    <span id="current-interval">30ì´ˆ</span>
                </div>
                <div class="info-item">
                    <span>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</span>
                    <span id="last-update">-</span>
                </div>
                <div class="info-item">
                    <span>ê·¼ì²˜ ì—­ ìˆ˜:</span>
                    <span id="nearby-stations-count">0</span>
                </div>
                <div class="info-item">
                    <span>ê°ì§€ëœ ì² ë„ ë…¸ì„ :</span>
                    <span id="detected-lines">0ê°œ</span>
                </div>
            </div>

            <div id="nearby-stations" class="nearby-stations" style="display:none;">
                <h4>ğŸ” ê·¼ì²˜ ì§€í•˜ì² ì—­</h4>
                <div id="stations-list"></div>
            </div>
        </div>

        <!-- ìˆ˜ë™ ì„ íƒ ëª¨ë“œ -->
        <div id="manual-mode" class="content-section">
            <div class="status-card">
                <div id="manual-status-indicator" class="status-indicator status-safe">ğŸ“</div>
                <h3 id="manual-status-text">ìœ„ì¹˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                <p>ì§€ë„ì—ì„œ ëª¨ë‹ˆí„°ë§í•  ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ì„¸ìš”</p>
            </div>

            <div id="map"></div>

            <div class="control-panel">
                <button id="start-manual-monitoring" class="button btn-primary" disabled>ì„ íƒí•œ ìœ„ì¹˜ ëª¨ë‹ˆí„°ë§</button>
                <button id="stop-manual-monitoring" class="button btn-danger" style="display:none;">ëª¨ë‹ˆí„°ë§ ì¤‘ì§€</button>
                
                <div style="margin-top: 15px;">
                    <label for="manual-alert-distance">ê²½ê³  ê±°ë¦¬ (ë¯¸í„°):</label>
                    <input type="number" id="manual-alert-distance" class="distance-input" value="500" min="100" max="2000">
                    
                    <label for="manual-update-interval">ê°±ì‹  ì£¼ê¸°:</label>
                    <select id="manual-update-interval" class="distance-input" style="height: 50px;">
                        <option value="5000">âš¡ 5ì´ˆ (ê³ ì„±ëŠ¥)</option>
                        <option value="10000">ğŸ”¥ 10ì´ˆ (ë¹ ë¦„)</option>
                        <option value="20000">âš–ï¸ 20ì´ˆ (ê· í˜•)</option>
                        <option value="30000" selected>ğŸ”‹ 30ì´ˆ (ì ˆì•½)</option>
                        <option value="60000">ğŸ’¤ 60ì´ˆ (ì €ì „ë ¥)</option>
                    </select>
                </div>
            </div>

            <div id="manual-warning" class="warning-message">
                <!-- JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ë‚´ìš© ìƒì„± -->
            </div>

            <div class="info-panel">
                <h3>ğŸ“Š ëª¨ë‹ˆí„°ë§ ì •ë³´</h3>
                <div class="info-item">
                    <span>ìƒíƒœ:</span>
                    <span id="manual-monitoring-status">ëŒ€ê¸° ì¤‘</span>
                </div>
                <div class="info-item">
                    <span>ê²½ê³  ìƒíƒœ:</span>
                    <span id="manual-warning-status">ì•ˆì „</span>
                </div>
                <div class="info-item">
                    <span>ê°±ì‹  ì£¼ê¸°:</span>
                    <span id="manual-current-interval">30ì´ˆ</span>
                </div>
                <div class="info-item">
                    <span>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</span>
                    <span id="manual-last-update">-</span>
                </div>
                <div class="info-item">
                    <span>ê·¼ì²˜ ì—­ ìˆ˜:</span>
                    <span id="manual-nearby-stations-count">0</span>
                </div>
                <div class="info-item">
                    <span>ê°ì§€ëœ ì² ë„ ë…¸ì„ :</span>
                    <span id="manual-detected-lines">0ê°œ</span>
                </div>
            </div>

            <div class="info-panel">
                <h3>ğŸ“ ì„ íƒí•œ ìœ„ì¹˜</h3>
                <div class="info-item">
                    <span>ìœ„ë„:</span>
                    <span id="selected-lat">-</span>
                </div>
                <div class="info-item">
                    <span>ê²½ë„:</span>
                    <span id="selected-lng">-</span>
                </div>
                <div class="info-item">
                    <span>ì£¼ì†Œ:</span>
                    <span id="selected-address">-</span>
                </div>
            </div>
        </div>

        <div class="train-list" id="train-list" style="display:none;">
            <h3>ğŸš† ì‹¤ì‹œê°„ ì—´ì°¨ ì •ë³´</h3>
            <div id="train-items"></div>
        </div>

        <div id="error-display" class="error-message" style="display:none;"></div>

        <div class="footer">
            <p>ì•ˆì „ì„ ìœ„í•œ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•´ì£¼ì„¸ìš”</p>
            <p>Â© 2025 Train Safety Alert System</p>
        </div>
    </div>

    <!-- ì˜¤ë””ì˜¤ ìš”ì†Œ (ì•ŒëŒìŒ) -->
    <audio id="alarm-sound" preload="auto" loop>
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMe" type="audio/wav">
    </audio>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentPosition = null;
        let selectedPosition = null;
        let map = null;
        let marker = null;
        let monitoringInterval = null;
        let isMonitoring = false;
        let alarmSound = null;
        let nearbyStations = [];
        
        // ê²½ê³  ìƒíƒœ ê´€ë¦¬
        let currentWarningState = {
            isActive: false,
            lastWarningTrain: null,
            warningStartTime: null,
            lastUpdateTime: null
        };

        // API í‚¤ë“¤
        const API_KEYS = {
            subway: '4a4d5943506f73633531764f4d6854',
            korail: 'b94e2e220ed1c348f7fe613a70da4ac557a1888a5d25f0e6e3d0e91e41ce4618'
        };

        // ì„œìš¸ ì§€í•˜ì² ì—­ + ì½”ë ˆì¼ ì£¼ìš” ì—­ ë°ì´í„° (ì§€í•˜ì² ì—­ ëŒ€í­ í™•ì¥)
        const TRAIN_STATIONS = [
            // === 1í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ì„œìš¸ì—­', lat: 37.5547, lng: 126.9706, lines: ['1í˜¸ì„ ', 'KTX', 'ê³µí•­ì² ë„'], type: 'both'},
            {name: 'ì¢…ê°', lat: 37.5699, lng: 126.9825, lines: ['1í˜¸ì„ '], type: 'subway'},
            {name: 'ì¢…ë¡œ3ê°€', lat: 37.5714, lng: 126.9910, lines: ['1í˜¸ì„ ', '3í˜¸ì„ ', '5í˜¸ì„ '], type: 'subway'},
            {name: 'ë™ëŒ€ë¬¸', lat: 37.5714, lng: 127.0098, lines: ['1í˜¸ì„ ', '4í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ì„¤ë™', lat: 37.5751, lng: 127.0255, lines: ['1í˜¸ì„ '], type: 'subway'},
            {name: 'ì˜ë“±í¬', lat: 37.5150, lng: 126.9076, lines: ['1í˜¸ì„ '], type: 'subway'},
            {name: 'êµ¬ë¡œ', lat: 37.5033, lng: 126.8817, lines: ['1í˜¸ì„ '], type: 'subway'},
            {name: 'ì¸ì²œ', lat: 37.4436, lng: 126.6434, lines: ['1í˜¸ì„ '], type: 'subway'},
            
            // === 2í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ì‹œì²­', lat: 37.5659, lng: 126.9777, lines: ['1í˜¸ì„ ', '2í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ì§€ë¡œì…êµ¬', lat: 37.5663, lng: 126.9820, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ì§€ë¡œ3ê°€', lat: 37.5660, lng: 126.9911, lines: ['2í˜¸ì„ ', '3í˜¸ì„ '], type: 'subway'},
            {name: 'ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›', lat: 37.5665, lng: 127.0078, lines: ['2í˜¸ì„ ', '4í˜¸ì„ ', '5í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ë‹¹', lat: 37.5662, lng: 127.0177, lines: ['2í˜¸ì„ ', '6í˜¸ì„ '], type: 'subway'},
            {name: 'ì„±ìˆ˜', lat: 37.5448, lng: 127.0557, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ê±´ëŒ€ì…êµ¬', lat: 37.5403, lng: 127.0701, lines: ['2í˜¸ì„ ', '7í˜¸ì„ '], type: 'subway'},
            {name: 'ê°•ë³€', lat: 37.5353, lng: 127.0944, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì ì‹¤ë‚˜ë£¨', lat: 37.5203, lng: 127.1038, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì ì‹¤', lat: 37.5134, lng: 127.1000, lines: ['2í˜¸ì„ ', '8í˜¸ì„ '], type: 'subway'},
            {name: 'ì¢…í•©ìš´ë™ì¥', lat: 37.5109, lng: 127.0732, lines: ['2í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'ì‚¼ì„±', lat: 37.5086, lng: 127.0633, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ ë¦‰', lat: 37.5045, lng: 127.0493, lines: ['2í˜¸ì„ ', 'ë¶„ë‹¹ì„ '], type: 'subway'},
            {name: 'ì—­ì‚¼', lat: 37.4996, lng: 127.0364, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ê°•ë‚¨', lat: 37.4979, lng: 127.0276, lines: ['2í˜¸ì„ ', 'ì‹ ë¶„ë‹¹ì„ '], type: 'subway'},
            {name: 'êµëŒ€', lat: 37.4938, lng: 127.0146, lines: ['2í˜¸ì„ ', '3í˜¸ì„ '], type: 'subway'},
            {name: 'ì„œì´ˆ', lat: 37.4837, lng: 127.0054, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ë°©ë°°', lat: 37.4813, lng: 126.9976, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì‚¬ë‹¹', lat: 37.4767, lng: 126.9814, lines: ['2í˜¸ì„ ', '4í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ë¦¼', lat: 37.4844, lng: 126.9295, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'êµ¬ë¡œë””ì§€í„¸ë‹¨ì§€', lat: 37.4853, lng: 126.9012, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ë„ë¦¼', lat: 37.5089, lng: 126.8912, lines: ['1í˜¸ì„ ', '2í˜¸ì„ '], type: 'subway'},
            {name: 'ë‹¹ì‚°', lat: 37.5344, lng: 126.9024, lines: ['2í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'í•©ì •', lat: 37.5497, lng: 126.9135, lines: ['2í˜¸ì„ ', '6í˜¸ì„ '], type: 'subway'},
            {name: 'í™ëŒ€ì…êµ¬', lat: 37.5574, lng: 126.9233, lines: ['2í˜¸ì„ ', '6í˜¸ì„ ', 'ê³µí•­ì² ë„'], type: 'subway'},
            {name: 'ì‹ ì´Œ', lat: 37.5556, lng: 126.9364, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì´ëŒ€', lat: 37.5563, lng: 126.9464, lines: ['2í˜¸ì„ '], type: 'subway'},
            
            // === 3í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ëŒ€í™”', lat: 37.6585, lng: 126.7670, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ë¶ˆê´‘', lat: 37.6108, lng: 126.9298, lines: ['3í˜¸ì„ ', '6í˜¸ì„ '], type: 'subway'},
            {name: 'ì—°ì‹ ë‚´', lat: 37.6186, lng: 126.9210, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ë…ë¦½ë¬¸', lat: 37.5742, lng: 126.9567, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ê²½ë³µê¶', lat: 37.5759, lng: 126.9732, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ì•ˆêµ­', lat: 37.5760, lng: 126.9852, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ì¶©ë¬´ë¡œ', lat: 37.5614, lng: 126.9936, lines: ['3í˜¸ì„ ', '4í˜¸ì„ '], type: 'subway'},
            {name: 'ë™êµ­ëŒ€ì…êµ¬', lat: 37.5584, lng: 126.9988, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ê³ ì†í„°ë¯¸ë„', lat: 37.5044, lng: 127.0051, lines: ['3í˜¸ì„ ', '7í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'ë‚¨ë¶€í„°ë¯¸ë„', lat: 37.4766, lng: 127.0037, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ì–‘ì¬', lat: 37.4674, lng: 127.0347, lines: ['3í˜¸ì„ '], type: 'subway'},
            
            // === 4í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ëª…ë™', lat: 37.5634, lng: 126.9864, lines: ['4í˜¸ì„ '], type: 'subway'},
            {name: 'íšŒí˜„', lat: 37.5592, lng: 126.9783, lines: ['4í˜¸ì„ '], type: 'subway'},
            {name: 'ì„œìš¸ì—­', lat: 37.5547, lng: 126.9706, lines: ['1í˜¸ì„ ', '4í˜¸ì„ ', 'KTX'], type: 'both'},
            {name: 'ì´ì´Œ', lat: 37.5342, lng: 126.9675, lines: ['4í˜¸ì„ '], type: 'subway'},
            {name: 'ë™ì‘', lat: 37.5020, lng: 126.9788, lines: ['4í˜¸ì„ '], type: 'subway'},
            {name: 'ì´ìˆ˜', lat: 37.4862, lng: 126.9816, lines: ['4í˜¸ì„ '], type: 'subway'},
            
            // === 5í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ê¹€í¬ê³µí•­', lat: 37.5588, lng: 126.8014, lines: ['5í˜¸ì„ ', '9í˜¸ì„ ', 'ê³µí•­ì² ë„'], type: 'subway'},
            {name: 'ì†¡ì •', lat: 37.5616, lng: 126.8134, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ë§ˆê³¡', lat: 37.5608, lng: 126.8250, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ë°œì‚°', lat: 37.5587, lng: 126.8370, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ìš°ì¥ì‚°', lat: 37.5485, lng: 126.8361, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'í™”ê³¡', lat: 37.5413, lng: 126.8396, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ê¹Œì¹˜ì‚°', lat: 37.5312, lng: 126.8469, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ì •', lat: 37.5248, lng: 126.8567, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ëª©ë™', lat: 37.5268, lng: 126.8750, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ì˜¤ëª©êµ', lat: 37.5245, lng: 126.8957, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ì–‘í‰', lat: 37.5345, lng: 126.8905, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ì˜ë“±í¬êµ¬ì²­', lat: 37.5245, lng: 126.8957, lines: ['2í˜¸ì„ ', '5í˜¸ì„ '], type: 'subway'},
            {name: 'ì—¬ì˜ë„', lat: 37.5217, lng: 126.9244, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ë§ˆí¬', lat: 37.5444, lng: 126.9458, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ê³µë•', lat: 37.5443, lng: 126.9490, lines: ['5í˜¸ì„ ', '6í˜¸ì„ '], type: 'subway'},
            {name: 'ì• ì˜¤ê°œ', lat: 37.5515, lng: 126.9565, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ì¶©ì •ë¡œ', lat: 37.5596, lng: 126.9635, lines: ['2í˜¸ì„ ', '5í˜¸ì„ '], type: 'subway'},
            {name: 'ì„œëŒ€ë¬¸', lat: 37.5656, lng: 126.9662, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ê´‘í™”ë¬¸', lat: 37.5715, lng: 126.9769, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›', lat: 37.5665, lng: 127.0078, lines: ['2í˜¸ì„ ', '4í˜¸ì„ ', '5í˜¸ì„ '], type: 'subway'},
            {name: 'ì²­êµ¬', lat: 37.5606, lng: 127.0149, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ì™•ì‹­ë¦¬', lat: 37.5617, lng: 127.0378, lines: ['2í˜¸ì„ ', '5í˜¸ì„ ', 'ë¶„ë‹¹ì„ '], type: 'subway'},
            {name: 'í–‰ë‹¹', lat: 37.5575, lng: 127.0437, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ë‹µì‹­ë¦¬', lat: 37.5664, lng: 127.0588, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ì¥í•œí‰', lat: 37.5613, lng: 127.0644, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'êµ°ì', lat: 37.5571, lng: 127.0792, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ì•„ì°¨ì‚°', lat: 37.5572, lng: 127.1032, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ê´‘ë‚˜ë£¨', lat: 37.5450, lng: 127.1081, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ì²œí˜¸', lat: 37.5387, lng: 127.1238, lines: ['5í˜¸ì„ '], type: 'subway'},
            {name: 'ê°•ë™', lat: 37.5278, lng: 127.1316, lines: ['5í˜¸ì„ '], type: 'subway'},
            
            // === 6í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ì‘ì•”', lat: 37.6016, lng: 126.9136, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ì—­ì´Œ', lat: 37.5889, lng: 126.9273, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ë…ë°”ìœ„', lat: 37.5824, lng: 126.9342, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ì—°ì‹ ë‚´', lat: 37.6186, lng: 126.9210, lines: ['3í˜¸ì„ ', '6í˜¸ì„ '], type: 'subway'},
            {name: 'êµ¬ì‚°', lat: 37.6093, lng: 126.9167, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ìƒˆì ˆ', lat: 37.5931, lng: 126.9251, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ì¦ì‚°', lat: 37.5816, lng: 126.9049, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ë””ì§€í„¸ë¯¸ë””ì–´ì‹œí‹°', lat: 37.5763, lng: 126.9009, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ì›”ë“œì»µê²½ê¸°ì¥', lat: 37.5686, lng: 126.8973, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ë§ˆí¬êµ¬ì²­', lat: 37.5634, lng: 126.9086, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ë§ì›', lat: 37.5555, lng: 126.9105, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ìƒìˆ˜', lat: 37.5479, lng: 126.9222, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ì´íƒœì›', lat: 37.5346, lng: 126.9947, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'í•œê°•ì§„', lat: 37.5320, lng: 127.0051, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ë²„í‹°ê³ ê°œ', lat: 37.5408, lng: 127.0201, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ì•½ìˆ˜', lat: 37.5543, lng: 127.0097, lines: ['3í˜¸ì„ ', '6í˜¸ì„ '], type: 'subway'},
            {name: 'ë™ë¬˜ì•', lat: 37.5713, lng: 127.0153, lines: ['1í˜¸ì„ ', '6í˜¸ì„ '], type: 'subway'},
            {name: 'ì°½ì‹ ', lat: 37.5754, lng: 127.0174, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ë³´ë¬¸', lat: 37.5843, lng: 127.0172, lines: ['6í˜¸ì„ '], type: 'subway'},
            {name: 'ì•ˆì•”', lat: 37.5852, lng: 127.0276, lines: ['6í˜¸ì„ '], type: 'subway'},
            
            // === 7í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ì¥ì•”', lat: 37.6446, lng: 127.0770, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ë„ë´‰ì‚°', lat: 37.6898, lng: 127.0470, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ìˆ˜ë½ì‚°', lat: 37.6479, lng: 127.0774, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ë§ˆë“¤', lat: 37.6353, lng: 127.0593, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ë…¸ì›', lat: 37.6544, lng: 127.0617, lines: ['4í˜¸ì„ ', '7í˜¸ì„ '], type: 'subway'},
            {name: 'ì¤‘ê³„', lat: 37.6412, lng: 127.0734, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'í•˜ê³„', lat: 37.6362, lng: 127.0694, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ê³µë¦‰', lat: 37.6254, lng: 127.0729, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'íƒœë¦‰ì…êµ¬', lat: 37.6178, lng: 127.0754, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ë¨¹ê³¨', lat: 37.6173, lng: 127.0773, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ì¤‘í™”', lat: 37.6100, lng: 127.0778, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ìƒë´‰', lat: 37.5967, lng: 127.0851, lines: ['7í˜¸ì„ ', 'ê²½ì˜ì¤‘ì•™ì„ '], type: 'subway'},
            {name: 'ë©´ëª©', lat: 37.5892, lng: 127.0895, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ì‚¬ê°€ì •', lat: 37.5815, lng: 127.0941, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ìš©ë§ˆì‚°', lat: 37.5743, lng: 127.0988, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ì¤‘ê³¡', lat: 37.5668, lng: 127.0841, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'êµ°ì', lat: 37.5571, lng: 127.0792, lines: ['5í˜¸ì„ ', '7í˜¸ì„ '], type: 'subway'},
            {name: 'ì–´ë¦°ì´ëŒ€ê³µì›', lat: 37.5482, lng: 127.0743, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ì²­ë‹´', lat: 37.5199, lng: 127.0565, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ê°•ë‚¨êµ¬ì²­', lat: 37.5176, lng: 127.0417, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'í•™ë™', lat: 37.5143, lng: 127.0312, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ë…¼í˜„', lat: 37.5104, lng: 127.0227, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ë°˜í¬', lat: 37.4979, lng: 127.0118, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ë‚´ë°©', lat: 37.4918, lng: 126.9967, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ì´ìˆ˜', lat: 37.4866, lng: 126.9816, lines: ['4í˜¸ì„ ', '7í˜¸ì„ '], type: 'subway'},
            {name: 'ë‚¨ì„±', lat: 37.4844, lng: 126.9709, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ìˆ­ì‹¤ëŒ€ì…êµ¬', lat: 37.4964, lng: 126.9575, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ìƒë„', lat: 37.5028, lng: 126.9484, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ì¥ìŠ¹ë°°ê¸°', lat: 37.5100, lng: 126.9366, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ëŒ€ë°©ì‚¼ê±°ë¦¬', lat: 37.4949, lng: 126.9137, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ë³´ë¼ë§¤', lat: 37.4939, lng: 126.9258, lines: ['7í˜¸ì„ '], type: 'subway'},
            {name: 'ëŒ€ë¦¼', lat: 37.4932, lng: 126.8955, lines: ['2í˜¸ì„ ', '7í˜¸ì„ '], type: 'subway'},
            
            // === 8í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ëª¨ë€', lat: 37.2934, lng: 127.1283, lines: ['8í˜¸ì„ '], type: 'subway'},
            {name: 'ë‚¨í•œì‚°ì„±ì…êµ¬', lat: 37.4520, lng: 127.1376, lines: ['8í˜¸ì„ '], type: 'subway'},
            {name: 'ë‹¨ëŒ€ì˜¤ê±°ë¦¬', lat: 37.4607, lng: 127.1282, lines: ['8í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ í¥', lat: 37.4685, lng: 127.1194, lines: ['8í˜¸ì„ '], type: 'subway'},
            {name: 'ìˆ˜ì§„', lat: 37.4849, lng: 127.1019, lines: ['8í˜¸ì„ '], type: 'subway'},
            {name: 'ëª½ì´Œí† ì„±', lat: 37.5053, lng: 127.0972, lines: ['8í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ì´Œ', lat: 37.5051, lng: 127.1059, lines: ['8í˜¸ì„ '], type: 'subway'},
            {name: 'ì†¡íŒŒ', lat: 37.5051, lng: 127.1137, lines: ['8í˜¸ì„ '], type: 'subway'},
            {name: 'ê°€ë½ì‹œì¥', lat: 37.4919, lng: 127.1189, lines: ['8í˜¸ì„ '], type: 'subway'},
            {name: 'ë¬¸ì •', lat: 37.4846, lng: 127.1226, lines: ['8í˜¸ì„ '], type: 'subway'},
            {name: 'ì¥ì§€', lat: 37.4784, lng: 127.1264, lines: ['8í˜¸ì„ '], type: 'subway'},
            
            // === 9í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ê°œí™”', lat: 37.5777, lng: 126.7986, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ê³µí•­ì‹œì¥', lat: 37.5624, lng: 126.8125, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ë°©í™”', lat: 37.5573, lng: 126.8130, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ë§ˆê³¡ë‚˜ë£¨', lat: 37.5660, lng: 126.8252, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì–‘ì²œí–¥êµ', lat: 37.5517, lng: 126.8329, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ê°€ì–‘', lat: 37.5614, lng: 126.8547, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì¦ë¯¸', lat: 37.5580, lng: 126.8642, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ë“±ì´Œ', lat: 37.5504, lng: 126.8606, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì—¼ì°½', lat: 37.5463, lng: 126.8746, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ëª©ë™', lat: 37.5374, lng: 126.8746, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ ìœ ë„', lat: 37.5354, lng: 126.8937, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ë…¸ëŸ‰ì§„', lat: 37.5134, lng: 126.9427, lines: ['1í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'ë…¸ë“¤', lat: 37.5183, lng: 126.9518, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'í‘ì„', lat: 37.5056, lng: 126.9615, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ë™ì‘', lat: 37.5020, lng: 126.9788, lines: ['4í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'êµ¬ë°˜í¬', lat: 37.5048, lng: 127.0047, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ë…¼í˜„', lat: 37.5048, lng: 127.0252, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì–¸ì£¼', lat: 37.5178, lng: 127.0371, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ ì •ë¦‰', lat: 37.5045, lng: 127.0493, lines: ['2í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'ì‚¼ì „', lat: 37.4971, lng: 127.0830, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ì´Œê³ ë¶„', lat: 37.5051, lng: 127.1059, lines: ['8í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ì´Œ', lat: 37.5051, lng: 127.1059, lines: ['8í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'ì†¡íŒŒë‚˜ë£¨', lat: 37.5152, lng: 127.1119, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'í•œì„±ë°±ì œ', lat: 37.5086, lng: 127.1263, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì˜¬ë¦¼í”½ê³µì›', lat: 37.5152, lng: 127.1365, lines: ['5í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'ë‘”ì´Œì˜¤ë¥œ', lat: 37.5267, lng: 127.1366, lines: ['9í˜¸ì„ '], type: 'subway'},
            {name: 'ì¤‘ì•™ë³´í›ˆë³‘ì›', lat: 37.5346, lng: 127.1363, lines: ['9í˜¸ì„ '], type: 'subway'},
            
            // === ì‹ ë¦¼ì„  (ê²½ì „ì² ) ===
            {name: 'ê´€ì•…ì‚°', lat: 37.4656, lng: 126.9515, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name: 'ì„œìš¸ëŒ€ë²¤ì²˜íƒ€ìš´', lat: 37.4699, lng: 126.9472, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name: 'í˜¸ì•”ì‚¬ê±°ë¦¬', lat: 37.4741, lng: 126.9433, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name: 'ì„œë¦¼', lat: 37.4791, lng: 126.9384, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name: 'ì‚°ê¸°ëŒ€', lat: 37.4823, lng: 126.9349, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name: 'ì‹ ë¦¼', lat: 37.4844, lng: 126.9295, lines: ['2í˜¸ì„ ', 'ì‹ ë¦¼ì„ '], type: 'subway'},
            
            // === ìš°ì´ì‹ ì„¤ì„  (ê²½ì „ì² ) ===
            {name: 'ë¶í•œì‚°ìš°ì´', lat: 37.6634, lng: 127.0126, lines: ['ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'ì†”ë°­ê³µì›', lat: 37.6593, lng: 127.0099, lines: ['ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: '4.19ë¯¼ì£¼ë¬˜ì§€', lat: 37.6532, lng: 127.0095, lines: ['ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'ê°€ì˜¤ë¦¬', lat: 37.6460, lng: 127.0115, lines: ['ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'í™”ê³„', lat: 37.6394, lng: 127.0153, lines: ['ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'ì‚¼ì–‘', lat: 37.6307, lng: 127.0196, lines: ['ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'ì‚¼ì–‘ì‚¬ê±°ë¦¬', lat: 37.6265, lng: 127.0218, lines: ['ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'ì†”ìƒ˜', lat: 37.6195, lng: 127.0264, lines: ['ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'ë¶í•œì‚°ë³´êµ­ë¬¸', lat: 37.6138, lng: 127.0307, lines: ['ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'ì •ë¦‰', lat: 37.6061, lng: 127.0366, lines: ['ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'ì„±ì‹ ì—¬ëŒ€ì…êµ¬', lat: 37.5926, lng: 127.0177, lines: ['4í˜¸ì„ ', 'ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'ë³´ë¬¸', lat: 37.5843, lng: 127.0172, lines: ['6í˜¸ì„ ', 'ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            {name: 'ì‹ ì„¤ë™', lat: 37.5751, lng: 127.0255, lines: ['1í˜¸ì„ ', 'ìš°ì´ì‹ ì„¤ì„ '], type: 'subway'},
            
            // === ì½”ë ˆì¼ ì£¼ìš” ì—­ ì¶”ê°€ ===
            {name: 'ìš©ì‚°ì—­', lat: 37.5297, lng: 126.9645, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì²­ëŸ‰ë¦¬ì—­', lat: 37.5806, lng: 127.0472, lines: ['KTX', 'ITX-ì²­ì¶˜', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ìˆ˜ì›ì—­', lat: 37.2663, lng: 127.0011, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸', '1í˜¸ì„ '], type: 'both'},
            {name: 'ëŒ€ì „ì—­', lat: 36.3315, lng: 127.4344, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë™ëŒ€êµ¬ì—­', lat: 35.8790, lng: 128.6286, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë¶€ì‚°ì—­', lat: 35.1155, lng: 129.0422, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ê´‘ì£¼ì†¡ì •ì—­', lat: 35.1401, lng: 126.7935, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸'], type: 'korail'},
            {name: 'ëª©í¬ì—­', lat: 34.7947, lng: 126.3849, lines: ['KTX', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ê°•ë¦‰ì—­', lat: 37.7635, lng: 128.8989, lines: ['KTX'], type: 'korail'},
            {name: 'í¬í•­ì—­', lat: 36.0413, lng: 129.3456, lines: ['ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'}
        ];

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // HTTPS ì²´í¬
            checkHTTPS();
            
            // ì˜¤ë””ì˜¤ ì´ˆê¸°í™”
            alarmSound = document.getElementById('alarm-sound');
            
            // ì§€ë„ ì´ˆê¸°í™”
            initializeMap();
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners();
            
            // GPS ê¶Œí•œ ìš”ì²­
            requestLocationPermission();
        }

        function checkHTTPS() {
            const httpsWarning = document.getElementById('https-warning');
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                httpsWarning.className = 'https-warning show';
                updateDebugInfo('HTTP í™˜ê²½ì—ì„œëŠ” GPS ì ‘ê·¼ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
            } else {
                httpsWarning.className = 'https-warning hide';
            }
        }

        function updateDebugInfo(info) {
            const debugDiv = document.getElementById('gps-debug');
            const debugInfo = document.getElementById('debug-info');
            debugInfo.textContent = info;
            debugDiv.style.display = 'block';
        }

        function setupEventListeners() {
            // GPS ëª¨ë“œ ë²„íŠ¼ë“¤
            document.getElementById('start-monitoring').addEventListener('click', startGPSMonitoring);
            document.getElementById('stop-monitoring').addEventListener('click', stopGPSMonitoring);
            document.getElementById('retry-gps').addEventListener('click', requestLocationPermission);
            
            // ìˆ˜ë™ ëª¨ë“œ ë²„íŠ¼ë“¤
            document.getElementById('start-manual-monitoring').addEventListener('click', startManualMonitoring);
            document.getElementById('stop-manual-monitoring').addEventListener('click', stopManualMonitoring);
            
            // ê°±ì‹  ì£¼ê¸° ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('update-interval').addEventListener('change', function() {
                if (isMonitoring) {
                    // ëª¨ë‹ˆí„°ë§ ì¤‘ì´ë©´ ì¦‰ì‹œ ì¬ì‹œì‘
                    stopGPSMonitoring();
                    setTimeout(() => startGPSMonitoring(), 100);
                }
            });
            
            document.getElementById('manual-update-interval').addEventListener('change', function() {
                if (isMonitoring) {
                    // ëª¨ë‹ˆí„°ë§ ì¤‘ì´ë©´ ì¦‰ì‹œ ì¬ì‹œì‘
                    stopManualMonitoring();
                    setTimeout(() => startManualMonitoring(), 100);
                }
            });
        }

        function switchMode(mode) {
            // í™œì„± ë²„íŠ¼ ë³€ê²½
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ì»¨í…ì¸  ì„¹ì…˜ ë³€ê²½
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            if (mode === 'gps') {
                document.getElementById('gps-mode').classList.add('active');
            } else {
                document.getElementById('manual-mode').classList.add('active');
            }
            
            // ê¸°ì¡´ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
            if (isMonitoring) {
                stopAllMonitoring();
            }
        }

        function initializeMap() {
            // Leaflet ì§€ë„ ì´ˆê¸°í™”
            map = L.map('map').setView([37.5665, 126.9780], 10);

            // OpenStreetMap íƒ€ì¼ ì¶”ê°€
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
            map.on('click', function(e) {
                setSelectedPosition(e.latlng.lat, e.latlng.lng);
            });

            // ê¸°ì°¨ì—­ë“¤ ë§ˆì»¤ ì¶”ê°€
            TRAIN_STATIONS.forEach(station => {
                let markerColor = '#2196F3';
                let markerSize = 8;
                
                if (station.type === 'korail') {
                    markerColor = '#FF5722';
                    markerSize = 10;
                } else if (station.type === 'both') {
                    markerColor = '#9C27B0';
                    markerSize = 12;
                }
                
                const stationMarker = L.marker([station.lat, station.lng])
                    .bindPopup(`<b>${station.name}</b><br>${station.lines.join(', ')}<br><small>(${station.type === 'subway' ? 'ì§€í•˜ì² /ê²½ì „ì² ' : station.type === 'korail' ? 'ì½”ë ˆì¼' : 'ì§€í•˜ì² +ì½”ë ˆì¼'})</small>`)
                    .addTo(map);
                
                // ì—­ íƒ€ì…ë³„ ë‹¤ë¥¸ ì•„ì´ì½˜
                stationMarker.setIcon(L.divIcon({
                    html: `<div style="background:${markerColor};width:${markerSize}px;height:${markerSize}px;border-radius:50%;border:2px solid white;"></div>`,
                    iconSize: [markerSize + 4, markerSize + 4],
                    className: 'train-station-marker'
                }));
            });
        }

        function requestLocationPermission() {
            if (!navigator.geolocation) {
                updateGPSStatus('GPS ë¯¸ì§€ì›', 'ì´ ë¸Œë¼ìš°ì €ëŠ” GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                updateDebugInfo('Geolocation APIê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                document.getElementById('retry-gps').style.display = 'block';
                return;
            }

            document.getElementById('gps-status-text').textContent = 'GPS ê¶Œí•œ ìš”ì²­ ì¤‘...';
            updateDebugInfo('GPS ê¶Œí•œ ìš”ì²­ ì¤‘...');
            
            // GPS ì˜µì…˜ ì„¤ì •
            const options = {
                enableHighAccuracy: true,
                timeout: 15000,  // 15ì´ˆ íƒ€ì„ì•„ì›ƒ
                maximumAge: 300000  // 5ë¶„ê¹Œì§€ ìºì‹œëœ ìœ„ì¹˜ í—ˆìš©
            };

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    currentPosition = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                    
                    updateGPSStatus('ìœ„ì¹˜ í™•ì¸ ì™„ë£Œ', `ìœ„ë„: ${currentPosition.lat.toFixed(6)}, ê²½ë„: ${currentPosition.lng.toFixed(6)}`);
                    updateDebugInfo(`
                        âœ… GPS ì„±ê³µ!<br>
                        ì •í™•ë„: ${Math.round(position.coords.accuracy)}m<br>
                        ì‹œê°„: ${new Date(position.timestamp).toLocaleTimeString()}<br>
                        ê³ ë„: ${position.coords.altitude || 'N/A'}m<br>
                        ì†ë„: ${position.coords.speed || 'N/A'}m/s
                    `);
                    
                    findNearbyStations(currentPosition);
                    document.getElementById('retry-gps').style.display = 'none';
                },
                function(error) {
                    let errorMsg = 'GPS ì˜¤ë¥˜: ';
                    let debugMsg = '';
                    let solution = '';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg += 'ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤';
                            debugMsg = 'PERMISSION_DENIED - ì‚¬ìš©ìê°€ ìœ„ì¹˜ ì ‘ê·¼ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤';
                            solution = `
                                ğŸ“± ëª¨ë°”ì¼ í•´ê²°ë°©ë²•:<br>
                                1. ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ ì™¼ìª½ ìë¬¼ì‡  ì•„ì´ì½˜ í„°ì¹˜<br>
                                2. 'ìœ„ì¹˜' ë˜ëŠ” 'ê¶Œí•œ' ë©”ë‰´ì—ì„œ 'í—ˆìš©'ìœ¼ë¡œ ë³€ê²½<br>
                                3. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í›„ ì¬ì‹œë„<br>
                                4. Chrome: ì„¤ì • > ì‚¬ì´íŠ¸ ì„¤ì • > ìœ„ì¹˜<br>
                                5. Safari: ì„¤ì • > Safari > ìœ„ì¹˜ ì„œë¹„ìŠ¤
                            `;
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg += 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                            debugMsg = 'POSITION_UNAVAILABLE - GPS ì‹ í˜¸ë¥¼ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                            solution = `
                                ğŸ“¡ ìœ„ì¹˜ ì„œë¹„ìŠ¤ í™•ì¸:<br>
                                1. í•¸ë“œí° ì„¤ì • > ê°œì¸ì •ë³´ ë³´í˜¸ > ìœ„ì¹˜ ì„œë¹„ìŠ¤ ON<br>
                                2. ì‹¤ì™¸ì—ì„œ ì‹œë„í•´ë³´ì„¸ìš”<br>
                                3. WiFiì™€ ëª¨ë°”ì¼ ë°ì´í„° ëª¨ë‘ ì¼œì£¼ì„¸ìš”<br>
                                4. ë¹„í–‰ê¸° ëª¨ë“œ ê»ë‹¤ ì¼œë³´ê¸°
                            `;
                            break;
                        case error.TIMEOUT:
                            errorMsg += 'ìœ„ì¹˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤';
                            debugMsg = 'TIMEOUT - 30ì´ˆ ë‚´ì— ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                            solution = `
                                â° ì‹œê°„ ì´ˆê³¼ í•´ê²°:<br>
                                1. ì‹¤ì™¸ë‚˜ ì°½ë¬¸ ê·¼ì²˜ì—ì„œ ì¬ì‹œë„<br>
                                2. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”<br>
                                3. ë‹¤ë¥¸ ë¸Œë¼ìš°ì € ì•± ì‚¬ìš©í•´ë³´ê¸°<br>
                                4. í•¸ë“œí° ì¬ë¶€íŒ…
                            `;
                            break;
                        default:
                            errorMsg += 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤';
                            debugMsg = `UNKNOWN ERROR (${error.code}): ${error.message}`;
                            solution = `
                                ğŸ”§ ì¼ë°˜ì ì¸ í•´ê²°ë°©ë²•:<br>
                                1. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨<br>
                                2. ë‹¤ë¥¸ ë¸Œë¼ìš°ì € ì•± ì‹œë„<br>
                                3. í•¸ë“œí° ì¬ë¶€íŒ…<br>
                                4. ì•„ë˜ 'ìˆ˜ë™ ìœ„ì¹˜ ì„ íƒ' ëª¨ë“œ ì‚¬ìš©
                            `;
                            break;
                    }
                    
                    updateGPSStatus('GPS ì˜¤ë¥˜', errorMsg);
                    updateDebugInfo(debugMsg + '<br><br>' + solution);
                    document.getElementById('retry-gps').style.display = 'block';
                    
                    console.error('GPS Error:', error);
                },
                options
            );
        }

        function updateGPSStatus(status, location) {
            document.getElementById('gps-status-text').textContent = status;
            document.getElementById('gps-location-text').textContent = location;
        }

        function setSelectedPosition(lat, lng) {
            selectedPosition = { lat: lat, lng: lng };
            
            // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
            if (marker) {
                map.removeLayer(marker);
            }
            
            // ìƒˆ ë§ˆì»¤ ì¶”ê°€
            marker = L.marker([lat, lng]).addTo(map);
            marker.bindPopup('ì„ íƒí•œ ìœ„ì¹˜').openPopup();
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('selected-lat').textContent = lat.toFixed(6);
            document.getElementById('selected-lng').textContent = lng.toFixed(6);
            document.getElementById('start-manual-monitoring').disabled = false;
            
            // ì£¼ì†ŒëŠ” ê°„ë‹¨íˆ ì¢Œí‘œë¡œ í‘œì‹œ (Nominatim API ì‚¬ìš© ì‹œ ì—­ì§€ì˜¤ì½”ë”© ê°€ëŠ¥)
            document.getElementById('selected-address').textContent = `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('manual-status-text').textContent = 'ìœ„ì¹˜ ì„ íƒ ì™„ë£Œ';
        }

        function findNearbyStations(position) {
            nearbyStations = TRAIN_STATIONS.filter(station => {
                const distance = calculateDistance(position.lat, position.lng, station.lat, station.lng);
                return distance <= 5000; // 5km ì´ë‚´
            }).map(station => ({
                ...station,
                distance: calculateDistance(position.lat, position.lng, station.lat, station.lng)
            })).sort((a, b) => a.distance - b.distance);

            console.log(`ğŸŸ¢ ê·¼ì²˜ ì—­ ${nearbyStations.length}ê°œ ë°œê²¬:`);
            nearbyStations.slice(0, 10).forEach(station => {
                console.log(`   ${station.type === 'subway' ? 'ğŸš‡' : station.type === 'korail' ? 'ğŸš„' : 'ğŸš†'} ${station.name}: ${Math.round(station.distance)}m`);
            });

            document.getElementById('nearby-stations-count').textContent = nearbyStations.length;
            
            if (nearbyStations.length > 0) {
                displayNearbyStations(nearbyStations.slice(0, 10)); // ìƒìœ„ 10ê°œ í‘œì‹œ
                
                // ì§€í•˜ì² ì—­ê³¼ ì½”ë ˆì¼ì—­ ê°œìˆ˜ ì„¸ê¸°
                const subwayStations = nearbyStations.filter(s => s.type === 'subway' || s.type === 'both').length;
                const korailStations = nearbyStations.filter(s => s.type === 'korail' || s.type === 'both').length;
                
                updateDebugInfo(
                    `ê·¼ì²˜ ì—­: ${nearbyStations.length}ê°œ`, 
                    `ğŸš‡ ì§€í•˜ì² ì—­: ${subwayStations}ê°œ, ğŸš„ ì½”ë ˆì¼ì—­: ${korailStations}ê°œ`
                );
            } else {
                updateDebugInfo('ê·¼ì²˜ì— ì—­ì´ ì—†ìŠµë‹ˆë‹¤ (5km ë°˜ê²½)');
            }
        }

        function getRandomDepartureStation() {
            const stations = [
                'ì„œìš¸', 'ëŒ€ì „', 'ëŒ€êµ¬', 'ë¶€ì‚°', 'ê´‘ì£¼', 'ìš©ì‚°', 'ì²­ëŸ‰ë¦¬', 'ìˆ˜ì›', 'ì¸ì²œ',
                'ê´‘ì–‘', 'í¬í•­', 'ìµì‚°', 'ì¡°ì¹˜ì›', 'ì œì²œ', 'ì˜ì£¼', 'ì•ˆë™' // í™”ë¬¼ê¸°ì°¨ ì£¼ìš” ì¶œë°œì§€ ì¶”ê°€
            ];
            return stations[Math.floor(Math.random() * stations.length)];
        }

        function displayNearbyStations(stations) {
            const nearbyStationsDiv = document.getElementById('nearby-stations');
            const stationsList = document.getElementById('stations-list');
            
            stationsList.innerHTML = '';
            
            stations.forEach(station => {
                const stationDiv = document.createElement('div');
                stationDiv.className = 'station-item';
                
                let typeIcon = 'ğŸš‡';
                if (station.type === 'korail') typeIcon = 'ğŸš„';
                if (station.type === 'both') typeIcon = 'ğŸš†';
                
                stationDiv.innerHTML = `
                    ${typeIcon} <strong>${station.name}</strong> - ${Math.round(station.distance)}m<br>
                    <small>${station.lines.join(', ')}</small>
                `;
                stationsList.appendChild(stationDiv);
            });
            
            nearbyStationsDiv.style.display = 'block';
        }

        // ë””ë²„ê·¸ íŒ¨ë„ í™•ì¥
        function updateDebugInfo(info, extraInfo = '') {
            const debugDiv = document.getElementById('gps-debug');
            const debugInfo = document.getElementById('debug-info');
            const timestamp = new Date().toLocaleTimeString();
            
            debugInfo.innerHTML = `
                <div style="margin-bottom: 5px;"><strong>ğŸ” ${timestamp}</strong></div>
                <div>${info}</div>
                ${extraInfo ? `<div style="margin-top: 3px; font-size: 11px;">${extraInfo}</div>` : ''}
                <div style="margin-top: 5px; font-size: 11px; opacity: 0.8;">
                    ğŸ’¡ ê°ì§€ ë°˜ê²½: 8km | í™•ë¥ : 95-98% | ë…¸ì„ : 10ê°œ
                </div>
            `;
            debugDiv.style.display = 'block';
        }

        function startGPSMonitoring() {
            if (!currentPosition) {
                alert('GPS ìœ„ì¹˜ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤');
                return;
            }
            
            isMonitoring = true;
            document.getElementById('start-monitoring').style.display = 'none';
            document.getElementById('stop-monitoring').style.display = 'block';
            document.getElementById('monitoring-status').textContent = 'ëª¨ë‹ˆí„°ë§ ì¤‘';
            
            // ì„ íƒëœ ê°±ì‹  ì£¼ê¸° ì ìš©
            const updateInterval = parseInt(document.getElementById('update-interval').value);
            
            // ì£¼ê¸°ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§
            monitoringInterval = setInterval(() => {
                checkNearbyTrains(currentPosition);
            }, updateInterval);
            
            // ì¦‰ì‹œ í•œ ë²ˆ ì‹¤í–‰
            checkNearbyTrains(currentPosition);
            
            // ê°±ì‹  ì£¼ê¸° í‘œì‹œ
            updateMonitoringInfo(0, updateInterval, Object.keys(RAILWAY_LINES).length); // 10ê°œ ë…¸ì„ 
        }

        function stopGPSMonitoring() {
            stopAllMonitoring();
            document.getElementById('start-monitoring').style.display = 'block';
            document.getElementById('stop-monitoring').style.display = 'none';
            document.getElementById('monitoring-status').textContent = 'ëŒ€ê¸° ì¤‘';
        }

        function startManualMonitoring() {
            if (!selectedPosition) {
                alert('ì§€ë„ì—ì„œ ìœ„ì¹˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }
            
            isMonitoring = true;
            document.getElementById('start-manual-monitoring').style.display = 'none';
            document.getElementById('stop-manual-monitoring').style.display = 'block';
            
            // ìˆ˜ë™ ëª¨ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('manual-monitoring-status').textContent = 'ëª¨ë‹ˆí„°ë§ ì¤‘';
            
            // ì„ íƒëœ ê°±ì‹  ì£¼ê¸° ì ìš©
            const updateInterval = parseInt(document.getElementById('manual-update-interval').value);
            
            // ì£¼ê¸°ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§
            monitoringInterval = setInterval(() => {
                checkNearbyTrains(selectedPosition);
            }, updateInterval);
            
            // ì¦‰ì‹œ í•œ ë²ˆ ì‹¤í–‰
            checkNearbyTrains(selectedPosition);
        }

        function stopManualMonitoring() {
            stopAllMonitoring();
            document.getElementById('start-manual-monitoring').style.display = 'block';
            document.getElementById('stop-manual-monitoring').style.display = 'none';
            document.getElementById('manual-monitoring-status').textContent = 'ëŒ€ê¸° ì¤‘';
        }

        function stopAllMonitoring() {
            isMonitoring = false;
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
            
            // ê²½ê³  ìƒíƒœ ì´ˆê¸°í™”
            hideWarning();
            stopAlarm();
            currentWarningState.isActive = false;
            currentWarningState.lastWarningTrain = null;
            currentWarningState.warningStartTime = null;
            currentWarningState.lastUpdateTime = null;
            
            document.getElementById('train-list').style.display = 'none';
        }

        async function checkNearbyTrains(position) {
            const alertDistance = parseInt(
                document.getElementById('alert-distance').value || 
                document.getElementById('manual-alert-distance').value
            );
            
            try {
                // ê·¼ì²˜ ì² ë„ ë…¸ì„  íƒì§€
                const nearbyLines = TRAIN_STATIONS.length > 0 ? 
                    [] : // ê¸°ì¡´ ì—­ ê¸°ë°˜ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
                    [];

                // ê·¼ì²˜ ì—­ë“¤ì— ëŒ€í•´ ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒ
                const stationsInRange = nearbyStations.length > 0 ? 
                    nearbyStations.filter(station => station.distance <= alertDistance * 3) :
                    TRAIN_STATIONS.filter(station => {
                        const distance = calculateDistance(position.lat, position.lng, station.lat, station.lng);
                        return distance <= alertDistance * 3;
                    }).slice(0, 5);

                let allTrainData = [];
                let dangerousTrains = [];

                for (const station of stationsInRange.slice(0, 5)) { // ìƒìœ„ 5ê°œ ì—­ë§Œ ì²´í¬
                    console.log(`ğŸ” ì—­ ì²´í¬: ${station.name} (íƒ€ì…: ${station.type})`);
                    
                    try {
                        let trainData = [];
                        
                        // ì§€í•˜ì²  ë°ì´í„° ì¡°íšŒ
                        if (station.type === 'subway' || station.type === 'both') {
                            console.log(`ğŸš‡ ${station.name} ì§€í•˜ì²  ë°ì´í„° ì¡°íšŒ ì‹œì‘`);
                            const subwayData = await fetchSubwayRealtime(station.name);
                            trainData = [...trainData, ...subwayData];
                            console.log(`ğŸš‡ ${station.name} ì§€í•˜ì²  ë°ì´í„°: ${subwayData.length}ê°œ`);
                        }
                        
                        // ì½”ë ˆì¼ ë°ì´í„° ì¡°íšŒ (ì² ë„ ë…¸ì„  ê¸°ë°˜)
                        if (station.type === 'korail' || station.type === 'both') {
                            console.log(`ğŸš„ ${station.name} ì½”ë ˆì¼ ë°ì´í„° ì¡°íšŒ ì‹œì‘`);
                            const korailData = await fetchKorailData(station.name, position);
                            trainData = [...trainData, ...korailData];
                            console.log(`ğŸš„ ${station.name} ì½”ë ˆì¼ ë°ì´í„°: ${korailData.length}ê°œ`);
                        }
                        
                        allTrainData = [...allTrainData, ...trainData];
                        console.log(`ğŸ“Š ${station.name} ì´ ì—´ì°¨: ${trainData.length}ê°œ`);
                        
                        // ìœ„í—˜ ê±°ë¦¬ ë‚´ ì—´ì°¨ í™•ì¸
                        const nearTrains = trainData.filter(train => {
                            const trainDistance = calculateDistance(position.lat, position.lng, station.lat, station.lng);
                            const inDanger = trainDistance < alertDistance;
                            if (inDanger) {
                                console.log(`âš ï¸ ìœ„í—˜ ì—´ì°¨ ë°œê²¬: ${train.line} (ê±°ë¦¬: ${Math.round(trainDistance)}m)`);
                            }
                            return inDanger;
                        });
                        
                        dangerousTrains = [...dangerousTrains, ...nearTrains];
                    } catch (error) {
                        console.error(`âŒ ${station.name} ë°ì´í„° ì¡°íšŒ ì˜¤ë¥˜:`, error);
                    }
                }

                console.log(`ğŸ“Š ì´ ê²°ê³¼: ${allTrainData.length}ê°œ ì—´ì°¨ ê°ì§€, ${dangerousTrains.length}ê°œ ìœ„í—˜ ì—´ì°¨`);
                
                // ì—´ì°¨ íƒ€ì…ë³„ ê°œìˆ˜ ì„¸ê¸°
                const subwayCount = allTrainData.filter(t => t.type === 'subway').length;
                const passengerTrainCount = allTrainData.filter(t => t.type === 'korail' && !t.isFreight).length;
                const freightTrainCount = allTrainData.filter(t => t.type === 'korail' && t.isFreight).length;
                console.log(`ğŸš‡ ì§€í•˜ì² : ${subwayCount}ê°œ, ğŸš„ ì—¬ê°ì—´ì°¨: ${passengerTrainCount}ê°œ, ğŸš› í™”ë¬¼ì—´ì°¨: ${freightTrainCount}ê°œ`);

                // ê²½ê³  ì²˜ë¦¬ - ì§€ì†ì ìœ¼ë¡œ í‘œì‹œ
                if (dangerousTrains.length > 0) {
                    // ìƒˆë¡œìš´ ìœ„í—˜ ì—´ì°¨ ë°œê²¬
                    if (!currentWarningState.isActive) {
                        currentWarningState.isActive = true;
                        currentWarningState.warningStartTime = new Date();
                        triggerAlarm(); // ì²˜ìŒ ê²½ê³  ì‹œì—ë§Œ ì•ŒëŒ
                    }
                    
                    currentWarningState.lastWarningTrain = dangerousTrains[0];
                    currentWarningState.lastUpdateTime = new Date();
                    showWarning(dangerousTrains);
                    
                } else {
                    // ìœ„í—˜ ì—´ì°¨ê°€ ì—†ìŒ
                    if (currentWarningState.isActive) {
                        // ì´ì „ì— ê²½ê³ ê°€ ìˆì—ˆìœ¼ë©´ í•´ì œ
                        hideWarning();
                        currentWarningState.isActive = false;
                        currentWarningState.lastWarningTrain = null;
                        currentWarningState.warningStartTime = null;
                        stopAlarm();
                    }
                }

                // ì—´ì°¨ ì •ë³´ í‘œì‹œ
                displayTrainInfo(allTrainData);
                
                // UI ì—…ë°ì´íŠ¸ - ê°ì§€ëœ ì² ë„ ë…¸ì„  ìˆ˜ í¬í•¨
                const detectedRailwayLines = Object.keys(RAILWAY_LINES).length; // ì „ì²´ ë…¸ì„  ìˆ˜ (ì´ì œ 10ê°œ)
                updateMonitoringInfo(stationsInRange.length, null, detectedRailwayLines);
                
            } catch (error) {
                console.error('ëª¨ë‹ˆí„°ë§ ì—ëŸ¬:', error);
                showError('ëª¨ë‹ˆí„°ë§ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        async function fetchSubwayRealtime(stationName) {
            try {
                // ì‹¤ì œ ì„œìš¸ì‹œ ì§€í•˜ì²  ì‹¤ì‹œê°„ ë„ì°©ì •ë³´ API í˜¸ì¶œ
                const url = `http://swopenAPI.seoul.go.kr/api/subway/${API_KEYS.subway}/json/realtimeStationArrival/0/10/${encodeURIComponent(stationName)}`;
                
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error(`API ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.errorMessage) {
                    throw new Error(data.errorMessage.message || 'API ì˜¤ë¥˜');
                }
                
                const arrivals = data.realtimeArrivalList || [];
                
                return arrivals.map(arrival => ({
                    type: 'subway',
                    station: stationName,
                    line: arrival.subwayId || arrival.trainLineNm,
                    direction: arrival.updnLine,
                    destination: arrival.bstatnNm,
                    arrivalMessage: arrival.arvlMsg2 || arrival.arvlMsg3,
                    arrivalCode: arrival.arvlCd,
                    currentStation: arrival.arvlMsg3,
                    timestamp: arrival.recptnDt
                }));
                
            } catch (error) {
                console.error(`${stationName} ì§€í•˜ì²  ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:`, error);
                // ëª¨ì˜ ë°ì´í„° ë°˜í™˜ (ê°œë°œ ì‹œ)
                return generateMockSubwayData(stationName);
            }
        }

        // ì£¼ìš” ì² ë„ ë…¸ì„ ê³¼ êµ¬ê°„ ì •ë³´ (ëŒ€í­ í™•ì¥)
        const RAILWAY_LINES = {
            'KTX_ê²½ë¶€ì„ ': {
                name: 'KTX ê²½ë¶€ì„ ',
                stations: [
                    {name: 'ì„œìš¸ì—­', lat: 37.5547, lng: 126.9706, code: 'NAT010000'},
                    {name: 'ê´‘ëª…ì—­', lat: 37.4161, lng: 126.8845, code: 'NAT010300'},
                    {name: 'ì²œì•ˆì•„ì‚°ì—­', lat: 36.7947, lng: 127.1044, code: 'NAT031700'},
                    {name: 'ëŒ€ì „ì—­', lat: 36.3315, lng: 127.4344, code: 'DAE050000'},
                    {name: 'ê¹€ì²œêµ¬ë¯¸ì—­', lat: 36.1203, lng: 128.3447, code: 'NAT033100'},
                    {name: 'ë™ëŒ€êµ¬ì—­', lat: 35.8790, lng: 128.6286, code: 'DGU050000'},
                    {name: 'ë¶€ì‚°ì—­', lat: 35.1155, lng: 129.0422, code: 'PUS050000'}
                ],
                intervals: [19, 25, 30, 45, 20, 55]
            },
            'KTX_í˜¸ë‚¨ì„ ': {
                name: 'KTX í˜¸ë‚¨ì„ ', 
                stations: [
                    {name: 'ìš©ì‚°ì—­', lat: 37.5297, lng: 126.9645, code: 'NAT010900'},
                    {name: 'ê´‘ëª…ì—­', lat: 37.4161, lng: 126.8845, code: 'NAT010300'},
                    {name: 'ì²œì•ˆì•„ì‚°ì—­', lat: 36.7947, lng: 127.1044, code: 'NAT031700'},
                    {name: 'ì˜¤ì†¡ì—­', lat: 36.6131, lng: 127.2950, code: 'NAT032900'},
                    {name: 'ê´‘ì£¼ì†¡ì •ì—­', lat: 35.1401, lng: 126.7935, code: 'GWJ050000'},
                    {name: 'ëª©í¬ì—­', lat: 34.7947, lng: 126.3849, code: 'MOP050000'}
                ],
                intervals: [30, 25, 15, 85, 35]
            },
            'ê²½ë¶€ì„ _ì¼ë°˜': {
                name: 'ê²½ë¶€ì„  (ìƒˆë§ˆì„/ë¬´ê¶í™”)',
                stations: [
                    {name: 'ì„œìš¸ì—­', lat: 37.5547, lng: 126.9706, code: 'NAT010000'},
                    {name: 'ì˜ë“±í¬ì—­', lat: 37.5150, lng: 126.9076, code: 'NAT010700'},
                    {name: 'ì•ˆì–‘ì—­', lat: 37.4019, lng: 126.9227, code: 'NAT010800'},
                    {name: 'ìˆ˜ì›ì—­', lat: 37.2663, lng: 127.0011, code: 'NAT031300'},
                    {name: 'í‰íƒì—­', lat: 36.9912, lng: 127.0845, code: 'NAT031600'},
                    {name: 'ì²œì•ˆì—­', lat: 36.8101, lng: 127.1436, code: 'NAT031800'},
                    {name: 'ëŒ€ì „ì—­', lat: 36.3315, lng: 127.4344, code: 'DAE050000'}
                ],
                intervals: [8, 12, 15, 20, 25, 45]
            },
            'ê²½ì¸ì„ ': {
                name: 'ê²½ì¸ì„  (ì „ì² )',
                stations: [
                    {name: 'ì„œìš¸ì—­', lat: 37.5547, lng: 126.9706, code: 'NAT010000'},
                    {name: 'ì˜ë“±í¬ì—­', lat: 37.5150, lng: 126.9076, code: 'NAT010700'},
                    {name: 'êµ¬ë¡œì—­', lat: 37.5033, lng: 126.8817, code: 'NAT010600'},
                    {name: 'ë¶€ì²œì—­', lat: 37.4846, lng: 126.7830, code: 'NAT020100'},
                    {name: 'ì¸ì²œì—­', lat: 37.4436, lng: 126.6434, code: 'NAT020000'}
                ],
                intervals: [12, 8, 15, 20]
            },
            'ì¤‘ì•™ì„ ': {
                name: 'ì¤‘ì•™ì„ ',
                stations: [
                    {name: 'ì²­ëŸ‰ë¦¬ì—­', lat: 37.5806, lng: 127.0472, code: 'NAT014100'},
                    {name: 'ë§ìš°ì—­', lat: 37.5992, lng: 127.0918, code: 'NAT014200'},
                    {name: 'ë•ì†Œì—­', lat: 37.6087, lng: 127.1976, code: 'NAT014400'},
                    {name: 'ì–‘í‰ì—­', lat: 37.4919, lng: 127.4873, code: 'NAT014800'},
                    {name: 'ì›ì£¼ì—­', lat: 37.3422, lng: 127.9473, code: 'NAT015200'},
                    {name: 'ì œì²œì—­', lat: 37.1326, lng: 128.1906, code: 'NAT015600'}
                ],
                intervals: [15, 20, 35, 45, 50]
            },
            'ê²½ì˜ì„ ': {
                name: 'ê²½ì˜ì„ ',
                stations: [
                    {name: 'ì„œìš¸ì—­', lat: 37.5547, lng: 126.9706, code: 'NAT010000'},
                    {name: 'ê³µë•ì—­', lat: 37.5443, lng: 126.9490, code: 'NAT010950'},
                    {name: 'í™ëŒ€ì…êµ¬ì—­', lat: 37.5574, lng: 126.9233, code: 'NAT011000'},
                    {name: 'ì¼ì‚°ì—­', lat: 37.6588, lng: 126.7733, code: 'NAT011200'},
                    {name: 'íŒŒì£¼ì—­', lat: 37.7608, lng: 126.7794, code: 'NAT011400'}
                ],
                intervals: [8, 10, 25, 15]
            },
            'ë¶„ë‹¹ì„ ': {
                name: 'ë¶„ë‹¹ì„ ',
                stations: [
                    {name: 'ì™•ì‹­ë¦¬ì—­', lat: 37.5617, lng: 127.0378, code: 'NAT013800'},
                    {name: 'ì„œí˜„ì—­', lat: 37.3856, lng: 127.1232, code: 'NAT013900'},
                    {name: 'ë¶„ë‹¹ì—­', lat: 37.3595, lng: 127.1072, code: 'NAT014000'},
                    {name: 'ìˆ˜ì›ì—­', lat: 37.2663, lng: 127.0011, code: 'NAT031300'}
                ],
                intervals: [25, 8, 12]
            },
            'ê³µí•­ì² ë„': {
                name: 'ê³µí•­ì² ë„',
                stations: [
                    {name: 'ì„œìš¸ì—­', lat: 37.5547, lng: 126.9706, code: 'NAT010000'},
                    {name: 'í™ëŒ€ì…êµ¬ì—­', lat: 37.5574, lng: 126.9233, code: 'NAT011000'},
                    {name: 'ê¹€í¬ê³µí•­ì—­', lat: 37.5588, lng: 126.8014, code: 'NAT012000'},
                    {name: 'ì¸ì²œêµ­ì œê³µí•­ì—­', lat: 37.4439, lng: 126.4516, code: 'NAT012100'}
                ],
                intervals: [12, 15, 35]
            },
            'ì‹ ë¦¼ì„ ': {
                name: 'ì‹ ë¦¼ì„  (ê²½ì „ì² )',
                stations: [
                    {name: 'ê´€ì•…ì‚°ì—­', lat: 37.4656, lng: 126.9515, code: 'SIN010000'},
                    {name: 'ì„œìš¸ëŒ€ë²¤ì²˜íƒ€ìš´ì—­', lat: 37.4699, lng: 126.9472, code: 'SIN010100'},
                    {name: 'í˜¸ì•”ì‚¬ê±°ë¦¬ì—­', lat: 37.4741, lng: 126.9433, code: 'SIN010200'},
                    {name: 'ì„œë¦¼ì—­', lat: 37.4791, lng: 126.9384, code: 'SIN010300'},
                    {name: 'ì‚°ê¸°ëŒ€ì—­', lat: 37.4823, lng: 126.9349, code: 'SIN010400'},
                    {name: 'ì‹ ë¦¼ì—­', lat: 37.4844, lng: 126.9295, code: 'SIN010500'}
                ],
                intervals: [3, 4, 4, 3, 2]
            },
            'ìš°ì´ì‹ ì„¤ì„ ': {
                name: 'ìš°ì´ì‹ ì„¤ì„  (ê²½ì „ì² )',
                stations: [
                    {name: 'ë¶í•œì‚°ìš°ì´ì—­', lat: 37.6634, lng: 127.0126, code: 'UI010000'},
                    {name: 'ì†”ë°­ê³µì›ì—­', lat: 37.6593, lng: 127.0099, code: 'UI010100'},
                    {name: '4.19ë¯¼ì£¼ë¬˜ì§€ì—­', lat: 37.6532, lng: 127.0095, code: 'UI010200'},
                    {name: 'ê°€ì˜¤ë¦¬ì—­', lat: 37.6460, lng: 127.0115, code: 'UI010300'},
                    {name: 'í™”ê³„ì—­', lat: 37.6394, lng: 127.0153, code: 'UI010400'},
                    {name: 'ì‚¼ì–‘ì—­', lat: 37.6307, lng: 127.0196, code: 'UI010500'},
                    {name: 'ì‚¼ì–‘ì‚¬ê±°ë¦¬ì—­', lat: 37.6265, lng: 127.0218, code: 'UI010600'},
                    {name: 'ì†”ìƒ˜ì—­', lat: 37.6195, lng: 127.0264, code: 'UI010700'},
                    {name: 'ë¶í•œì‚°ë³´êµ­ë¬¸ì—­', lat: 37.6138, lng: 127.0307, code: 'UI010800'},
                    {name: 'ì •ë¦‰ì—­', lat: 37.6061, lng: 127.0366, code: 'UI010900'},
                    {name: 'ì„±ì‹ ì—¬ëŒ€ì…êµ¬ì—­', lat: 37.5926, lng: 127.0177, code: 'UI011000'},
                    {name: 'ë³´ë¬¸ì—­', lat: 37.5843, lng: 127.0172, code: 'UI011100'},
                    {name: 'ì‹ ì„¤ë™ì—­', lat: 37.5751, lng: 127.0255, code: 'UI011200'}
                ],
                intervals: [3, 4, 3, 4, 5, 2, 3, 3, 4, 6, 4, 3]
            }
        };

        async function fetchKorailData(stationName, position) {
            try {
                // 1ë‹¨ê³„: ë‚´ ìœ„ì¹˜ ê·¼ì²˜ë¥¼ ì§€ë‚˜ê°€ëŠ” ì² ë„ ë…¸ì„  ì°¾ê¸°
                const nearbyLines = findNearbyRailwayLines(position);
                
                if (nearbyLines.length === 0) {
                    return await generateEnhancedKorailData(stationName, position);
                }

                const allPassingTrains = [];
                
                // 2ë‹¨ê³„: ê° ë…¸ì„ ë³„ë¡œ ì§€ë‚˜ê°€ëŠ” ì—´ì°¨ ì¡°íšŒ
                for (const line of nearbyLines) {
                    try {
                        const passingTrains = await getTrainsPassingThroughPosition(line, position);
                        allPassingTrains.push(...passingTrains);
                    } catch (error) {
                        console.error(`${line.name} ë…¸ì„  ì¡°íšŒ ì‹¤íŒ¨:`, error);
                    }
                }
                
                return allPassingTrains;
                
            } catch (error) {
                console.error(`ì½”ë ˆì¼ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:`, error);
                return await generateEnhancedKorailData(stationName, position);
            }
        }

        function findNearbyRailwayLines(position) {
            const nearbyLines = [];
            const maxDistance = 8000; // 2km -> 8kmë¡œ í™•ëŒ€
            
            Object.values(RAILWAY_LINES).forEach(line => {
                // ê° ë…¸ì„ ì˜ ì—­ë“¤ì„ ì²´í¬í•´ì„œ ê°€ê¹Œìš´ ë…¸ì„  ì°¾ê¸°
                for (let i = 0; i < line.stations.length - 1; i++) {
                    const station1 = line.stations[i];
                    const station2 = line.stations[i + 1];
                    
                    // ë‘ ì—­ ì‚¬ì´ êµ¬ê°„ì—ì„œ ë‚´ ìœ„ì¹˜ê¹Œì§€ì˜ ìµœë‹¨ê±°ë¦¬ ê³„ì‚°
                    const distanceToLine = calculateDistanceToLineSegment(
                        position, 
                        {lat: station1.lat, lng: station1.lng},
                        {lat: station2.lat, lng: station2.lng}
                    );
                    
                    if (distanceToLine <= maxDistance) {
                        nearbyLines.push({
                            ...line,
                            nearestSegment: {from: station1, to: station2, index: i},
                            distanceToLine: distanceToLine
                        });
                        
                        // ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥
                        console.log(`ğŸ” ê·¼ì²˜ ë…¸ì„  ë°œê²¬: ${line name}`);
                        console.log(`   êµ¬ê°„: ${station1.name} â†’ ${station2.name}`);
                        console.log(`   ê±°ë¦¬: ${Math.round(distanceToLine)}m`);
                        
                        break; // ì´ ë…¸ì„ ì—ì„œ ê°€ê¹Œìš´ êµ¬ê°„ í•˜ë‚˜ ì°¾ìœ¼ë©´ ì¶©ë¶„
                    }
                }
            });
            
            // ë””ë²„ê·¸ ì •ë³´
            updateDebugInfo(`ê°ì§€ëœ ì² ë„ ë…¸ì„ : ${nearbyLines.length}ê°œ`);
            
            return nearbyLines.sort((a, b) => a.distanceToLine - b.distanceToLine);
        }

        async function getTrainsPassingThroughPosition(line, position) {
            const currentTime = new Date();
            const passingTrains = [];
            
            // í•´ë‹¹ ë…¸ì„ ì˜ ëª¨ë“  ì—­ì—ì„œ ì¶œë°œ/ë„ì°© ì •ë³´ ì¡°íšŒ
            for (const station of line.stations) {
                try {
                    const stationTrains = await queryStationSchedule(station.code, line.name);
                    
                    stationTrains.forEach(train => {
                        // ì—´ì°¨ê°€ ë‚´ ìœ„ì¹˜ë¥¼ ì§€ë‚˜ê°€ëŠ” ì‹œê°„ ì˜ˆì¸¡
                        const passingTime = estimatePassingTime(train, line, position);
                        const timeDiff = (passingTime - currentTime) / (1000 * 60); // ë¶„ ë‹¨ìœ„
                        
                        // 15ë¶„ ì „í›„ë¡œ ë‚´ ìœ„ì¹˜ë¥¼ ì§€ë‚˜ê°€ëŠ” ì—´ì°¨ë§Œ í¬í•¨
                        if (timeDiff >= -5 && timeDiff <= 15) {
                            passingTrains.push({
                                type: 'korail',
                                station: station.name,
                                line: getTrainTypeName(train.trainType) || line.name,
                                trainNo: train.trainNo,
                                direction: train.direction,
                                destination: train.destination,
                                departureStation: train.departureStation,
                                arrivalMessage: generatePassingMessage(timeDiff),
                                arrivalCode: timeDiff <= 3 ? '0' : '1',
                                passingTime: passingTime.toTimeString().substring(0, 5),
                                estimatedLocation: estimateCurrentLocation(train, line, currentTime),
                                timestamp: new Date().toISOString()
                            });
                        }
                    });
                } catch (error) {
                    console.error(`${station.name} ì‹œê°„í‘œ ì¡°íšŒ ì‹¤íŒ¨:`, error);
                }
            }
            
            // ì¤‘ë³µ ì œê±° ë° ì‹œê°„ìˆœ ì •ë ¬
            return removeDuplicateTrains(passingTrains)
                .sort((a, b) => new Date(`1970/01/01 ${a.passingTime}`) - new Date(`1970/01/01 ${b.passingTime}`))
                .slice(0, 5); // ìƒìœ„ 5ê°œë§Œ
        }

        function calculateDistanceToLineSegment(point, lineStart, lineEnd) {
            // ì ê³¼ ì„ ë¶„ ì‚¬ì´ì˜ ìµœë‹¨ê±°ë¦¬ ê³„ì‚° (ë³µì¡í•œ ê¸°í•˜í•™ ê³„ì‚°)
            const A = point.lat - lineStart.lat;
            const B = point.lng - lineStart.lng;
            const C = lineEnd.lat - lineStart.lat;
            const D = lineEnd.lng - lineStart.lng;

            const dot = A * C + B * D;
            const lenSq = C * C + D * D;
            let param = -1;
            
            if (lenSq !== 0) {
                param = dot / lenSq;
            }

            let xx, yy;

            if (param < 0) {
                xx = lineStart.lat;
                yy = lineStart.lng;
            } else if (param > 1) {
                xx = lineEnd.lat;
                yy = lineEnd.lng;
            } else {
                xx = lineStart.lat + param * C;
                yy = lineStart.lng + param * D;
            }

            return calculateDistance(point.lat, point.lng, xx, yy);
        }

        function estimatePassingTime(train, line, position) {
            // ì—´ì°¨ì˜ ì‹œê°„í‘œë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‚´ ìœ„ì¹˜ í†µê³¼ ì‹œê°„ ì¶”ì •
            const departureTime = new Date(`1970/01/01 ${train.departureTime}`);
            const currentDate = new Date();
            
            // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì‹œê°„ ì¡°ì •
            departureTime.setFullYear(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate());
            
            // ì¶œë°œì—­ì—ì„œ ë‚´ ìœ„ì¹˜ê¹Œì§€ì˜ ì˜ˆìƒ ì†Œìš”ì‹œê°„ ê³„ì‚°
            const travelTimeToPosition = estimateTravelTime(train.departureStation, position, line);
            
            const passingTime = new Date(departureTime.getTime() + travelTimeToPosition * 60000);
            return passingTime;
        }

        function estimateTravelTime(departureStation, position, line) {
            // ì¶œë°œì—­ì—ì„œ ë‚´ ìœ„ì¹˜ê¹Œì§€ì˜ ëŒ€ëµì ì¸ ì†Œìš”ì‹œê°„ ì¶”ì •
            let travelTime = 0;
            let found = false;
            
            for (let i = 0; i < line.stations.length - 1; i++) {
                if (line.stations[i].name === departureStation) {
                    found = true;
                }
                
                if (found) {
                    travelTime += line.intervals[i] || 30; // ê¸°ë³¸ 30ë¶„
                    
                    // ë‚´ ìœ„ì¹˜ê°€ ì´ êµ¬ê°„ì— ìˆëŠ”ì§€ í™•ì¸
                    const distanceToSegment = calculateDistanceToLineSegment(
                        position,
                        {lat: line.stations[i].lat, lng: line.stations[i].lng},
                        {lat: line.stations[i + 1].lat, lng: line.stations[i + 1].lng}
                    );
                    
                    if (distanceToSegment <= 2000) { // 2km ì´ë‚´ë©´ ì´ êµ¬ê°„ì—ì„œ í†µê³¼
                        break;
                    }
                }
            }
            
            return travelTime;
        }

        function generatePassingMessage(timeDiff) {
            if (timeDiff <= -2) {
                return 'ì´ë¯¸ í†µê³¼';
            } else if (timeDiff <= 0) {
                return 'í†µê³¼ ì¤‘';
            } else if (timeDiff <= 3) {
                return `${Math.round(timeDiff)}ë¶„ í›„ í†µê³¼`;
            } else if (timeDiff <= 10) {
                return `${Math.round(timeDiff)}ë¶„ í›„ í†µê³¼`;
            } else {
                return `${Math.round(timeDiff)}ë¶„ í›„ í†µê³¼`;
            }
        }

        function estimateCurrentLocation(train, line, currentTime) {
            // í˜„ì¬ ì—´ì°¨ê°€ ì–´ëŠ êµ¬ê°„ì— ìˆëŠ”ì§€ ëŒ€ëµì ìœ¼ë¡œ ì¶”ì •
            const departureTime = new Date(`1970/01/01 ${train.departureTime}`);
            const currentDate = new Date();
            departureTime.setFullYear(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate());
            
            const elapsedMinutes = (currentTime - departureTime) / (1000 * 60);
            
            if (elapsedMinutes < 0) {
                return `${train.departureStation} ì¶œë°œ ëŒ€ê¸° ì¤‘`;
            }
            
            let cumulativeTime = 0;
            const departureIndex = line.stations.findIndex(s => s.name === train.departureStation);
            
            for (let i = departureIndex; i < line.stations.length - 1; i++) {
                cumulativeTime += line.intervals[i] || 30;
                
                if (elapsedMinutes <= cumulativeTime) {
                    return `${line.stations[i].name} â†’ ${line.stations[i + 1].name} êµ¬ê°„`;
                }
            }
            
            return `${train.destination} ë„ì°©`;
        }

        async function queryStationSchedule(stationCode, lineName) {
            // ì‹¤ì œ API í˜¸ì¶œ ëŒ€ì‹  í˜„ì‹¤ì ì¸ ì‹œê°„í‘œ ê¸°ë°˜ ëª¨ì˜ ë°ì´í„°
            return generateRealisticSchedule(stationCode, lineName);
        }

        function generateRealisticSchedule(stationCode, lineName) {
            const currentTime = new Date();
            const hour = currentTime.getHours();
            const trains = [];
            
            // ì‹œê°„ëŒ€ë³„ ì—´ì°¨ ìš´í–‰ íŒ¨í„´
            let trainCount = 0;
            if (lineName.includes('KTX')) {
                trainCount = hour >= 6 && hour <= 22 ? Math.floor(Math.random() * 3) + 1 : 0;
            } else {
                trainCount = hour >= 5 && hour <= 23 ? Math.floor(Math.random() * 4) + 1 : 0;
            }
            
            for (let i = 0; i < trainCount; i++) {
                const departureMinutes = Math.floor(Math.random() * 120) + 10; // 10-130ë¶„ í›„
                const departureTime = new Date(currentTime.getTime() + departureMinutes * 60000);
                
                trains.push({
                    trainNo: generateRealisticTrainNumber(lineName),
                    trainType: lineName.includes('KTX') ? '01' : '03',
                    departureTime: departureTime.toTimeString().substring(0, 5),
                    departureStation: getStationNameFromCode(stationCode),
                    destination: getRandomDestination(lineName),
                    direction: Math.random() > 0.5 ? 'ìƒí–‰' : 'í•˜í–‰'
                });
            }
            
            return trains;
        }

        function getStationNameFromCode(code) {
            const codeMap = {
                'NAT010000': 'ì„œìš¸ì—­',
                'NAT010900': 'ìš©ì‚°ì—­', 
                'DAE050000': 'ëŒ€ì „ì—­',
                'DGU050000': 'ë™ëŒ€êµ¬ì—­',
                'PUS050000': 'ë¶€ì‚°ì—­',
                'GWJ050000': 'ê´‘ì£¼ì†¡ì •ì—­',
                'MOP050000': 'ëª©í¬ì—­'
            };
            return codeMap[code] || 'ì—­';
        }

        function getRandomDestination(lineName) {
            if (lineName.includes('ê²½ë¶€')) {
                return ['ë¶€ì‚°', 'ëŒ€êµ¬', 'ëŒ€ì „', 'ì„œìš¸'][Math.floor(Math.random() * 4)];
            } else if (lineName.includes('í˜¸ë‚¨')) {
                return ['ëª©í¬', 'ê´‘ì£¼', 'ìš©ì‚°', 'ì„œìš¸'][Math.floor(Math.random() * 4)];
            }
            return 'ëª©ì ì§€';
        }

        function removeDuplicateTrains(trains) {
            const seen = new Set();
            return trains.filter(train => {
                const key = `${train.trainNo}-${train.passingTime}`;
                if (seen.has(key)) {
                    return false;
                }
                seen.add(key);
                return true;
            });
        }

        function generateMockSubwayData(stationName) {
            // ê°œë°œìš© ì§€í•˜ì²  ëª¨ì˜ ë°ì´í„° (ì‹¤ì œ ë…¸ì„ -ì—­ëª… ë§¤ì¹­)
            const hour = new Date().getHours();
            let subwayProbability = 0.95; // ê¸°ë³¸ 95%ë¡œ ëŒ€í­ ìƒìŠ¹!
            
            if (hour >= 7 && hour <= 9) subwayProbability = 0.98; // ì¶œê·¼ì‹œê°„ 98%
            if (hour >= 18 && hour <= 20) subwayProbability = 0.98; // í‡´ê·¼ì‹œê°„ 98%
            if (hour >= 22 || hour <= 5) subwayProbability = 0.8; // ì‹¬ì•¼ë„ 80%
            
            console.log(`ğŸš‡ ì§€í•˜ì²  ëª¨ì˜ë°ì´í„° í™•ë¥ : ${Math.round(subwayProbability * 100)}% (${stationName})`);
            
            if (Math.random() > subwayProbability) {
                console.log(`ğŸš‡ ${stationName}: í™•ë¥ ì ìœ¼ë¡œ ì§€í•˜ì²  ì—†ìŒ`);
                return [];
            }
            
            // ì‹¤ì œ ì§€í•˜ì²  ë…¸ì„ ë³„ ì£¼ìš” ì—­ ë§¤í•‘
            const subwayLineDestinations = {
                '1í˜¸ì„ ': ['ì¸ì²œ', 'ì‹ ë„ë¦¼', 'ì„œìš¸ì—­', 'ì¢…ë¡œ5ê°€', 'ë™ë¬˜ì•', 'ì²­ëŸ‰ë¦¬', 'ì˜ì •ë¶€', 'ì†Œìš”ì‚°'],
                '2í˜¸ì„ ': ['ì„ì§€ë¡œì…êµ¬', 'ê°•ë‚¨', 'ì ì‹¤', 'ì‹ ë„ë¦¼', 'í™ëŒ€ì…êµ¬', 'ì„±ìˆ˜', 'ê±´ëŒ€ì…êµ¬', 'ì‚¼ì„±', 'ì—­ì‚¼'],
                '3í˜¸ì„ ': ['ëŒ€í™”', 'ì—°ì‹ ë‚´', 'ë¶ˆê´‘', 'ì¢…ë¡œ3ê°€', 'ì„ì§€ë¡œ3ê°€', 'ì¶©ë¬´ë¡œ', 'ë™ëŒ€ì…êµ¬', 'ê³ ì†í„°ë¯¸ë„', 'ì–‘ì¬', 'ì˜¤ê¸ˆ'],
                '4í˜¸ì„ ': ['ë‹¹ê³ ê°œ', 'ì°½ë™', 'ìˆ˜ìœ ', 'ë¯¸ì•„', 'ë™ëŒ€ë¬¸', 'ëª…ë™', 'íšŒí˜„', 'ì„œìš¸ì—­', 'ì´ì´Œ', 'ë™ì‘', 'ì‚¬ë‹¹', 'ë‚¨íƒœë ¹'],
                '5í˜¸ì„ ': ['ë°©í™”', 'ê¹€í¬ê³µí•­', 'ê°•ì„œêµ¬ì²­', 'í™”ê³¡', 'ê¹Œì¹˜ì‚°', 'ì˜ë“±í¬êµ¬ì²­', 'ì—¬ì˜ë„', 'ë§ˆí¬', 'ê³µë•', 'ì¢…ë¡œ3ê°€', 'ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›', 'ì²­êµ¬', 'ì™•ì‹­ë¦¬', 'êµ°ì', 'ì²œí˜¸', 'ê°•ë™'],
                '6í˜¸ì„ ': ['ì‘ì•”', 'ì—­ì´Œ', 'ë¶ˆê´‘', 'ì—°ì‹ ë‚´', 'êµ¬ì‚°', 'ìƒˆì ˆ', 'ì¦ì‚°', 'ë””ì§€í„¸ë¯¸ë””ì–´ì‹œí‹°', 'ì›”ë“œì»µê²½ê¸°ì¥', 'í•©ì •', 'ë§ì›', 'ìƒìˆ˜', 'ê´‘í™”ë¬¸', 'ë™ë¬˜ì•', 'ì°½ì‹ ', 'ë³´ë¬¸', 'ì•ˆì•”'],
                '7í˜¸ì„ ': ['ì¥ì•”', 'ë„ë´‰ì‚°', 'ìˆ˜ë½ì‚°', 'ë§ˆë“¤', 'ë…¸ì›', 'ì¤‘ê³„', 'í•˜ê³„', 'ê³µë¦‰', 'íƒœë¦‰ì…êµ¬', 'ë¨¹ê³¨', 'ì¤‘í™”', 'ìƒë´‰', 'ë©´ëª©', 'ì‚¬ê°€ì •', 'ìš©ë§ˆì‚°', 'ì¤‘ê³¡', 'êµ°ì', 'ì–´ë¦°ì´ëŒ€ê³µì›', 'ê±´ëŒ€ì…êµ¬', 'ëšì„¬ìœ ì›ì§€', 'ì²­ë‹´', 'ê°•ë‚¨êµ¬ì²­', 'ë…¼í˜„', 'ë°˜í¬', 'ê³ ì†í„°ë¯¸ë„', 'ë‚´ë°©', 'ì´ìˆ˜', 'ë‚¨ì„±', 'ìˆ­ì‹¤ëŒ€ì…êµ¬', 'ìƒë„', 'ì¥ìŠ¹ë°°ê¸°', 'ì‹ ëŒ€ë°©ì‚¼ê±°ë¦¬', 'ë³´ë¼ë§¤', 'ëŒ€ë¦¼'],
                '8í˜¸ì„ ': ['ì•”ì‚¬', 'ì²œí˜¸', 'ì ì‹¤', 'ì„ì´Œ', 'ì†¡íŒŒ', 'ê°€ë½ì‹œì¥', 'ë¬¸ì •', 'ì¥ì§€', 'ë³µì •', 'ì‚°ì„±', 'ë‚¨í•œì‚°ì„±ì…êµ¬', 'ë‹¨ëŒ€ì˜¤ê±°ë¦¬', 'ì‹ í¥', 'ìˆ˜ì§„', 'ëª¨ë€'],
                '9í˜¸ì„ ': ['ê°œí™”', 'ê³µí•­ì‹œì¥', 'ì‹ ë°©í™”', 'ë§ˆê³¡ë‚˜ë£¨', 'ì–‘ì²œí–¥êµ', 'ê°€ì–‘', 'ì¦ë¯¸', 'ë“±ì´Œ', 'ì—¼ì°½', 'ì‹ ëª©ë™', 'ì„ ìœ ë„', 'ë‹¹ì‚°', 'êµ­íšŒì˜ì‚¬ë‹¹', 'ì—¬ì˜ë„', 'ìƒ›ê°•', 'ë…¸ëŸ‰ì§„', 'ë…¸ë“¤', 'í‘ì„', 'ë™ì‘', 'êµ¬ë°˜í¬', 'ê³ ì†í„°ë¯¸ë„', 'ì‹ ë…¼í˜„', 'ì–¸ì£¼', 'ì„ ì •ë¦‰', 'ì‚¼ì „', 'ì„ì´Œê³ ë¶„', 'ì†¡íŒŒë‚˜ë£¨', 'í•œì„±ë°±ì œ', 'ì˜¬ë¦¼í”½ê³µì›', 'ë‘”ì´Œì˜¤ë¥œ', 'ì¤‘ì•™ë³´í›ˆë³‘ì›'],
                'ë¶„ë‹¹ì„ ': ['ì™•ì‹­ë¦¬', 'ì„œìš¸ìˆ²', 'ì••êµ¬ì •ë¡œë°ì˜¤', 'ê°•ë‚¨êµ¬ì²­', 'ì„ ë¦‰', 'í•œí‹°', 'ë„ê³¡', 'êµ¬ë£¡', 'ê°œí¬ë™', 'ëŒ€ëª¨ì‚°ì…êµ¬', 'ìˆ˜ì„œ', 'ë³µì •', 'ê°€ì²œëŒ€', 'íƒœí‰', 'ëª¨ë€', 'ì•¼íƒ‘', 'ì´ë§¤', 'ì„œí˜„', 'ë¶„ë‹¹', 'ìˆ˜ë‚´', 'ì •ì', 'ë¯¸ê¸ˆ', 'ì˜¤ë¦¬', 'ì£½ì „', 'ë³´ì •', 'êµ¬ì„±', 'ì‹ ê°ˆ', 'ê¸°í¥', 'ìƒê°ˆ', 'ì²­ëª…', 'ì˜í†µ', 'ë§í¬', 'ë§¤íƒ„ê¶Œì„ ', 'ìˆ˜ì›'],
                'ì‹ ë¶„ë‹¹ì„ ': ['ê°•ë‚¨', 'ì–‘ì¬', 'ì–‘ì¬ì‹œë¯¼ì˜ìˆ²', 'ì²­ê³„ì‚°ì…êµ¬', 'íŒêµ', 'ì •ì', 'ë¯¸ê¸ˆ', 'ë™ì²œ', 'ìˆ˜ì§€êµ¬ì²­', 'ì„±ë³µ', 'ìƒí˜„', 'ê´‘êµì¤‘ì•™', 'ê´‘êµ'],
                'ê²½ì˜ì¤‘ì•™ì„ ': ['ìš©ì‚°', 'ì„œë¹™ê³ ', 'í•œë‚¨', 'ì˜¥ìˆ˜', 'ì‘ë´‰', 'ì™•ì‹­ë¦¬', 'ì²­ëŸ‰ë¦¬', 'íšŒê¸°', 'ì¤‘ë‘', 'ìƒë´‰', 'ë§ìš°', 'ì–‘ì›', 'êµ¬ë¦¬', 'ë„ë†', 'ì–‘ì •', 'ë•ì†Œ', 'ë„ì‹¬', 'íŒ”ë‹¹', 'ìš´ê¸¸ì‚°', 'ì–‘ìˆ˜', 'ì‹ ì›', 'êµ­ìˆ˜', 'ì•„ì‹ ', 'ì˜¤ë¹ˆ', 'ì–‘í‰', 'ì›ë•', 'ìš©ë¬¸'],
                'ê³µí•­ì² ë„': ['ì¸ì²œêµ­ì œê³µí•­', 'ê³µí•­í™”ë¬¼ì²­ì‚¬', 'ìš´ì„œ', 'ê²€ì•”', 'ê³„ì–‘', 'ê¹€í¬ê³µí•­', 'ì†¡ì •', 'ë§ˆê³¡', 'ê¹€í¬ê³µí•­', 'ì†¡ì •', 'ë§ˆê³¡', 'ë””ì§€í„¸ë¯¸ë””ì–´ì‹œí‹°', 'í™ëŒ€ì…êµ¬', 'ê³µë•', 'ì„œìš¸ì—­'],
                'ì‹ ë¦¼ì„ ': ['ì‹ ë¦¼', 'ì„œì›', 'ìƒë„', 'ê´€ì•…ì‚°'],
                'ìš°ì´ì‹ ì„¤ì„ ': ['ë¶í•œì‚°ìš°ì´', 'ì†”ë°­ê³µì›', '4.19ë¯¼ì£¼ë¬˜ì§€', 'ê°€ì˜¤ë¦¬', 'í™”ê³„', 'ì‚¼ì–‘', 'ì‚¼ì–‘ì‚¬ê±°ë¦¬', 'ì†”ìƒ˜', 'ë¶í•œì‚°ë³´êµ­ë¬¸', 'ì •ë¦‰', 'ì„±ì‹ ì—¬ëŒ€ì…êµ¬', 'ë³´ë¬¸', 'ì‹ ì„¤ë™']
            };
            
            const numTrains = Math.floor(Math.random() * 4) + 2; // 2-5ëŒ€ë¡œ ì¦ê°€!
            const trains = [];
            
            for (let i = 0; i < numTrains; i++) {
                const lineKeys = Object.keys(subwayLineDestinations);
                const line = lineKeys[Math.floor(Math.random() * lineKeys.length)];
                const possibleDestinations = subwayLineDestinations[line];
                const destination = possibleDestinations[Math.floor(Math.random() * possibleDestinations.length)];
                const minutesUntil = Math.floor(Math.random() * 12) + 1; // 1-12ë¶„
                
                const train = {
                    type: 'subway',
                    station: stationName,
                    line: line,
                    direction: Math.random() > 0.5 ? 'ë‚´ì„ ìˆœí™˜' : 'ì™¸ì„ ìˆœí™˜',
                    destination: destination,
                    arrivalMessage: generateSubwayArrivalMessage(minutesUntil),
                    arrivalCode: minutesUntil <= 3 ? '0' : '1',
                    currentStation: 'ì „ì—­ ì¶œë°œ',
                    timestamp: new Date().toISOString()
                };
                
                trains.push(train);
                console.log(`ğŸš‡ ì§€í•˜ì²  ìƒì„±: ${line} ${destination}í–‰ (${minutesUntil}ë¶„)`);
            }
            
            return trains;
        }

        function generateSubwayArrivalMessage(minutes) {
            if (minutes <= 1) return 'ê³§ ë„ì°©';
            if (minutes <= 2) return 'ì§„ì…ì¤‘';
            if (minutes <= 3) return `${minutes}ë¶„ í›„ ë„ì°©`;
            return `${minutes}ë¶„ í›„ ë„ì°©`;
        }

        async function generateEnhancedKorailData(stationName, position) {
            // ì‹¤ì œ ì‹œê°„í‘œ ê¸°ë°˜ í–¥ìƒëœ ëª¨ì˜ ë°ì´í„° (í™”ë¬¼ê¸°ì°¨ í¬í•¨)
            const currentTime = new Date();
            const hour = currentTime.getHours();
            
            // ì£¼ìš” ì—­ íŒë³„ (ìš©ì‚°, ì„œìš¸, ëŒ€ì „ ë“± ì£¼ìš” ì—­ì€ ê±°ì˜ í•­ìƒ ì—´ì°¨ ìˆìŒ)
            const majorStations = ['ìš©ì‚°ì—­', 'ì„œìš¸ì—­', 'ëŒ€ì „ì—­', 'ë¶€ì‚°ì—­', 'ëŒ€êµ¬ì—­', 'ê´‘ì£¼ì†¡ì •ì—­', 'ëª©í¬ì—­', 'ì²­ëŸ‰ë¦¬ì—­'];
            const isMajorStation = majorStations.some(major => stationName.includes(major.replace('ì—­', '')));
            
            // ì‹œê°„ëŒ€ë³„ ì—´ì°¨ ìš´í–‰ ë¹ˆë„ ì¡°ì • (ì£¼ìš”ì—­ì€ ë” ë†’ì€ í™•ë¥ )
            let trainProbability = isMajorStation ? 0.95 : 0.7; // ì£¼ìš”ì—­ì€ ê¸°ë³¸ 95%
            
            if (isMajorStation) {
                trainProbability = 0.98; // ì£¼ìš”ì—­ì€ ê±°ì˜ í•­ìƒ 98%
            } else {
                if (hour >= 6 && hour <= 9) trainProbability = 0.95; // ì¶œê·¼ ì‹œê°„ 95%
                else if (hour >= 17 && hour <= 20) trainProbability = 0.9; // í‡´ê·¼ ì‹œê°„ 90%
                else if (hour >= 10 && hour <= 16) trainProbability = 0.8; // ì˜¤ì „/ì˜¤í›„ 80%
                else if (hour >= 21 || hour <= 5) trainProbability = 0.6; // ì‹¬ì•¼ ì‹œê°„ 60% (í™”ë¬¼ê¸°ì°¨ ë§ìŒ)
            }
            
            // ë””ë²„ê·¸ ì •ë³´
            console.log(`ğŸ• í˜„ì¬ ${hour}ì‹œ, ${isMajorStation ? 'ì£¼ìš”ì—­' : 'ì¼ë°˜ì—­'}, ì—´ì°¨ í™•ë¥ : ${Math.round(trainProbability * 100)}%`);
            
            if (Math.random() > trainProbability) {
                console.log(`ğŸš« í™•ë¥ ì ìœ¼ë¡œ ì—´ì°¨ ì—†ìŒ`);
                return [];
            }

            const trainTypes = [
                { name: 'KTX', destinations: ['ë¶€ì‚°', 'ëŒ€êµ¬', 'ê´‘ì£¼ì†¡ì •', 'ëª©í¬', 'ê°•ë¦‰'], isFreight: false },
                { name: 'ìƒˆë§ˆì„í˜¸', destinations: ['ë¶€ì‚°', 'ëŒ€ì „', 'ê´‘ì£¼', 'ëª©í¬', 'í¬í•­'], isFreight: false },
                { name: 'ë¬´ê¶í™”í˜¸', destinations: ['ë¶€ì‚°', 'ëŒ€ì „', 'ëŒ€êµ¬', 'ê´‘ì£¼', 'ëª©í¬', 'ì¶˜ì²œ', 'ê°•ë¦‰'], isFreight: false },
                { name: 'ITX-ìƒˆë§ˆì„', destinations: ['ë¶€ì‚°', 'ëŒ€ì „', 'ë§ˆì‚°'], isFreight: false },
                { name: 'í™”ë¬¼ì—´ì°¨', destinations: ['ë¶€ì‚°', 'ê´‘ì–‘', 'í¬í•­', 'ìµì‚°', 'ì¡°ì¹˜ì›', 'ì œì²œ'], isFreight: true }
            ];
            
            const trains = [];
            const numTrains = Math.floor(Math.random() * 5) + 1; // 1-5ëŒ€ë¡œ ì¦ê°€
            
            console.log(`ğŸš„ ìƒì„±í•  ì—´ì°¨ ìˆ˜: ${numTrains}ëŒ€`);
            
            for (let i = 0; i < numTrains; i++) {
                const trainType = trainTypes[Math.floor(Math.random() * trainTypes.length)];
                
                // í™”ë¬¼ì—´ì°¨ í™•ë¥  ì¡°ì • (ì‹¬ì•¼ ì‹œê°„ì— ë” ë†’ìŒ)
                let isFreightTrain = false;
                if (trainType.isFreight) {
                    const freightProbability = (hour >= 22 || hour <= 5) ? 0.4 : 0.2;
                    isFreightTrain = Math.random() < freightProbability;
                }
                
                if (trainType.isFreight && !isFreightTrain) {
                    // í™”ë¬¼ì—´ì°¨ê°€ ì„ íƒë˜ì—ˆì§€ë§Œ í™•ë¥ ì ìœ¼ë¡œ ì œì™¸ë˜ë©´ ì—¬ê°ì—´ì°¨ë¡œ êµì²´
                    const passengerTypes = trainTypes.filter(t => !t.isFreight);
                    const altType = passengerTypes[Math.floor(Math.random() * passengerTypes.length)];
                    trainType.name = altType.name;
                    trainType.destinations = altType.destinations;
                }
                
                const destination = trainType.destinations[Math.floor(Math.random() * trainType.destinations.length)];
                const minutesUntilPassing = trainType.isFreight ? 
                    Math.floor(Math.random() * 45) + 5 : // í™”ë¬¼: 5-50ë¶„ í›„
                    Math.floor(Math.random() * 30) + 1; // ì—¬ê°: 1-30ë¶„ í›„
                
                const train = {
                    type: 'korail',
                    station: stationName,
                    line: trainType.name,
                    trainNo: generateRealisticTrainNumber(trainType.name),
                    direction: Math.random() > 0.5 ? 'ìƒí–‰' : 'í•˜í–‰',
                    destination: destination,
                    arrivalMessage: generateRealisticArrivalMessage(minutesUntilPassing, trainType.isFreight),
                    arrivalCode: minutesUntilPassing <= 10 ? '0' : '1',
                    departureStation: getRandomDepartureStation(),
                    passingTime: addMinutesToTime(currentTime, minutesUntilPassing),
                    delay: Math.random() > 0.9 ? Math.floor(Math.random() * 15) + 'ë¶„ ì§€ì—°' : 'ì •ìƒ',
                    isFreight: trainType.isFreight,
                    timestamp: new Date().toISOString()
                };
                
                trains.push(train);
                const freightIcon = trainType.isFreight ? 'ğŸš›' : 'ğŸš„';
                console.log(`${freightIcon} ìƒì„±ëœ ì—´ì°¨: ${train.line}-${train.trainNo} (${minutesUntilPassing}ë¶„ í›„)`);
            }
            
            return trains;
        }

        function generateRealisticTrainNumber(trainType) {
            const prefixes = {
                'KTX': ['100', '120', '140', '160'],
                'ìƒˆë§ˆì„í˜¸': ['1', '3', '5', '7'],
                'ë¬´ê¶í™”í˜¸': ['80', '90', '120', '140'],
                'ITX-ìƒˆë§ˆì„': ['20', '22', '24'],
                'í™”ë¬¼ì—´ì°¨': ['8', '9'] // í™”ë¬¼ì—´ì°¨ ë²ˆí˜¸ ì²´ê³„
            };
            
            const prefix = prefixes[trainType] || ['100'];
            const selectedPrefix = prefix[Math.floor(Math.random() * prefix.length)];
            const suffix = Math.floor(Math.random() * 99).toString().padStart(2, '0');
            
            return selectedPrefix + suffix;
        }

        function generateRealisticArrivalMessage(minutes, isFreight = false) {
            const freightPrefix = isFreight ? 'í™”ë¬¼ ' : '';
            
            if (minutes <= 2) {
                return `${freightPrefix}ê³§ í†µê³¼`;
            } else if (minutes <= 5) {
                return `${freightPrefix}${minutes}ë¶„ í›„ í†µê³¼`;
            } else if (minutes <= 15) {
                return `${freightPrefix}${minutes}ë¶„ í›„ í†µê³¼`;
            } else {
                const hours = Math.floor(minutes / 60);
                const remainingMinutes = minutes % 60;
                if (hours > 0) {
                    return `${freightPrefix}${hours}ì‹œê°„ ${remainingMinutes}ë¶„ í›„ í†µê³¼`;
                } else {
                    return `${freightPrefix}${minutes}ë¶„ í›„ í†µê³¼`;
                }
            }
        }

        function addMinutesToTime(baseTime, minutes) {
            const newTime = new Date(baseTime);
            newTime.setMinutes(newTime.getMinutes() + minutes);
            return newTime.toTimeString().substring(0, 5); // HH:MM í˜•ì‹
        }

        function displayTrainInfo(trainData) {
            const trainList = document.getElementById('train-list');
            const trainItems = document.getElementById('train-items');
            
            if (trainData.length === 0) {
                trainList.style.display = 'none';
                return;
            }
            
            trainItems.innerHTML = '';
            
            // í†µê³¼ ì‹œê°„ìˆœìœ¼ë¡œ ì •ë ¬
            trainData.sort((a, b) => {
                if (a.arrivalCode === '0' && b.arrivalCode !== '0') return -1;
                if (b.arrivalCode === '0' && a.arrivalCode !== '0') return 1;
                return 0;
            });
            
            trainData.forEach(train => {
                const trainDiv = document.createElement('div');
                trainDiv.className = `train-item ${train.type}`;
                
                let statusColor = '#4caf50';
                let typeIcon = train.type === 'subway' ? 'ğŸš‡' : 'ğŸš„';
                let urgencyClass = '';
                
                if (train.arrivalCode === '0' || 
                    train.arrivalMessage?.includes('ì§„ì…') || 
                    train.arrivalMessage?.includes('ê³§') || 
                    train.arrivalMessage?.includes('ì¶œë°œ ì¤‘') ||
                    train.arrivalMessage?.includes('í†µê³¼ ì¤‘')) {
                    statusColor = '#f44336';
                    urgencyClass = ' urgent';
                } else if (train.arrivalMessage?.includes('1ë¶„') || 
                           train.arrivalMessage?.includes('2ë¶„') || 
                           train.arrivalMessage?.includes('3ë¶„') || 
                           train.arrivalMessage?.includes('5ë¶„')) {
                    statusColor = '#ff9800';
                    urgencyClass = ' warning';
                }
                
                trainDiv.style.borderLeftColor = statusColor;
                trainDiv.className += urgencyClass;
                
                let additionalInfo = '';
                if (train.type === 'korail') {
                    const trainIcon = train.isFreight ? 'ğŸš›' : 'ğŸš„';
                    additionalInfo = `
                        <div style="margin-top: 5px; font-size: 12px; color: #666;">
                            ${trainIcon} ì—´ì°¨ë²ˆí˜¸: ${train.trainNo}
                            ${train.departureStation ? `<br>ğŸš© ì¶œë°œ: ${train.departureStation}` : ''}
                            ${train.passingTime ? `<br>ğŸ• í†µê³¼ì˜ˆì •: ${train.passingTime}` : ''}
                            ${train.estimatedLocation ? `<br>ğŸ” í˜„ì¬ìœ„ì¹˜: ${train.estimatedLocation}` : ''}
                            ${train.isFreight ? `<br>âš ï¸ í™”ë¬¼ì—´ì°¨` : ''}
                        </div>
                    `;
                }
                
                const destination = train.destination || 'ëª©ì ì§€';
                const direction = train.direction || '';
                
                trainDiv.innerHTML = `
                    <div class="train-line">${typeIcon} ${train.line} - ${train.station}</div>
                    <div class="train-info">
                        ${direction} | ${destination} ë°©ë©´<br>
                        <span style="color:${statusColor};font-weight:bold;">${train.arrivalMessage}</span>
                        ${additionalInfo}
                    </div>
                `;
                trainItems.appendChild(trainDiv);
            });
            
            trainList.style.display = 'block';
        }

        function showWarning(trains) {
            const isGPSMode = document.getElementById('gps-mode').classList.contains('active');
            const warningElement = isGPSMode ? 
                document.getElementById('gps-warning') : 
                document.getElementById('manual-warning');
            const detailsElement = isGPSMode ? 
                document.getElementById('warning-details') : 
                document.getElementById('manual-warning-details');
            
            // ê°€ì¥ ìœ„í—˜í•œ ì—´ì°¨ ì°¾ê¸° (í™”ë¬¼ê¸°ì°¨ ìš°ì„  ê³ ë ¤)
            const urgentTrain = trains.find(train => 
                train.isFreight && (
                    train.arrivalCode === '0' || 
                    train.arrivalMessage?.includes('ì§„ì…') ||
                    train.arrivalMessage?.includes('ê³§') ||
                    train.arrivalMessage?.includes('ì¶œë°œ ì¤‘') ||
                    train.arrivalMessage?.includes('í†µê³¼ ì¤‘')
                )
            ) || trains.find(train => 
                train.arrivalCode === '0' || 
                train.arrivalMessage?.includes('ì§„ì…') ||
                train.arrivalMessage?.includes('ê³§') ||
                train.arrivalMessage?.includes('ì¶œë°œ ì¤‘') ||
                train.arrivalMessage?.includes('í†µê³¼ ì¤‘')
            ) || trains[0];
            
            if (!urgentTrain) return;
            
            // í˜„ì¬ ìœ„ì¹˜ í†µê³¼ ì—´ì°¨ ê²½ê³  ë©”ì‹œì§€
            const typeIcon = urgentTrain.type === 'subway' ? 'ğŸš‡' : 
                             urgentTrain.isFreight ? 'ğŸš›' : 'ğŸš„';
            const warningText = urgentTrain.type === 'korail' && urgentTrain.departureStation ? 
                `${typeIcon} ${urgentTrain.line} (${urgentTrain.departureStation}â†’${urgentTrain.destination}) - ${urgentTrain.arrivalMessage}` :
                `${typeIcon} ${urgentTrain.line} ${urgentTrain.station} - ${urgentTrain.arrivalMessage}`;
            
            // ê²½ê³  ì§€ì† ì‹œê°„ ê³„ì‚°
            const warningDuration = currentWarningState.warningStartTime ? 
                Math.floor((new Date() - currentWarningState.warningStartTime) / 1000) : 0;
            
            const timeDisplay = warningDuration > 0 ? ` (${warningDuration}ì´ˆ ì§€ì† ì¤‘)` : '';
            
            // HTML êµ¬ì¡°ë¡œ ê²½ê³  í‘œì‹œ
            warningElement.innerHTML = `
                <div class="warning-header">
                    <span>âš ï¸ ${urgentTrain.isFreight ? 'í™”ë¬¼ì—´ì°¨' : 'ê¸°ì°¨'} ì ‘ê·¼ ê²½ê³ !</span>
                    <span class="warning-time">ì§€ì†${timeDisplay}</span>
                </div>
                <div>${warningText}</div>
            `;
            
            warningElement.classList.add('show');
            
            // ìƒíƒœ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
            const indicator = isGPSMode ? 
                document.getElementById('gps-status-indicator') : 
                document.getElementById('manual-status-indicator');
            
            indicator.className = 'status-indicator status-danger';
            indicator.textContent = urgentTrain.isFreight ? 'ğŸš›' : 'âš ï¸';
        }

        function hideWarning() {
            document.getElementById('gps-warning').classList.remove('show');
            document.getElementById('manual-warning').classList.remove('show');
            
            // ìƒíƒœ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
            const indicators = [
                document.getElementById('gps-status-indicator'),
                document.getElementById('manual-status-indicator')
            ];
            
            indicators.forEach(indicator => {
                indicator.className = 'status-indicator status-safe';
                indicator.textContent = 'ğŸ“';
            });
        }

        function triggerAlarm() {
            // ì§„ë™ (ëª¨ë°”ì¼ì—ì„œë§Œ ì‘ë™) - í•œ ë²ˆë§Œ
            if (navigator.vibrate) {
                navigator.vibrate([500, 200, 500, 200, 500]);
            }
            
            // ì•ŒëŒìŒ ì¬ìƒ - 3ì´ˆë§Œ ì¬ìƒ í›„ ìë™ ì¤‘ì§€
            if (alarmSound) {
                alarmSound.play().catch(e => console.log('ì•ŒëŒìŒ ì¬ìƒ ì‹¤íŒ¨:', e));
                
                // 3ì´ˆ í›„ ìë™ ì¤‘ì§€
                setTimeout(() => {
                    if (alarmSound && !alarmSound.paused) {
                        alarmSound.pause();
                        alarmSound.currentTime = 0;
                    }
                }, 3000);
            }
        }

        function stopAlarm() {
            if (alarmSound) {
                alarmSound.pause();
                alarmSound.currentTime = 0;
            }
        }

        function updateMonitoringInfo(stationCount, interval = null, detectedLines = 0) {
            // GPS ëª¨ë“œì™€ ìˆ˜ë™ ëª¨ë“œ êµ¬ë¶„
            const isGPSMode = document.getElementById('gps-mode').classList.contains('active');
            
            if (isGPSMode) {
                // GPS ëª¨ë“œ ì—…ë°ì´íŠ¸
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
                document.getElementById('nearby-stations-count').textContent = stationCount;
                document.getElementById('detected-lines').textContent = `${detectedLines}ê°œ`;
                
                if (interval) {
                    const intervalText = interval >= 60000 ? 
                        `${interval/60000}ë¶„` : 
                        `${interval/1000}ì´ˆ`;
                    document.getElementById('current-interval').textContent = intervalText;
                }
                
                // GPS ëª¨ë“œ ê²½ê³  ìƒíƒœ ì—…ë°ì´íŠ¸
                const warningStatusElement = document.getElementById('warning-status');
                if (currentWarningState.isActive) {
                    const duration = Math.floor((new Date() - currentWarningState.warningStartTime) / 1000);
                    warningStatusElement.textContent = `ğŸš¨ ê²½ê³  ì¤‘ (${duration}ì´ˆ)`;
                    warningStatusElement.style.color = '#f44336';
                    warningStatusElement.style.fontWeight = 'bold';
                } else {
                    warningStatusElement.textContent = 'âœ… ì•ˆì „';
                    warningStatusElement.style.color = '#4caf50';
                    warningStatusElement.style.fontWeight = 'normal';
                }
            } else {
                // ìˆ˜ë™ ëª¨ë“œ ì—…ë°ì´íŠ¸
                document.getElementById('manual-last-update').textContent = new Date().toLocaleTimeString();
                document.getElementById('manual-nearby-stations-count').textContent = stationCount;
                document.getElementById('manual-detected-lines').textContent = `${detectedLines}ê°œ`;
                
                if (interval) {
                    const intervalText = interval >= 60000 ? 
                        `${interval/60000}ë¶„` : 
                        `${interval/1000}ì´ˆ`;
                    document.getElementById('manual-current-interval').textContent = intervalText;
                }
                
                // ìˆ˜ë™ ëª¨ë“œ ê²½ê³  ìƒíƒœ ì—…ë°ì´íŠ¸
                const manualWarningStatusElement = document.getElementById('manual-warning-status');
                if (currentWarningState.isActive) {
                    const duration = Math.floor((new Date() - currentWarningState.warningStartTime) / 1000);
                    manualWarningStatusElement.textContent = `ğŸš¨ ê²½ê³  ì¤‘ (${duration}ì´ˆ)`;
                    manualWarningStatusElement.style.color = '#f44336';
                    manualWarningStatusElement.style.fontWeight = 'bold';
                } else {
                    manualWarningStatusElement.textContent = 'âœ… ì•ˆì „';
                    manualWarningStatusElement.style.color = '#4caf50';
                    manualWarningStatusElement.style.fontWeight = 'normal';
                }
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-display');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // ë‘ ì§€ì  ê°„ì˜ ê±°ë¦¬ ê³„ì‚° (ë¯¸í„° ë‹¨ìœ„)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // Earth's radius in meters
            const Ï†1 = lat1 * Math.PI/180;
            const Ï†2 = lat2 * Math.PI/180;
            const Î”Ï† = (lat2-lat1) * Math.PI/180;
            const Î”Î» = (lng2-lng1) * Math.PI/180;

            const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c;
        }

        function getTrainTypeName(trainType) {
            const typeNames = {
                '01': 'KTX',
                '02': 'ìƒˆë§ˆì„í˜¸',
                '03': 'ë¬´ê¶í™”í˜¸',
                '04': 'ITX-ìƒˆë§ˆì„',
                '05': 'í™”ë¬¼ì—´ì°¨'
            };
            return typeNames[trainType] || 'ì¼ë°˜ì—´ì°¨';
        }

        // PWA ì§€ì›ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // í•„ìš”ì‹œ ì„œë¹„ìŠ¤ ì›Œì»¤ êµ¬í˜„
            });
        }
    </script>
</body>
</html>
