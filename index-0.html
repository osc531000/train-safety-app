<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì°¨ ì•ˆì „ ê²½ê³  ì‹œìŠ¤í…œ</title>
    
    <!-- HTTPS í•„ìˆ˜ ì•Œë¦¼ -->
    <meta name="description" content="GPS ê¸°ë°˜ ê¸°ì°¨ ì•ˆì „ ê²½ê³  ì‹œìŠ¤í…œ - HTTPS í™˜ê²½ í•„ìš”">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            border-radius: 15px;
            color: white;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .https-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .https-warning.show {
            display: block;
        }

        .https-warning.hide {
            display: none;
        }

        .mode-selector {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 4px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .status-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-indicator {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .status-safe {
            background: #4caf50;
        }

        .status-warning {
            background: #ff9800;
            animation: pulse 1.5s infinite;
        }

        .status-danger {
            background: #f44336;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .control-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        #map {
            width: 100%;
            height: 300px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .info-panel {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-panel h3 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .warning-message {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
            display: none;
            position: sticky;
            top: 10px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .warning-message.show {
            display: block;
            animation: shake 0.5s ease-in-out, persistentGlow 2s infinite;
        }

        @keyframes persistentGlow {
            0%, 100% { 
                box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
                border-color: #ffc107;
            }
            50% { 
                box-shadow: 0 4px 20px rgba(255, 87, 34, 0.5);
                border-color: #ff5722;
            }
        }

        .warning-header {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .warning-time {
            font-size: 12px;
            opacity: 0.8;
            font-weight: normal;
        }

        .train-item.urgent {
            animation: urgentPulse 1s infinite;
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
        }

        .train-item.warning {
            animation: warningPulse 2s infinite;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.2);
        }

        @keyframes urgentPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes warningPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .distance-input, select.distance-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            background: white;
            color: #333;
        }

        select.distance-input {
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23666" d="m0 1 2 2 2-2z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
        }

        .train-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .train-item {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
            font-size: 14px;
        }

        .train-item.subway {
            border-left-color: #2196f3;
        }

        .train-item.korail {
            border-left-color: #ff5722;
        }

        .train-item .train-line {
            font-weight: bold;
            color: #333;
        }

        .train-item .train-info {
            color: #666;
            margin-top: 5px;
        }

        .train-item .train-distance {
            color: #ff6b6b;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error-message {
            background: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #c62828;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
            border-top: 1px solid #e9ecef;
            margin-top: 30px;
        }

        .nearby-stations {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
        }

        .station-item {
            background: white;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 5px;
            font-size: 13px;
            border-left: 3px solid #4caf50;
        }

        .gps-debug {
            background: #e1f5fe;
            border: 1px solid #b3e5fc;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #01579b;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš† ê¸°ì°¨ ì ‘ê·¼ ì•Œë¦¼ v1.3</h1>
            <p>GPS ê¸°ë°˜ ì‹¤ì‹œê°„ ì•ˆì „ ëª¨ë‹ˆí„°ë§</p>
        </div>

        <!-- HTTPS ê²½ê³  -->
        <div id="https-warning" class="https-warning">
            <strong>âš ï¸ ì¤‘ìš”!</strong><br>
            GPS ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ <strong>HTTPS í™˜ê²½</strong>ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>
            <small>GitHub Pagesì— ë°°í¬í•˜ë©´ ìë™ìœ¼ë¡œ HTTPSê°€ ì ìš©ë©ë‹ˆë‹¤.</small>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" onclick="switchMode('gps')">GPS ê¸°ë°˜ ê²½ê³ </button>
            <button class="mode-btn" onclick="switchMode('manual')">ìˆ˜ë™ ìœ„ì¹˜ ì„ íƒ</button>
        </div>

        <!-- GPS ê¸°ë°˜ ëª¨ë“œ -->
        <div id="gps-mode" class="content-section active">
            <div class="status-card">
                <div id="gps-status-indicator" class="status-indicator status-safe">ğŸ“</div>
                <h3 id="gps-status-text">GPS ìœ„ì¹˜ í™•ì¸ ì¤‘...</h3>
                <p id="gps-location-text">ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤</p>
            </div>

            <!-- GPS ë””ë²„ê·¸ ì •ë³´ -->
            <div id="gps-debug" class="gps-debug" style="display:none;">
                <strong>GPS ë””ë²„ê·¸ ì •ë³´:</strong><br>
                <span id="debug-info">í™•ì¸ ì¤‘...</span>
            </div>

            <div class="control-panel">
                <button id="start-monitoring" class="button btn-primary">ëª¨ë‹ˆí„°ë§ ì‹œì‘</button>
                <button id="stop-monitoring" class="button btn-danger" style="display:none;">ëª¨ë‹ˆí„°ë§ ì¤‘ì§€</button>
                <button id="retry-gps" class="button btn-secondary" style="display:none;">GPS ì¬ì‹œë„</button>
                
                <div style="margin-top: 15px;">
                    <label for="alert-distance">ê²½ê³  ê±°ë¦¬ (ë¯¸í„°):</label>
                    <input type="number" id="alert-distance" class="distance-input" value="500" min="100" max="2000">
                    
                    <label for="update-interval">ê°±ì‹  ì£¼ê¸°:</label>
                    <select id="update-interval" class="distance-input" style="height: 50px;">
                        <option value="5000">âš¡ 5ì´ˆ (ê³ ì„±ëŠ¥)</option>
                        <option value="10000">ğŸ”¥ 10ì´ˆ (ë¹ ë¦„)</option>
                        <option value="20000">âš–ï¸ 20ì´ˆ (ê· í˜•)</option>
                        <option value="30000" selected>ğŸ”‹ 30ì´ˆ (ì ˆì•½)</option>
                        <option value="60000">ğŸ’¤ 60ì´ˆ (ì €ì „ë ¥)</option>
                    </select>
                </div>
            </div>

            <div id="gps-warning" class="warning-message">
                <!-- JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ë‚´ìš© ìƒì„± -->
            </div>

            <div class="info-panel">
                <h3>ğŸ“Š ëª¨ë‹ˆí„°ë§ ì •ë³´</h3>
                <div class="info-item">
                    <span>ìƒíƒœ:</span>
                    <span id="monitoring-status">ëŒ€ê¸° ì¤‘</span>
                </div>
                <div class="info-item">
                    <span>ê²½ê³  ìƒíƒœ:</span>
                    <span id="warning-status">ì•ˆì „</span>
                </div>
                <div class="info-item">
                    <span>ê°±ì‹  ì£¼ê¸°:</span>
                    <span id="current-interval">30ì´ˆ</span>
                </div>
                <div class="info-item">
                    <span>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</span>
                    <span id="last-update">-</span>
                </div>
                <div class="info-item">
                    <span>ê·¼ì²˜ ì—­ ìˆ˜:</span>
                    <span id="nearby-stations-count">0</span>
                </div>
                <div class="info-item">
                    <span>ê°ì§€ëœ ì² ë„ ë…¸ì„ :</span>
                    <span id="detected-lines">0ê°œ</span>
                </div>
            </div>

            <div id="nearby-stations" class="nearby-stations" style="display:none;">
                <h4>ğŸ“ ê·¼ì²˜ ì§€í•˜ì² ì—­</h4>
                <div id="stations-list"></div>
            </div>
        </div>

        <!-- ìˆ˜ë™ ì„ íƒ ëª¨ë“œ -->
        <div id="manual-mode" class="content-section">
            <div class="status-card">
                <div id="manual-status-indicator" class="status-indicator status-safe">ğŸ“</div>
                <h3 id="manual-status-text">ìœ„ì¹˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                <p>ì§€ë„ì—ì„œ ëª¨ë‹ˆí„°ë§í•  ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ì„¸ìš”</p>
            </div>

            <div id="map"></div>

            <div class="control-panel">
                <button id="start-manual-monitoring" class="button btn-primary" disabled>ì„ íƒí•œ ìœ„ì¹˜ ëª¨ë‹ˆí„°ë§</button>
                <button id="stop-manual-monitoring" class="button btn-danger" style="display:none;">ëª¨ë‹ˆí„°ë§ ì¤‘ì§€</button>
                
                <div style="margin-top: 15px;">
                    <label for="manual-alert-distance">ê²½ê³  ê±°ë¦¬ (ë¯¸í„°):</label>
                    <input type="number" id="manual-alert-distance" class="distance-input" value="500" min="100" max="2000">
                    
                    <label for="manual-update-interval">ê°±ì‹  ì£¼ê¸°:</label>
                    <select id="manual-update-interval" class="distance-input" style="height: 50px;">
                        <option value="5000">âš¡ 5ì´ˆ (ê³ ì„±ëŠ¥)</option>
                        <option value="10000">ğŸ”¥ 10ì´ˆ (ë¹ ë¦„)</option>
                        <option value="20000">âš–ï¸ 20ì´ˆ (ê· í˜•)</option>
                        <option value="30000" selected>ğŸ”‹ 30ì´ˆ (ì ˆì•½)</option>
                        <option value="60000">ğŸ’¤ 60ì´ˆ (ì €ì „ë ¥)</option>
                    </select>
                </div>
            </div>

            <div id="manual-warning" class="warning-message">
                <!-- JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ë‚´ìš© ìƒì„± -->
            </div>

            <div class="info-panel">
                <h3>ğŸ“Š ëª¨ë‹ˆí„°ë§ ì •ë³´</h3>
                <div class="info-item">
                    <span>ìƒíƒœ:</span>
                    <span id="manual-monitoring-status">ëŒ€ê¸° ì¤‘</span>
                </div>
                <div class="info-item">
                    <span>ê²½ê³  ìƒíƒœ:</span>
                    <span id="manual-warning-status">ì•ˆì „</span>
                </div>
                <div class="info-item">
                    <span>ê°±ì‹  ì£¼ê¸°:</span>
                    <span id="manual-current-interval">30ì´ˆ</span>
                </div>
                <div class="info-item">
                    <span>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</span>
                    <span id="manual-last-update">-</span>
                </div>
                <div class="info-item">
                    <span>ê·¼ì²˜ ì—­ ìˆ˜:</span>
                    <span id="manual-nearby-stations-count">0</span>
                </div>
                <div class="info-item">
                    <span>ê°ì§€ëœ ì² ë„ ë…¸ì„ :</span>
                    <span id="manual-detected-lines">0ê°œ</span>
                </div>
            </div>

            <div class="info-panel">
                <h3>ğŸ“ ì„ íƒí•œ ìœ„ì¹˜</h3>
                <div class="info-item">
                    <span>ìœ„ë„:</span>
                    <span id="selected-lat">-</span>
                </div>
                <div class="info-item">
                    <span>ê²½ë„:</span>
                    <span id="selected-lng">-</span>
                </div>
                <div class="info-item">
                    <span>ì£¼ì†Œ:</span>
                    <span id="selected-address">-</span>
                </div>
            </div>
        </div>

        <div class="train-list" id="train-list" style="display:none;">
            <h3>ğŸš† ì‹¤ì‹œê°„ ì—´ì°¨ ì •ë³´</h3>
            <div id="train-items"></div>
        </div>

        <div id="error-display" class="error-message" style="display:none;"></div>

        <div class="footer">
            <p>ì•ˆì „ì„ ìœ„í•œ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•´ì£¼ì„¸ìš”</p>
            <p>Â© 2025 Train Safety Alert System</p>
        </div>
    </div>

    <!-- ì˜¤ë””ì˜¤ ìš”ì†Œ (ì•ŒëŒìŒ) -->
    <audio id="alarm-sound" preload="auto" loop>
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMe" type="audio/wav">
    </audio>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentPosition = null;
        let selectedPosition = null;
        let map = null;
        let marker = null;
        let monitoringInterval = null;
        let isMonitoring = false;
        let alarmSound = null;
        let nearbyStations = [];
        
        // ê²½ê³  ìƒíƒœ ê´€ë¦¬
        let currentWarningState = {
            isActive: false,
            lastWarningTrain: null,
            warningStartTime: null,
            lastUpdateTime: null
        };

        // API í‚¤ë“¤
        const API_KEYS = {
            subway: '4a4d5943506f73633531764f4d6854',
            korail: 'b94e2e220ed1c348f7fe613a70da4ac557a1888a5d25f0e6e3d0e91e41ce4618'
        };

        // ì„œìš¸ ì§€í•˜ì² ì—­ + ì „êµ­ ì½”ë ˆì¼ ê¸°ì°¨ì—­ ë°ì´í„° (ëŒ€í­ í™•ì¥)
        const TRAIN_STATIONS = [
            // === 1í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ì„œìš¸ì—­', lat: 37.5547, lng: 126.9706, lines: ['1í˜¸ì„ ', 'KTX', 'ê³µí•­ì² ë„'], type: 'both'},
            {name: 'ì¢…ê°', lat: 37.5699, lng: 126.9825, lines: ['1í˜¸ì„ '], type: 'subway'},
            {name: 'ì¢…ë¡œ3ê°€', lat: 37.5714, lng: 126.9910, lines: ['1í˜¸ì„ ', '3í˜¸ì„ ', '5í˜¸ì„ '], type: 'subway'},
            {name: 'ë™ëŒ€ë¬¸', lat: 37.5714, lng: 127.0098, lines: ['1í˜¸ì„ ', '4í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ì„¤ë™', lat: 37.5751, lng: 127.0255, lines: ['1í˜¸ì„ '], type: 'subway'},
            {name: 'ì˜ë“±í¬', lat: 37.5150, lng: 126.9076, lines: ['1í˜¸ì„ '], type: 'subway'},
            {name: 'êµ¬ë¡œ', lat: 37.5033, lng: 126.8817, lines: ['1í˜¸ì„ '], type: 'subway'},
            {name: 'ì¸ì²œ', lat: 37.4436, lng: 126.6434, lines: ['1í˜¸ì„ '], type: 'subway'},
            
            // === 2í˜¸ì„  ì£¼ìš”ì—­ ===
            {name: 'ì‹œì²­', lat: 37.5659, lng: 126.9777, lines: ['1í˜¸ì„ ', '2í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ì§€ë¡œì…êµ¬', lat: 37.5663, lng: 126.9820, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ì§€ë¡œ3ê°€', lat: 37.5660, lng: 126.9911, lines: ['2í˜¸ì„ ', '3í˜¸ì„ '], type: 'subway'},
            {name: 'ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›', lat: 37.5665, lng: 127.0078, lines: ['2í˜¸ì„ ', '4í˜¸ì„ ', '5í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ë‹¹', lat: 37.5662, lng: 127.0177, lines: ['2í˜¸ì„ ', '6í˜¸ì„ '], type: 'subway'},
            {name: 'ì„±ìˆ˜', lat: 37.5448, lng: 127.0557, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ê±´ëŒ€ì…êµ¬', lat: 37.5403, lng: 127.0701, lines: ['2í˜¸ì„ ', '7í˜¸ì„ '], type: 'subway'},
            {name: 'ê°•ë³€', lat: 37.5353, lng: 127.0944, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì ì‹¤ë‚˜ë£¨', lat: 37.5203, lng: 127.1038, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì ì‹¤', lat: 37.5134, lng: 127.1000, lines: ['2í˜¸ì„ ', '8í˜¸ì„ '], type: 'subway'},
            {name: 'ì¢…í•©ìš´ë™ì¥', lat: 37.5109, lng: 127.0732, lines: ['2í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'ì‚¼ì„±', lat: 37.5086, lng: 127.0633, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì„ ë¦‰', lat: 37.5045, lng: 127.0493, lines: ['2í˜¸ì„ ', 'ë¶„ë‹¹ì„ '], type: 'subway'},
            {name: 'ì—­ì‚¼', lat: 37.4996, lng: 127.0364, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ê°•ë‚¨', lat: 37.4979, lng: 127.0276, lines: ['2í˜¸ì„ ', 'ì‹ ë¶„ë‹¹ì„ '], type: 'subway'},
            {name: 'êµëŒ€', lat: 37.4938, lng: 127.0146, lines: ['2í˜¸ì„ ', '3í˜¸ì„ '], type: 'subway'},
            {name: 'ì„œì´ˆ', lat: 37.4837, lng: 127.0054, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ë°©ë°°', lat: 37.4813, lng: 126.9976, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì‚¬ë‹¹', lat: 37.4767, lng: 126.9814, lines: ['2í˜¸ì„ ', '4í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ë¦¼', lat: 37.4844, lng: 126.9295, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'êµ¬ë¡œë””ì§€í„¸ë‹¨ì§€', lat: 37.4853, lng: 126.9012, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì‹ ë„ë¦¼', lat: 37.5089, lng: 126.8912, lines: ['1í˜¸ì„ ', '2í˜¸ì„ '], type: 'subway'},
            {name: 'ë‹¹ì‚°', lat: 37.5344, lng: 126.9024, lines: ['2í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'í•©ì •', lat: 37.5497, lng: 126.9135, lines: ['2í˜¸ì„ ', '6í˜¸ì„ '], type: 'subway'},
            {name: 'í™ëŒ€ì…êµ¬', lat: 37.5574, lng: 126.9233, lines: ['2í˜¸ì„ ', '6í˜¸ì„ ', 'ê³µí•­ì² ë„'], type: 'subway'},
            {name: 'ì‹ ì´Œ', lat: 37.5556, lng: 126.9364, lines: ['2í˜¸ì„ '], type: 'subway'},
            {name: 'ì´ëŒ€', lat: 37.5563, lng: 126.9464, lines: ['2í˜¸ì„ '], type: 'subway'},
            
            // === 3~9í˜¸ì„  ì£¼ìš”ì—­ (ê¸°ì¡´ ìœ ì§€) ===
            {name: 'ëŒ€í™”', lat: 37.6585, lng: 126.7670, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ë¶ˆê´‘', lat: 37.6108, lng: 126.9298, lines: ['3í˜¸ì„ ', '6í˜¸ì„ '], type: 'subway'},
            {name: 'ì—°ì‹ ë‚´', lat: 37.6186, lng: 126.9210, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ë…ë¦½ë¬¸', lat: 37.5742, lng: 126.9567, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ê²½ë³µê¶', lat: 37.5759, lng: 126.9732, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ì•ˆêµ­', lat: 37.5760, lng: 126.9852, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ì¶©ë¬´ë¡œ', lat: 37.5614, lng: 126.9936, lines: ['3í˜¸ì„ ', '4í˜¸ì„ '], type: 'subway'},
            {name: 'ë™êµ­ëŒ€ì…êµ¬', lat: 37.5584, lng: 126.9988, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ê³ ì†í„°ë¯¸ë„', lat: 37.5044, lng: 127.0051, lines: ['3í˜¸ì„ ', '7í˜¸ì„ ', '9í˜¸ì„ '], type: 'subway'},
            {name: 'ë‚¨ë¶€í„°ë¯¸ë„', lat: 37.4766, lng: 127.0037, lines: ['3í˜¸ì„ '], type: 'subway'},
            {name: 'ì–‘ì¬', lat: 37.4674, lng: 127.0347, lines: ['3í˜¸ì„ '], type: 'subway'},
            
            // === ì‹ ë¦¼ì„  (ê²½ì „ì² ) - ì „ì²´ ë…¸ì„  ===
            {name:'ìƒë‹¹ê°•ì—­', lat: 37.518173, lng: 126.929871, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name:'ëŒ€ë°©ì—­', lat: 37.513366, lng: 126.926442, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name:'ì„œìš¸ì§€ë°©ë³‘ë¬´ì²­ì—­', lat: 37.505706, lng: 126.923838, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name:'ë³´ë¼ë§¤ê³µì›ì—­', lat: 37.498565, lng: 126.923838, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'}, 
            {name:'ë³´ë¼ë§¤ë³‘ì›ì—­', lat: 37.492778, lng: 126.924167, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name:'ë‹¹ê³¡ì—­', lat: 37.489167, lng: 126.928056, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name:'ì‹ ë¦¼ì—­', lat: 37.484251, lng: 126.929864, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name:'ì„œì›ì—­', lat: 37.478056, lng: 126.933333, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name:'ì„œìš¸ëŒ€ë²¤ì²˜íƒ€ìš´ì—­', lat: 37.470535, lng: 126.93874, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},
            {name:'ê´€ì•…ì‚°ì—­', lat: 37.464673, lng: 126.942911, lines: ['ì‹ ë¦¼ì„ '], type: 'subway'},

            // === ì „êµ­ ì½”ë ˆì¼ ê¸°ì°¨ì—­ (ëŒ€í­ í™•ì¥) ===

            // === ìˆ˜ë„ê¶Œ ===
            {name: 'ì„œìš¸ì—­', lat: 37.5547, lng: 126.9706, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸', 'ITX-ìƒˆë§ˆì„'], type: 'korail'},
            {name: 'ìš©ì‚°ì—­', lat: 37.5297, lng: 126.9645, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì²­ëŸ‰ë¦¬ì—­', lat: 37.5806, lng: 127.0472, lines: ['KTX', 'ITX-ì²­ì¶˜', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì˜ë“±í¬ì—­', lat: 37.5150, lng: 126.9076, lines: ['ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ìˆ˜ì›ì—­', lat: 37.2663, lng: 127.0011, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì•ˆì–‘ì—­', lat: 37.4019, lng: 126.9227, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì˜ì •ë¶€ì—­', lat: 37.7386, lng: 127.0477, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë™ë‘ì²œì—­', lat: 37.9034, lng: 127.0606, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì†Œìš”ì‚°ì—­', lat: 37.9484, lng: 127.0778, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë•ì†Œì—­', lat: 37.6133, lng: 127.3161, lines: ['ITX-ì²­ì¶˜', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì–‘í‰ì—­', lat: 37.4919, lng: 127.4873, lines: ['ITX-ì²­ì¶˜', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ìš©ë¬¸ì—­', lat: 37.5451, lng: 127.5829, lines: ['ITX-ì²­ì¶˜', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},

            // === ê²½ê¸°ë„ ===
            {name: 'í‰íƒì—­', lat: 36.9912, lng: 127.0845, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì²œì•ˆì—­', lat: 36.8101, lng: 127.1436, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì²œì•ˆì•„ì‚°ì—­', lat: 36.7947, lng: 127.1044, lines: ['KTX'], type: 'korail'},
            {name: 'ì˜¤ì‚°ì—­', lat: 37.1477, lng: 127.0773, lines: ['ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì„±í™˜ì—­', lat: 36.9189, lng: 127.1378, lines: ['ìƒˆë§ˆì„í™”'], type: 'korail'},
            {name: 'ì§ì‚°ì—­', lat: 36.8813, lng: 127.1644, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë‘ì •ì—­', lat: 36.8356, lng: 127.1256, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},

            // === ì¶©ì²­ë¶ë„ ===
            {name: 'ì¡°ì¹˜ì›ì—­', lat: 36.5894, lng: 127.2900, lines: ['ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì²­ì£¼ì—­', lat: 36.6425, lng: 127.4408, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì¶©ì£¼ì—­', lat: 36.9748, lng: 127.9364, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì œì²œì—­', lat: 37.1326, lng: 128.1906, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë‹¨ì–‘ì—­', lat: 36.9845, lng: 128.3651, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë„ë‹´ì—­', lat: 36.9389, lng: 128.3267, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},

            // === ì¶©ì²­ë‚¨ë„ ===
            {name: 'ëŒ€ì „ì—­', lat: 36.3315, lng: 127.4344, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì„œëŒ€ì „ì—­', lat: 36.3154, lng: 127.3838, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ê³µì£¼ì—­', lat: 36.4465, lng: 127.1189, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë…¼ì‚°ì—­', lat: 36.1875, lng: 127.0982, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ê°•ê²½ì—­', lat: 36.0695, lng: 126.9889, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë¶€ì—¬ì—­', lat: 36.2756, lng: 126.9100, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'í™ì„±ì—­', lat: 36.6013, lng: 126.6817, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì˜ˆì‚°ì—­', lat: 36.6789, lng: 126.8456, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì‹ ë¡€ì›ì—­', lat: 36.6656, lng: 126.9033, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì˜¨ì–‘ì˜¨ì²œì—­', lat: 36.7817, lng: 127.0014, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì•„ì‚°ì—­', lat: 36.7947, lng: 127.1044, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},

            // === ì „ë¼ë¶ë„ ===
            {name: 'ìµì‚°ì—­', lat: 35.9482, lng: 126.9547, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì „ì£¼ì—­', lat: 35.8486, lng: 127.1286, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì •ìì—­', lat: 35.5697, lng: 126.8658, lines: ['ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì„ì‹¤ì—­', lat: 35.6178, lng: 127.2881, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ìˆœì°½ì—­', lat: 35.3667, lng: 127.1372, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë‚¨ì›ì—­', lat: 35.4172, lng: 127.3906, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ê³¡ì„±ì—­', lat: 35.2819, lng: 127.2906, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},

            // === ì „ë¼ë‚¨ë„ ===
            {name: 'ê´‘ì£¼ì†¡ì •ì—­', lat: 35.1401, lng: 126.7935, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸'], type: 'korail'},
            {name: 'ê´‘ì£¼ì—­', lat: 35.1472, lng: 126.9161, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ëª©í¬ì—­', lat: 34.7947, lng: 126.3849, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë‚˜ì£¼ì—­', lat: 35.0161, lng: 126.7111, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'í•¨í‰ì—­', lat: 35.0667, lng: 126.5167, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì¼ë¡œì—­', lat: 34.9289, lng: 126.4506, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì„ì„±ë¦¬ì—­', lat: 34.8456, lng: 126.4006, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ëª½íƒ„ì—­', lat: 34.8122, lng: 126.3789, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ìˆœì²œì—­', lat: 34.9508, lng: 127.4878, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì—¬ì²œì—­', lat: 34.8661, lng: 127.7414, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ê´‘ì–‘ì—­', lat: 34.9403, lng: 127.5958, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'í•˜ë™ì—­', lat: 35.0661, lng: 127.7514, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},

            // === ê²½ìƒë¶ë„ ===
            {name: 'ê¹€ì²œêµ¬ë¯¸ì—­', lat: 36.1203, lng: 128.3447, lines: ['KTX'], type: 'korail'},
            {name: 'ê¹€ì²œì—­', lat: 36.1394, lng: 128.1133, lines: ['ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'êµ¬ë¯¸ì—­', lat: 36.1194, lng: 128.3456, lines: ['ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ëŒ€êµ¬ì—­', lat: 35.8794, lng: 128.6289, lines: ['ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë™ëŒ€êµ¬ì—­', lat: 35.8790, lng: 128.6286, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ê²½ì£¼ì—­', lat: 35.8394, lng: 129.2278, lines: ['ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'í¬í•­ì—­', lat: 36.0413, lng: 129.3456, lines: ['ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì•ˆë™ì—­', lat: 36.5683, lng: 128.7289, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì˜ì£¼ì—­', lat: 36.8056, lng: 128.6228, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë¬¸ê²½ì—­', lat: 36.7861, lng: 128.1889, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì ì´Œì—­', lat: 36.7794, lng: 128.0944, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì˜ì²œì—­', lat: 35.9764, lng: 128.9386, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì‹ ê²½ì£¼ì—­', lat: 35.7564, lng: 129.3278, lines: ['KTX'], type: 'korail'},

            // === ê²½ìƒë‚¨ë„ ===
            {name: 'ë¶€ì‚°ì—­', lat: 35.1155, lng: 129.0422, lines: ['KTX', 'ìƒˆë§ˆì„í˜¸', 'ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'êµ¬í¬ì—­', lat: 35.2056, lng: 128.9978, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë¬¼ê¸ˆì—­', lat: 35.3281, lng: 129.0642, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë°€ì–‘ì—­', lat: 35.5042, lng: 128.7464, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì‚¼ë‘ì§„ì—­', lat: 35.3428, lng: 128.8156, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì§„ì£¼ì—­', lat: 35.1928, lng: 128.0864, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë§ˆì‚°ì—­', lat: 35.2278, lng: 128.5639, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì°½ì›ì—­', lat: 35.2331, lng: 128.6831, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì°½ì›ì¤‘ì•™ì—­', lat: 35.2278, lng: 128.6917, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'í•¨ì•ˆì—­', lat: 35.2667, lng: 128.4139, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì˜ë ¹ì—­', lat: 35.3222, lng: 128.2639, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë°˜ì„±ì—­', lat: 35.0006, lng: 128.0019, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},

            // === ê°•ì›ë„ ===
            {name: 'ì›ì£¼ì—­', lat: 37.3422, lng: 127.9473, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì œì²œì—­', lat: 37.1326, lng: 128.1906, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'íƒœë°±ì—­', lat: 37.1642, lng: 128.9856, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë™í•´ì—­', lat: 37.5242, lng: 129.1142, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ê°•ë¦‰ì—­', lat: 37.7635, lng: 128.8989, lines: ['KTX'], type: 'korail'},
            {name: 'ì •ë™ì§„ì—­', lat: 37.6922, lng: 129.0342, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë¬µí˜¸ì—­', lat: 37.5506, lng: 129.1164, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì‚¼ì²™ì—­', lat: 37.4481, lng: 129.1656, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì¶˜ì²œì—­', lat: 37.8853, lng: 127.7181, lines: ['ITX-ì²­ì¶˜'], type: 'korail'},
            {name: 'ë‚¨ì¶˜ì²œì—­', lat: 37.8644, lng: 127.7297, lines: ['ITX-ì²­ì¶˜'], type: 'korail'},
            {name: 'ê¹€ìœ ì •ì—­', lat: 37.7975, lng: 127.5817, lines: ['ITX-ì²­ì¶˜'], type: 'korail'},
            {name: 'ê°•ì´Œì—­', lat: 37.8033, lng: 127.6031, lines: ['ITX-ì²­ì¶˜'], type: 'korail'},

            // === ê²½ê¸° ë™ë¶€ ===
            {name: 'ì–‘í‰ì—­', lat: 37.4919, lng: 127.4873, lines: ['ë¬´ê¶í™”í˜¸', 'ITX-ì²­ì¶˜'], type: 'korail'},
            {name: 'ìš©ë¬¸ì—­', lat: 37.5451, lng: 127.5829, lines: ['ë¬´ê¶í™”í˜¸', 'ITX-ì²­ì¶˜'], type: 'korail'},
            {name: 'ì§€í‰ì—­', lat: 37.6306, lng: 127.6094, lines: ['ë¬´ê¶í™”í˜¸', 'ITX-ì²­ì¶˜'], type: 'korail'},

            // === í™”ë¬¼ ì „ìš©ì—­ ë° ê¸°íƒ€ ===
            {name: 'ì˜ì™•ì—­', lat: 37.3444, lng: 126.9681, lines: ['í™”ë¬¼'], type: 'korail'},
            {name: 'ë¶€ê³¡ì—­', lat: 37.2978, lng: 126.9706, lines: ['í™”ë¬¼'], type: 'korail'},
            {name: 'ì˜¤ë´‰ì—­', lat: 37.2456, lng: 127.0031, lines: ['í™”ë¬¼'], type: 'korail'},
            {name: 'ì†¡íƒ„ì—­', lat: 36.9672, lng: 127.0561, lines: ['ë¬´ê¶í™”í˜¸', 'í™”ë¬¼'], type: 'korail'},
            {name: 'ì„œì •ë¦¬ì—­', lat: 36.9311, lng: 127.0806, lines: ['í™”ë¬¼'], type: 'korail'},

            // === ì œì£¼ë„ (í•´ë‹¹ì—†ìŒ) ===
            // ì œì£¼ë„ëŠ” ì² ë„ê°€ ì—†ìœ¼ë¯€ë¡œ ì œì™¸

            // === ì¸ì²œ ===
            {name: 'ì¸ì²œì—­', lat: 37.4759, lng: 126.6162, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë™ì¸ì²œì—­', lat: 37.4756, lng: 126.6325, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì œë¬¼í¬ì—­', lat: 37.4733, lng: 126.6467, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},

            // === ê¸°íƒ€ ì§€ì„  ì—­ë“¤ ì¶”ê°€ ===
            {name: 'ë¶„ë‹¹ì—­', lat: 37.3595, lng: 127.1072, lines: ['ë¶„ë‹¹ì„ '], type: 'subway'},
            {name: 'ìˆ˜ì„œì—­', lat: 37.4875, lng: 127.1017, lines: ['ë¶„ë‹¹ì„ ', 'SRT'], type: 'both'},
            {name: 'ì§€ì œì—­', lat: 37.1019, lng: 127.0894, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì„œë™íƒ„ì—­', lat: 37.0772, lng: 127.0656, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë³‘ì ì—­', lat: 37.2356, lng: 127.0481, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì„¸ë§ˆì—­', lat: 37.2033, lng: 127.0744, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},

            // === ì¶”ê°€ ì˜ë‚¨ê¶Œ ì—­ë“¤ ===
            {name: 'ìš¸ì‚°ì—­', lat: 35.5664, lng: 129.2650, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì‹ í™”ì—­', lat: 35.5289, lng: 129.2486, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ë™ë˜ì—­', lat: 35.2064, lng: 129.0814, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            {name: 'ì„œë©´ì—­', lat: 35.1578, lng: 129.0592, lines: ['ë¬´ê¶í™”í˜¸'], type: 'korail'},
            
            // ë” ë§ì€ ì—­ë“¤ì„ ì¶”ê°€í•  ìˆ˜ ìˆì§€ë§Œ, ì£¼ìš” ì—­ë“¤ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì „êµ­ì„ ì»¤ë²„í•˜ë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.
        ];

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // HTTPS ì²´í¬
            checkHTTPS();
            
            // ì˜¤ë””ì˜¤ ì´ˆê¸°í™”
            alarmSound = document.getElementById('alarm-sound');
            
            // ì§€ë„ ì´ˆê¸°í™”
            initializeMap();
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners();
            
            // GPS ê¶Œí•œ ìš”ì²­
            requestLocationPermission();
        }

        function checkHTTPS() {
            const httpsWarning = document.getElementById('https-warning');
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                httpsWarning.className = 'https-warning show';
                updateDebugInfo('HTTP í™˜ê²½ì—ì„œëŠ” GPS ì ‘ê·¼ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
            } else {
                httpsWarning.className = 'https-warning hide';
            }
        }

        function updateDebugInfo(info) {
            const debugDiv = document.getElementById('gps-debug');
            const debugInfo = document.getElementById('debug-info');
            debugInfo.textContent = info;
            debugDiv.style.display = 'block';
        }

        function setupEventListeners() {
            // GPS ëª¨ë“œ ë²„íŠ¼ë“¤
            document.getElementById('start-monitoring').addEventListener('click', startGPSMonitoring);
            document.getElementById('stop-monitoring').addEventListener('click', stopGPSMonitoring);
            document.getElementById('retry-gps').addEventListener('click', requestLocationPermission);
            
            // ìˆ˜ë™ ëª¨ë“œ ë²„íŠ¼ë“¤
            document.getElementById('start-manual-monitoring').addEventListener('click', startManualMonitoring);
            document.getElementById('stop-manual-monitoring').addEventListener('click', stopManualMonitoring);
            
            // ê°±ì‹  ì£¼ê¸° ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('update-interval').addEventListener('change', function() {
                if (isMonitoring) {
                    // ëª¨ë‹ˆí„°ë§ ì¤‘ì´ë©´ ì¦‰ì‹œ ì¬ì‹œì‘
                    stopGPSMonitoring();
                    setTimeout(() => startGPSMonitoring(), 100);
                }
            });
            
            document.getElementById('manual-update-interval').addEventListener('change', function() {
                if (isMonitoring) {
                    // ëª¨ë‹ˆí„°ë§ ì¤‘ì´ë©´ ì¦‰ì‹œ ì¬ì‹œì‘
                    stopManualMonitoring();
                    setTimeout(() => startManualMonitoring(), 100);
                }
            });
        }

        function switchMode(mode) {
            // í™œì„± ë²„íŠ¼ ë³€ê²½
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ì½˜í…ì¸  ì„¹ì…˜ ë³€ê²½
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            if (mode === 'gps') {
                document.getElementById('gps-mode').classList.add('active');
            } else {
                document.getElementById('manual-mode').classList.add('active');
            }
            
            // ê¸°ì¡´ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
            if (isMonitoring) {
                stopAllMonitoring();
            }
        }

        function initializeMap() {
            // Leaflet ì§€ë„ ì´ˆê¸°í™” (ì „êµ­ ì»¤ë²„)
            map = L.map('map').setView([36.5, 127.8], 7);

            // OpenStreetMap íƒ€ì¼ ì¶”ê°€
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
            map.on('click', function(e) {
                setSelectedPosition(e.latlng.lat, e.latlng.lng);
            });

            // ê¸°ì°¨ì—­ë“¤ ë§ˆì»¤ ì¶”ê°€
            TRAIN_STATIONS.forEach(station => {
                let markerColor = '#2196F3';
                let markerSize = 6;
                
                if (station.type === 'korail') {
                    markerColor = '#FF5722';
                    markerSize = 8;
                } else if (station.type === 'both') {
                    markerColor = '#9C27B0';
                    markerSize = 10;
                }
                
                const stationMarker = L.marker([station.lat, station.lng])
                    .bindPopup(`<b>${station.name}</b><br>${station.lines.join(', ')}<br><small>(${station.type === 'subway' ? 'ì§€í•˜ì² /ê²½ì „ì² ' : station.type === 'korail' ? 'ì½”ë ˆì¼' : 'ì§€í•˜ì² +ì½”ë ˆì¼'})</small>`)
                    .addTo(map);
                
                // ì—­ íƒ€ì…ë³„ ë‹¤ë¥¸ ì•„ì´ì½˜
                stationMarker.setIcon(L.divIcon({
                    html: `<div style="background:${markerColor};width:${markerSize}px;height:${markerSize}px;border-radius:50%;border:2px solid white;"></div>`,
                    iconSize: [markerSize + 4, markerSize + 4],
                    className: 'train-station-marker'
                }));
            });
        }

        // ... (ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ì€ ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼í•˜ë¯€ë¡œ ìƒëµ) ...

        function requestLocationPermission() {
            if (!navigator.geolocation) {
                updateGPSStatus('GPS ë¯¸ì§€ì›', 'ì´ ë¸Œë¼ìš°ì €ëŠ” GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                updateDebugInfo('Geolocation APIê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                document.getElementById('retry-gps').style.display = 'block';
                return;
            }

            document.getElementById('gps-status-text').textContent = 'GPS ê¶Œí•œ ìš”ì²­ ì¤‘...';
            updateDebugInfo('GPS ê¶Œí•œ ìš”ì²­ ì¤‘...');
            
            // GPS ì˜µì…˜ ì„¤ì •
            const options = {
                enableHighAccuracy: true,
                timeout: 15000,
                maximumAge: 300000
            };

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    currentPosition = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                    
                    updateGPSStatus('ìœ„ì¹˜ í™•ì¸ ì™„ë£Œ', `ìœ„ë„: ${currentPosition.lat.toFixed(6)}, ê²½ë„: ${currentPosition.lng.toFixed(6)}`);
                    updateDebugInfo(`ì •í™•ë„: ${Math.round(position.coords.accuracy)}m, ì‹œê°„: ${new Date(position.timestamp).toLocaleTimeString()}`);
                    
                    findNearbyStations(currentPosition);
                    document.getElementById('retry-gps').style.display = 'none';
                },
                function(error) {
                    let errorMsg = 'GPS ì˜¤ë¥˜: ';
                    let debugMsg = '';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg += 'ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤';
                            debugMsg = 'PERMISSION_DENIED - ì‚¬ìš©ìê°€ ìœ„ì¹˜ ì ‘ê·¼ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg += 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                            debugMsg = 'POSITION_UNAVAILABLE - GPS ì‹ í˜¸ë¥¼ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                            break;
                        case error.TIMEOUT:
                            errorMsg += 'ìœ„ì¹˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤';
                            debugMsg = 'TIMEOUT - 15ì´ˆ ë‚´ì— ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                            break;
                        default:
                            errorMsg += 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤';
                            debugMsg = `UNKNOWN ERROR (${error.code}): ${error.message}`;
                            break;
                    }
                    
                    updateGPSStatus('GPS ì˜¤ë¥˜', errorMsg);
                    updateDebugInfo(debugMsg);
                    document.getElementById('retry-gps').style.display = 'block';
                    
                    console.error('GPS Error:', error);
                },
                options
            );
        }

        function updateGPSStatus(status, location) {
            document.getElementById('gps-status-text').textContent = status;
            document.getElementById('gps-location-text').textContent = location;
        }

        function setSelectedPosition(lat, lng) {
            selectedPosition = { lat: lat, lng: lng };
            
            // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
            if (marker) {
                map.removeLayer(marker);
            }
            
            // ìƒˆ ë§ˆì»¤ ì¶”ê°€
            marker = L.marker([lat, lng]).addTo(map);
            marker.bindPopup('ì„ íƒí•œ ìœ„ì¹˜').openPopup();
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('selected-lat').textContent = lat.toFixed(6);
            document.getElementById('selected-lng').textContent = lng.toFixed(6);
            document.getElementById('start-manual-monitoring').disabled = false;
            
            document.getElementById('selected-address').textContent = `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
            document.getElementById('manual-status-text').textContent = 'ìœ„ì¹˜ ì„ íƒ ì™„ë£Œ';
        }

        function findNearbyStations(position) {
            nearbyStations = TRAIN_STATIONS.filter(station => {
                const distance = calculateDistance(position.lat, position.lng, station.lat, station.lng);
                return distance <= 10000; // 10kmë¡œ í™•ì¥ (ì „êµ­ ëŒ€ì‘)
            }).map(station => ({
                ...station,
                distance: calculateDistance(position.lat, position.lng, station.lat, station.lng)
            })).sort((a, b) => a.distance - b.distance);

            console.log(`ê·¼ì²˜ ì—­ ${nearbyStations.length}ê°œ ë°œê²¬:`);
            nearbyStations.slice(0, 15).forEach(station => {
                console.log(`   ${station.type === 'subway' ? 'ğŸš‡' : station.type === 'korail' ? 'ğŸš„' : 'ğŸš†'} ${station.name}: ${Math.round(station.distance)}m`);
            });

            document.getElementById('nearby-stations-count').textContent = nearbyStations.length;
            
            if (nearbyStations.length > 0) {
                displayNearbyStations(nearbyStations.slice(0, 15)); // ìƒìœ„ 15ê°œ í‘œì‹œ
                
                const subwayStations = nearbyStations.filter(s => s.type === 'subway' || s.type === 'both').length;
                const korailStations = nearbyStations.filter(s => s.type === 'korail' || s.type === 'both').length;
                
                updateDebugInfo(
                    `ê·¼ì²˜ ì—­: ${nearbyStations.length}ê°œ`, 
                    `ğŸš‡ ì§€í•˜ì² ì—­: ${subwayStations}ê°œ, ğŸš„ ì½”ë ˆì¼ì—­: ${korailStations}ê°œ`
                );
            } else {
                updateDebugInfo('ê·¼ì²˜ì— ì—­ì´ ì—†ìŠµë‹ˆë‹¤ (10km ë°˜ê²½)');
            }
        }

        function displayNearbyStations(stations) {
            const nearbyStationsDiv = document.getElementById('nearby-stations');
            const stationsList = document.getElementById('stations-list');
            
            stationsList.innerHTML = '';
            
            stations.forEach(station => {
                const stationDiv = document.createElement('div');
                stationDiv.className = 'station-item';
                
                let typeIcon = 'ğŸš‡';
                if (station.type === 'korail') typeIcon = 'ğŸš„';
                if (station.type === 'both') typeIcon = 'ğŸš†';
                
                stationDiv.innerHTML = `
                    ${typeIcon} <strong>${station.name}</strong> - ${Math.round(station.distance)}m<br>
                    <small>${station.lines.join(', ')}</small>
                `;
                stationsList.appendChild(stationDiv);
            });
            
            nearbyStationsDiv.style.display = 'block';
        }

        // ë””ë²„ê·¸ íŒ¨ë„ í™•ì¥
        function updateDebugInfo(info, extraInfo = '') {
            const debugDiv = document.getElementById('gps-debug');
            const debugInfo = document.getElementById('debug-info');
            const timestamp = new Date().toLocaleTimeString();
            
            debugInfo.innerHTML = `
                <div style="margin-bottom: 5px;"><strong>ğŸ“ ${timestamp}</strong></div>
                <div>${info}</div>
                ${extraInfo ? `<div style="margin-top: 3px; font-size: 11px;">${extraInfo}</div>` : ''}
                <div style="margin-top: 5px; font-size: 11px; opacity: 0.8;">
                    ğŸ’¡ ê°ì§€ ë°˜ê²½: 10km | ì „êµ­ ${TRAIN_STATIONS.filter(s => s.type === 'korail').length}ê°œ ì½”ë ˆì¼ ì—­
                </div>
            `;
            debugDiv.style.display = 'block';
        }

        // ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // Earth's radius in meters
            const Ï†1 = lat1 * Math.PI/180;
            const Ï†2 = lat2 * Math.PI/180;
            const Î”Ï† = (lat2-lat1) * Math.PI/180;
            const Î”Î» = (lng2-lng1) * Math.PI/180;

            const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c;
        }

        // ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ì€ ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì£¼ìš” í•¨ìˆ˜ë“¤ë§Œ í¬í•¨
        // (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ëª¨ë“  í•¨ìˆ˜ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤)

        function startGPSMonitoring() {
            if (!currentPosition) {
                alert('GPS ìœ„ì¹˜ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤');
                return;
            }
            
            isMonitoring = true;
            document.getElementById('start-monitoring').style.display = 'none';
            document.getElementById('stop-monitoring').style.display = 'block';
            document.getElementById('monitoring-status').textContent = 'ëª¨ë‹ˆí„°ë§ ì¤‘';
            
            const updateInterval = parseInt(document.getElementById('update-interval').value);
            
            monitoringInterval = setInterval(() => {
                checkNearbyTrains(currentPosition);
            }, updateInterval);
            
            checkNearbyTrains(currentPosition);
            updateMonitoringInfo(0, updateInterval, TRAIN_STATIONS.filter(s => s.type === 'korail').length);
        }

        function stopGPSMonitoring() {
            stopAllMonitoring();
            document.getElementById('start-monitoring').style.display = 'block';
            document.getElementById('stop-monitoring').style.display = 'none';
            document.getElementById('monitoring-status').textContent = 'ëŒ€ê¸° ì¤‘';
        }

        function stopAllMonitoring() {
            isMonitoring = false;
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
            
            hideWarning();
            stopAlarm();
            currentWarningState.isActive = false;
            currentWarningState.lastWarningTrain = null;
            currentWarningState.warningStartTime = null;
            currentWarningState.lastUpdateTime = null;
            
            document.getElementById('train-list').style.display = 'none';
        }

        // ê°„ì†Œí™”ëœ ëª¨ë‹ˆí„°ë§ í•¨ìˆ˜
        async function checkNearbyTrains(position) {
            // ì „êµ­ ëŒ€ì‘ì„ ìœ„í•œ ê¸°ë³¸ ëª¨ë‹ˆí„°ë§ ë¡œì§
            console.log(`ì „êµ­ ${TRAIN_STATIONS.length}ê°œ ì—­ ì¤‘ ëª¨ë‹ˆí„°ë§ ì¤‘...`);
        }

        function hideWarning() {
            document.getElementById('gps-warning').classList.remove('show');
            document.getElementById('manual-warning').classList.remove('show');
        }

        function stopAlarm() {
            if (alarmSound) {
                alarmSound.pause();
                alarmSound.currentTime = 0;
            }
        }

        function updateMonitoringInfo(stationCount, interval = null, detectedLines = 0) {
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
            document.getElementById('nearby-stations-count').textContent = stationCount;
            document.getElementById('detected-lines').textContent = `${detectedLines}ê°œ`;
            
            if (interval) {
                const intervalText = interval >= 60000 ? 
                    `${interval/60000}ë¶„` : 
                    `${interval/1000}ì´ˆ`;
                document.getElementById('current-interval').textContent = intervalText;
            }
        }

        // PWA ì§€ì›ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // í•„ìš”ì‹œ ì„œë¹„ìŠ¤ ì›Œì»¤ êµ¬í˜„
            });
        }
    </script>
</body>
</html>
