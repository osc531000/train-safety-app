<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÜ Ïó¥Ï∞® Ï†ëÍ∑º ÏòàÏ∏° ÏãúÏä§ÌÖú (ÍµêÏú°Ïö©)</title>
    
    <!-- HTTPS ÌïÑÏàò ÏïåÎ¶º -->
    <meta name="description" content="GPS Í∏∞Î∞ò ÏãúÍ∞Ñ ÏòàÏ∏° Ïó¥Ï∞® ÏïàÏ†Ñ Í≤ΩÍ≥† ÏãúÏä§ÌÖú - ÍµêÏú° Î∞è Ïó∞Íµ¨ Î™©Ï†Å">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            border-radius: 15px;
            color: white;
        }

        .header h1 {
            font-size: 22px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 13px;
        }

        .education-notice {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
        }

        .education-notice strong {
            color: #1976d2;
            display: block;
            margin-bottom: 8px;
        }

        .https-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .https-warning.show {
            display: block;
        }

        .https-warning.hide {
            display: none;
        }

        .mode-selector {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 4px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .status-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-indicator {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .status-safe {
            background: #4caf50;
        }

        .status-warning {
            background: #ff9800;
            animation: pulse 1.5s infinite;
        }

        .status-danger {
            background: #f44336;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .control-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        #map {
            width: 100%;
            height: 300px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .info-panel {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-panel h3 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .prediction-panel {
            background: #f3e5f5;
            border: 2px solid #9c27b0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .prediction-panel h3 {
            color: #7b1fa2;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .warning-message {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
            display: none;
            position: sticky;
            top: 10px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .warning-message.show {
            display: block;
            animation: shake 0.5s ease-in-out, persistentGlow 2s infinite;
        }

        @keyframes persistentGlow {
            0%, 100% { 
                box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
                border-color: #ffc107;
            }
            50% { 
                box-shadow: 0 4px 20px rgba(255, 87, 34, 0.5);
                border-color: #ff5722;
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .warning-header {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .warning-time {
            font-size: 12px;
            opacity: 0.8;
            font-weight: normal;
        }

        .train-item.urgent {
            animation: urgentPulse 1s infinite;
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
        }

        .train-item.warning {
            animation: warningPulse 2s infinite;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.2);
        }

        @keyframes urgentPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes warningPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .distance-input, select.distance-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            background: white;
            color: #333;
        }

        select.distance-input {
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23666" d="m0 1 2 2 2-2z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
        }

        .train-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .train-item {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
            font-size: 14px;
        }

        .train-item.subway {
            border-left-color: #2196f3;
        }

        .train-item.korail {
            border-left-color: #ff5722;
        }

        .train-item .train-line {
            font-weight: bold;
            color: #333;
        }

        .train-item .train-info {
            color: #666;
            margin-top: 5px;
        }

        .train-item .train-distance {
            color: #ff6b6b;
            font-weight: bold;
        }

        .prediction-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid #9c27b0;
        }

        .prediction-item.imminent {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .prediction-item.warning {
            border-left-color: #ff9800;
            background: #fff8e1;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error-message {
            background: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #c62828;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
            border-top: 1px solid #e9ecef;
            margin-top: 30px;
        }

        .gps-debug {
            background: #e1f5fe;
            border: 1px solid #b3e5fc;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #01579b;
        }

        .countdown-display {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .countdown-safe { background: #e8f5e8; color: #2e7d32; }
        .countdown-warning { background: #fff3e0; color: #f57c00; }
        .countdown-danger { background: #ffebee; color: #c62828; }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÜ Ïó¥Ï∞® Ï†ëÍ∑º ÏòàÏ∏° ÏãúÏä§ÌÖú v2.0</h1>
            <p>GPS + Ïö¥ÌñâÏ†ïÎ≥¥ Í∏∞Î∞ò ÏãúÍ∞Ñ ÏòàÏ∏° Í≤ΩÍ≥† (ÍµêÏú°Ïö©)</p>
        </div>

        <!-- ÍµêÏú°Ïö© ÏïåÎ¶º -->
        <div class="education-notice">
            <strong>üìö ÍµêÏú° Î∞è Ïó∞Íµ¨ Î™©Ï†Å ÏãúÏä§ÌÖú</strong>
            Ïù¥ ÏãúÏä§ÌÖúÏùÄ ÍµêÏú°Ïö© Îç∞Î™®ÏûÖÎãàÎã§. Ïã§Ï†ú ÏïàÏ†ÑÏóê ÏùòÏ°¥ÌïòÏßÄ ÎßàÏÑ∏Ïöî.<br>
            Ïã§Ï†ú ÏÉÅÌô©ÏóêÏÑúÎäî Ìï≠ÏÉÅ ÏãúÍ∞ÅÏ†Å, Ï≤≠Í∞ÅÏ†Å ÌôïÏù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.
        </div>

        <!-- HTTPS Í≤ΩÍ≥† -->
        <div id="https-warning" class="https-warning">
            <strong>‚ö†Ô∏è Ï§ëÏöî!</strong><br>
            GPS Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Î©¥ <strong>HTTPS ÌôòÍ≤Ω</strong>Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.<br>
            <small>GitHub PagesÏóê Î∞∞Ìè¨ÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú HTTPSÍ∞Ä Ï†ÅÏö©Îê©ÎãàÎã§.</small>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" onclick="switchMode('gps')">GPS Í∏∞Î∞ò ÏòàÏ∏°</button>
            <button class="mode-btn" onclick="switchMode('manual')">ÏàòÎèô ÏúÑÏπò ÏÑ†ÌÉù</button>
        </div>

        <!-- GPS Í∏∞Î∞ò Î™®Îìú -->
        <div id="gps-mode" class="content-section active">
            <div class="status-card">
                <div id="gps-status-indicator" class="status-indicator status-safe">üìç</div>
                <h3 id="gps-status-text">GPS ÏúÑÏπò ÌôïÏù∏ Ï§ë...</h3>
                <p id="gps-location-text">ÏúÑÏπò Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§Í≥† ÏûàÏäµÎãàÎã§</p>
            </div>

            <!-- GPS ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥ -->
            <div id="gps-debug" class="gps-debug" style="display:none;">
                <strong>GPS ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥:</strong><br>
                <span id="debug-info">ÌôïÏù∏ Ï§ë...</span>
            </div>

            <div class="control-panel">
                <button id="start-monitoring" class="button btn-primary">ÏòàÏ∏° Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏûë</button>
                <button id="stop-monitoring" class="button btn-danger" style="display:none;">Î™®ÎãàÌÑ∞ÎßÅ Ï§ëÏßÄ</button>
                <button id="retry-gps" class="button btn-secondary" style="display:none;">GPS Ïû¨ÏãúÎèÑ</button>
                
                <div style="margin-top: 15px;">
                    <label for="alert-time">Í≤ΩÍ≥† ÏãúÍ∞Ñ (Ï¥à):</label>
                    <input type="number" id="alert-time" class="distance-input" value="120" min="30" max="300">
                    
                    <label for="update-interval">Í∞±Ïã† Ï£ºÍ∏∞:</label>
                    <select id="update-interval" class="distance-input" style="height: 50px;">
                        <option value="10000">‚ö° 10Ï¥à (Í≥†ÏÑ±Îä•)</option>
                        <option value="15000" selected>üî• 15Ï¥à (Í∂åÏû•)</option>
                        <option value="30000">‚öñÔ∏è 30Ï¥à (Í∑†Ìòï)</option>
                        <option value="60000">üîã 60Ï¥à (Ï†àÏïΩ)</option>
                    </select>
                </div>
            </div>

            <div id="gps-warning" class="warning-message">
                <!-- JavaScriptÏóêÏÑú ÎèôÏ†ÅÏúºÎ°ú ÎÇ¥Ïö© ÏÉùÏÑ± -->
            </div>

            <!-- ÏòàÏ∏° Ï†ïÎ≥¥ Ìå®ÎÑê -->
            <div id="prediction-panel" class="prediction-panel" style="display:none;">
                <h3>üîÆ Ïó¥Ï∞® Ï†ëÍ∑º ÏòàÏ∏°</h3>
                <div id="countdown-display" class="countdown-display countdown-safe">
                    ÏïàÏ†Ñ Íµ¨Í∞Ñ
                </div>
                <div id="predictions-list"></div>
            </div>

            <div class="info-panel">
                <h3>üìä Î™®ÎãàÌÑ∞ÎßÅ Ï†ïÎ≥¥</h3>
                <div class="info-item">
                    <span>ÏÉÅÌÉú:</span>
                    <span id="monitoring-status">ÎåÄÍ∏∞ Ï§ë</span>
                </div>
                <div class="info-item">
                    <span>Í≤ΩÍ≥† ÏÉÅÌÉú:</span>
                    <span id="warning-status">ÏïàÏ†Ñ</span>
                </div>
                <div class="info-item">
                    <span>ÏòàÏ∏° Î™®Îç∏:</span>
                    <span id="prediction-model">ÏãúÍ∞Ñ Í∏∞Î∞ò v2.0</span>
                </div>
                <div class="info-item">
                    <span>ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏:</span>
                    <span id="last-update">-</span>
                </div>
                <div class="info-item">
                    <span>Í∑ºÏ≤ò Ïó≠ Ïàò:</span>
                    <span id="nearby-stations-count">0</span>
                </div>
                <div class="info-item">
                    <span>ÌôúÏÑ± ÏòàÏ∏°:</span>
                    <span id="active-predictions">0Í∞ú</span>
                </div>
            </div>
        </div>

        <!-- ÏàòÎèô ÏÑ†ÌÉù Î™®Îìú -->
        <div id="manual-mode" class="content-section">
            <div class="status-card">
                <div id="manual-status-indicator" class="status-indicator status-safe">üìç</div>
                <h3 id="manual-status-text">ÏúÑÏπòÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</h3>
                <p>ÏßÄÎèÑÏóêÏÑú Î™®ÎãàÌÑ∞ÎßÅÌï† ÏúÑÏπòÎ•º ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî</p>
            </div>

            <div id="map"></div>

            <div class="control-panel">
                <button id="start-manual-monitoring" class="button btn-primary" disabled>ÏÑ†ÌÉùÌïú ÏúÑÏπò Î™®ÎãàÌÑ∞ÎßÅ</button>
                <button id="stop-manual-monitoring" class="button btn-danger" style="display:none;">Î™®ÎãàÌÑ∞ÎßÅ Ï§ëÏßÄ</button>
                
                <div style="margin-top: 15px;">
                    <label for="manual-alert-time">Í≤ΩÍ≥† ÏãúÍ∞Ñ (Ï¥à):</label>
                    <input type="number" id="manual-alert-time" class="distance-input" value="120" min="30" max="300">
                    
                    <label for="manual-update-interval">Í∞±Ïã† Ï£ºÍ∏∞:</label>
                    <select id="manual-update-interval" class="distance-input" style="height: 50px;">
                        <option value="10000">‚ö° 10Ï¥à (Í≥†ÏÑ±Îä•)</option>
                        <option value="15000" selected>üî• 15Ï¥à (Í∂åÏû•)</option>
                        <option value="30000">‚öñÔ∏è 30Ï¥à (Í∑†Ìòï)</option>
                        <option value="60000">üîã 60Ï¥à (Ï†àÏïΩ)</option>
                    </select>
                </div>
            </div>

            <div id="manual-warning" class="warning-message">
                <!-- JavaScriptÏóêÏÑú ÎèôÏ†ÅÏúºÎ°ú ÎÇ¥Ïö© ÏÉùÏÑ± -->
            </div>

            <!-- ÏàòÎèô Î™®Îìú ÏòàÏ∏° Ìå®ÎÑê -->
            <div id="manual-prediction-panel" class="prediction-panel" style="display:none;">
                <h3>üîÆ Ïó¥Ï∞® Ï†ëÍ∑º ÏòàÏ∏°</h3>
                <div id="manual-countdown-display" class="countdown-display countdown-safe">
                    ÏïàÏ†Ñ Íµ¨Í∞Ñ
                </div>
                <div id="manual-predictions-list"></div>
            </div>

            <div class="info-panel">
                <h3>üìä Î™®ÎãàÌÑ∞ÎßÅ Ï†ïÎ≥¥</h3>
                <div class="info-item">
                    <span>ÏÉÅÌÉú:</span>
                    <span id="manual-monitoring-status">ÎåÄÍ∏∞ Ï§ë</span>
                </div>
                <div class="info-item">
                    <span>Í≤ΩÍ≥† ÏÉÅÌÉú:</span>
                    <span id="manual-warning-status">ÏïàÏ†Ñ</span>
                </div>
                <div class="info-item">
                    <span>ÏòàÏ∏° Î™®Îç∏:</span>
                    <span id="manual-prediction-model">ÏãúÍ∞Ñ Í∏∞Î∞ò v2.0</span>
                </div>
                <div class="info-item">
                    <span>ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏:</span>
                    <span id="manual-last-update">-</span>
                </div>
                <div class="info-item">
                    <span>ÌôúÏÑ± ÏòàÏ∏°:</span>
                    <span id="manual-active-predictions">0Í∞ú</span>
                </div>
            </div>

            <div class="info-panel">
                <h3>üìç ÏÑ†ÌÉùÌïú ÏúÑÏπò</h3>
                <div class="info-item">
                    <span>ÏúÑÎèÑ:</span>
                    <span id="selected-lat">-</span>
                </div>
                <div class="info-item">
                    <span>Í≤ΩÎèÑ:</span>
                    <span id="selected-lng">-</span>
                </div>
                <div class="info-item">
                    <span>Ï£ºÏÜå:</span>
                    <span id="selected-address">-</span>
                </div>
            </div>
        </div>

        <div class="train-list" id="train-list" style="display:none;">
            <h3>üöÜ Ïã§ÏãúÍ∞Ñ Ïó¥Ï∞® Ï†ïÎ≥¥</h3>
            <div id="train-items"></div>
        </div>

        <div id="error-display" class="error-message" style="display:none;"></div>

        <div class="footer">
            <p><strong>‚ö†Ô∏è ÍµêÏú°Ïö© ÏãúÏä§ÌÖú ÏïàÏ†Ñ Í≤ΩÍ≥† ‚ö†Ô∏è</strong></p>
            <p>Ïù¥ ÏãúÏä§ÌÖúÏùÄ ÍµêÏú° Î™©Ï†ÅÏúºÎ°úÎßå Ï†úÏûëÎêòÏóàÏäµÎãàÎã§.</p>
            <p>Ïã§Ï†ú ÏïàÏ†ÑÏùÑ ÏúÑÌï¥ÏÑúÎäî Ìï≠ÏÉÅ ÌòÑÏû•Ïùò ÏãúÍ∞ÅÏ†Å, Ï≤≠Í∞ÅÏ†Å Ïã†Ìò∏Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.</p>
            <p>¬© 2025 Train Prediction System (Educational Purpose)</p>
        </div>
    </div>

    <!-- Ïò§ÎîîÏò§ ÏöîÏÜå (ÏïåÎûåÏùå) -->
    <audio id="alarm-sound" preload="auto" loop>
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMe" type="audio/wav">
    </audio>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentPosition = null;
        let selectedPosition = null;
        let map = null;
        let marker = null;
        let monitoringInterval = null;
        let isMonitoring = false;
        let alarmSound = null;
        let nearbyStations = [];
        let activePredictions = [];
        
        // Í≤ΩÍ≥† ÏÉÅÌÉú Í¥ÄÎ¶¨
        let currentWarningState = {
            isActive: false,
            lastWarningTrain: null,
            warningStartTime: null,
            lastUpdateTime: null,
            countdownValue: null
        };

        // Ïó¥Ï∞® ÏÜçÎèÑ Îç∞Ïù¥ÌÑ∞ (km/h)
        const TRAIN_SPEEDS = {
            subway: {
                average: 35,
                maxSpeed: 80,
                stationInterval: 1.2 // ÌèâÍ∑† Ïó≠Í∞Ñ Í±∞Î¶¨ (km)
            },
            korail: {
                KTX: { average: 200, maxSpeed: 305 },
                ÏÉàÎßàÏùÑÌò∏: { average: 120, maxSpeed: 150 },
                Î¨¥Í∂ÅÌôîÌò∏: { average: 90, maxSpeed: 120 },
                'ITX-Ï≤≠Ï∂ò': { average: 100, maxSpeed: 150 },
                ÌôîÎ¨ºÏó¥Ï∞®: { average: 60, maxSpeed: 85 }
            }
        };

        // API ÌÇ§Îì§
        const API_KEYS = {
            subway: '4a4d5943506f73633531764f4d6854',
            korail: 'b94e2e220ed1c348f7fe613a70da4ac557a1888a5d25f0e6e3d0e91e41ce4618'
        };

       // ÏÑúÏö∏ ÏßÄÌïòÏ≤†Ïó≠ + ÏΩîÎ†àÏùº Ï£ºÏöî Ïó≠ Îç∞Ïù¥ÌÑ∞ (ÏàòÏ†ï Î∞è Î≥¥ÏôÑ)
        const TRAIN_STATIONS = [
            // === 1Ìò∏ÏÑ† Ï£ºÏöîÏó≠ ===
            {name: 'ÏÑúÏö∏Ïó≠', lat: 37.5547, lng: 126.9706, lines: ['1Ìò∏ÏÑ†', 'KTX', 'Í≥µÌï≠Ï≤†ÎèÑ'], type: 'both'},
            {name: 'Ï¢ÖÍ∞Å', lat: 37.5699, lng: 126.9825, lines: ['1Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï¢ÖÎ°ú3Í∞Ä', lat: 37.5714, lng: 126.9910, lines: ['1Ìò∏ÏÑ†', '3Ìò∏ÏÑ†', '5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎèôÎåÄÎ¨∏', lat: 37.5714, lng: 127.0098, lines: ['1Ìò∏ÏÑ†', '4Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïã†ÏÑ§Îèô', lat: 37.5751, lng: 127.0255, lines: ['1Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏòÅÎì±Ìè¨', lat: 37.5150, lng: 126.9076, lines: ['1Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Íµ¨Î°ú', lat: 37.5033, lng: 126.8817, lines: ['1Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïù∏Ï≤ú', lat: 37.4436, lng: 126.6434, lines: ['1Ìò∏ÏÑ†'], type: 'subway'},
            
            // === 2Ìò∏ÏÑ† Ï£ºÏöîÏó≠ ===
            {name: 'ÏãúÏ≤≠', lat: 37.5659, lng: 126.9777, lines: ['1Ìò∏ÏÑ†', '2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏùÑÏßÄÎ°úÏûÖÍµ¨', lat: 37.5663, lng: 126.9820, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏùÑÏßÄÎ°ú3Í∞Ä', lat: 37.5660, lng: 126.9911, lines: ['2Ìò∏ÏÑ†', '3Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎèôÎåÄÎ¨∏Ïó≠ÏÇ¨Î¨∏ÌôîÍ≥µÏõê', lat: 37.5665, lng: 127.0078, lines: ['2Ìò∏ÏÑ†', '4Ìò∏ÏÑ†', '5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïã†Îãπ', lat: 37.5662, lng: 127.0177, lines: ['2Ìò∏ÏÑ†', '6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÑ±Ïàò', lat: 37.5448, lng: 127.0557, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í±¥ÎåÄÏûÖÍµ¨', lat: 37.5403, lng: 127.0701, lines: ['2Ìò∏ÏÑ†', '7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í∞ïÎ≥Ä', lat: 37.5353, lng: 127.0944, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïû†Ïã§ÎÇòÎ£®', lat: 37.5203, lng: 127.1038, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïû†Ïã§', lat: 37.5134, lng: 127.1000, lines: ['2Ìò∏ÏÑ†', '8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï¢ÖÌï©Ïö¥ÎèôÏû•', lat: 37.5109, lng: 127.0732, lines: ['2Ìò∏ÏÑ†', '9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÇºÏÑ±', lat: 37.5086, lng: 127.0633, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÑ†Î¶â', lat: 37.5045, lng: 127.0493, lines: ['2Ìò∏ÏÑ†', 'Î∂ÑÎãπÏÑ†'], type: 'subway'},
            {name: 'Ïó≠ÏÇº', lat: 37.4996, lng: 127.0364, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í∞ïÎÇ®', lat: 37.4979, lng: 127.0276, lines: ['2Ìò∏ÏÑ†', 'Ïã†Î∂ÑÎãπÏÑ†'], type: 'subway'},
            {name: 'ÍµêÎåÄ', lat: 37.4938, lng: 127.0146, lines: ['2Ìò∏ÏÑ†', '3Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÑúÏ¥à', lat: 37.4837, lng: 127.0054, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î∞©Î∞∞', lat: 37.4813, lng: 126.9976, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÇ¨Îãπ', lat: 37.4767, lng: 126.9814, lines: ['2Ìò∏ÏÑ†', '4Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïã†Î¶º', lat: 37.4844, lng: 126.9295, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Íµ¨Î°úÎîîÏßÄÌÑ∏Îã®ÏßÄ', lat: 37.4853, lng: 126.9012, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïã†ÎèÑÎ¶º', lat: 37.5089, lng: 126.8912, lines: ['1Ìò∏ÏÑ†', '2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎãπÏÇ∞', lat: 37.5344, lng: 126.9024, lines: ['2Ìò∏ÏÑ†', '9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ìï©Ï†ï', lat: 37.5497, lng: 126.9135, lines: ['2Ìò∏ÏÑ†', '6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÌôçÎåÄÏûÖÍµ¨', lat: 37.5574, lng: 126.9233, lines: ['2Ìò∏ÏÑ†', '6Ìò∏ÏÑ†', 'Í≥µÌï≠Ï≤†ÎèÑ'], type: 'subway'},
            {name: 'Ïã†Ï¥å', lat: 37.5556, lng: 126.9364, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïù¥ÎåÄ', lat: 37.5563, lng: 126.9464, lines: ['2Ìò∏ÏÑ†'], type: 'subway'},
            
            // === 3Ìò∏ÏÑ† Ï£ºÏöîÏó≠ ===
            {name: 'ÎåÄÌôî', lat: 37.6585, lng: 126.7670, lines: ['3Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î∂àÍ¥ë', lat: 37.6108, lng: 126.9298, lines: ['3Ìò∏ÏÑ†', '6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïó∞Ïã†ÎÇ¥', lat: 37.6186, lng: 126.9210, lines: ['3Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎèÖÎ¶ΩÎ¨∏', lat: 37.5742, lng: 126.9567, lines: ['3Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í≤ΩÎ≥µÍ∂Å', lat: 37.5759, lng: 126.9732, lines: ['3Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏïàÍµ≠', lat: 37.5760, lng: 126.9852, lines: ['3Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï∂©Î¨¥Î°ú', lat: 37.5614, lng: 126.9936, lines: ['3Ìò∏ÏÑ†', '4Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎèôÍµ≠ÎåÄÏûÖÍµ¨', lat: 37.5584, lng: 126.9988, lines: ['3Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í≥†ÏÜçÌÑ∞ÎØ∏ÎÑê', lat: 37.5044, lng: 127.0051, lines: ['3Ìò∏ÏÑ†', '7Ìò∏ÏÑ†', '9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎÇ®Î∂ÄÌÑ∞ÎØ∏ÎÑê', lat: 37.4766, lng: 127.0037, lines: ['3Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏñëÏû¨', lat: 37.4674, lng: 127.0347, lines: ['3Ìò∏ÏÑ†'], type: 'subway'},
            
            // === 4Ìò∏ÏÑ† Ï£ºÏöîÏó≠ ===
            {name: 'Î™ÖÎèô', lat: 37.5634, lng: 126.9864, lines: ['4Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÌöåÌòÑ', lat: 37.5592, lng: 126.9783, lines: ['4Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïù¥Ï¥å', lat: 37.5342, lng: 126.9675, lines: ['4Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎèôÏûë', lat: 37.5020, lng: 126.9788, lines: ['4Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïù¥Ïàò', lat: 37.4862, lng: 126.9816, lines: ['4Ìò∏ÏÑ†'], type: 'subway'},
            
            // === 5Ìò∏ÏÑ† Ï£ºÏöîÏó≠ ===
            {name: 'ÍπÄÌè¨Í≥µÌï≠', lat: 37.5588, lng: 126.8014, lines: ['5Ìò∏ÏÑ†', '9Ìò∏ÏÑ†', 'Í≥µÌï≠Ï≤†ÎèÑ'], type: 'subway'},
            {name: 'ÏÜ°Ï†ï', lat: 37.5616, lng: 126.8134, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎßàÍ≥°', lat: 37.5608, lng: 126.8250, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î∞úÏÇ∞', lat: 37.5587, lng: 126.8370, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïö∞Ïû•ÏÇ∞', lat: 37.5485, lng: 126.8361, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÌôîÍ≥°', lat: 37.5413, lng: 126.8396, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÍπåÏπòÏÇ∞', lat: 37.5312, lng: 126.8469, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïã†Ï†ï', lat: 37.5248, lng: 126.8567, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î™©Îèô', lat: 37.5268, lng: 126.8750, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïò§Î™©Íµê', lat: 37.5245, lng: 126.8957, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏñëÌèâ', lat: 37.5345, lng: 126.8905, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏòÅÎì±Ìè¨Íµ¨Ï≤≠', lat: 37.5245, lng: 126.8957, lines: ['2Ìò∏ÏÑ†', '5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïó¨ÏùòÎèÑ', lat: 37.5217, lng: 126.9244, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎßàÌè¨', lat: 37.5444, lng: 126.9458, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í≥µÎçï', lat: 37.5443, lng: 126.9490, lines: ['5Ìò∏ÏÑ†', '6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïï†Ïò§Í∞ú', lat: 37.5515, lng: 126.9565, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï∂©Ï†ïÎ°ú', lat: 37.5596, lng: 126.9635, lines: ['2Ìò∏ÏÑ†', '5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÑúÎåÄÎ¨∏', lat: 37.5656, lng: 126.9662, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í¥ëÌôîÎ¨∏', lat: 37.5715, lng: 126.9769, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï≤≠Íµ¨', lat: 37.5606, lng: 127.0149, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏôïÏã≠Î¶¨', lat: 37.5617, lng: 127.0378, lines: ['2Ìò∏ÏÑ†', '5Ìò∏ÏÑ†', 'Î∂ÑÎãπÏÑ†'], type: 'subway'},
            {name: 'ÌñâÎãπ', lat: 37.5575, lng: 127.0437, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎãµÏã≠Î¶¨', lat: 37.5664, lng: 127.0588, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïû•ÌïúÌèâ', lat: 37.5613, lng: 127.0644, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Íµ∞Ïûê', lat: 37.5571, lng: 127.0792, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏïÑÏ∞®ÏÇ∞', lat: 37.5572, lng: 127.1032, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í¥ëÎÇòÎ£®', lat: 37.5450, lng: 127.1081, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï≤úÌò∏', lat: 37.5387, lng: 127.1238, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í∞ïÎèô', lat: 37.5278, lng: 127.1316, lines: ['5Ìò∏ÏÑ†'], type: 'subway'},
            
            // === 6Ìò∏ÏÑ† Ï£ºÏöîÏó≠ ===
            {name: 'ÏùëÏïî', lat: 37.6016, lng: 126.9136, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïó≠Ï¥å', lat: 37.5889, lng: 126.9273, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎèÖÎ∞îÏúÑ', lat: 37.5824, lng: 126.9342, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Íµ¨ÏÇ∞', lat: 37.6093, lng: 126.9167, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÉàÏ†à', lat: 37.5931, lng: 126.9251, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï¶ùÏÇ∞', lat: 37.5816, lng: 126.9049, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎîîÏßÄÌÑ∏ÎØ∏ÎîîÏñ¥ÏãúÌã∞', lat: 37.5763, lng: 126.9009, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏõîÎìúÏªµÍ≤ΩÍ∏∞Ïû•', lat: 37.5686, lng: 126.8973, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎßàÌè¨Íµ¨Ï≤≠', lat: 37.5634, lng: 126.9086, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎßùÏõê', lat: 37.5555, lng: 126.9105, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÉÅÏàò', lat: 37.5479, lng: 126.9222, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïù¥ÌÉúÏõê', lat: 37.5346, lng: 126.9947, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÌïúÍ∞ïÏßÑ', lat: 37.5320, lng: 127.0051, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î≤ÑÌã∞Í≥†Í∞ú', lat: 37.5408, lng: 127.0201, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏïΩÏàò', lat: 37.5543, lng: 127.0097, lines: ['3Ìò∏ÏÑ†', '6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎèôÎ¨òÏïû', lat: 37.5713, lng: 127.0153, lines: ['1Ìò∏ÏÑ†', '6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï∞ΩÏã†', lat: 37.5754, lng: 127.0174, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î≥¥Î¨∏', lat: 37.5843, lng: 127.0172, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏïàÏïî', lat: 37.5852, lng: 127.0276, lines: ['6Ìò∏ÏÑ†'], type: 'subway'},
            
            // === 7Ìò∏ÏÑ† Ï£ºÏöîÏó≠ (ÎàÑÎùΩÎêú Ïó≠ Ï∂îÍ∞Ä) ===
            {name: 'Ïû•Ïïî', lat: 37.6446, lng: 127.0770, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎèÑÎ¥âÏÇ∞', lat: 37.6898, lng: 127.0470, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏàòÎùΩÏÇ∞', lat: 37.6479, lng: 127.0774, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎßàÎì§', lat: 37.6353, lng: 127.0593, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎÖ∏Ïõê', lat: 37.6544, lng: 127.0617, lines: ['4Ìò∏ÏÑ†', '7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï§ëÍ≥Ñ', lat: 37.6412, lng: 127.0734, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÌïòÍ≥Ñ', lat: 37.6362, lng: 127.0694, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í≥µÎ¶â', lat: 37.6254, lng: 127.0729, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÌÉúÎ¶âÏûÖÍµ¨', lat: 37.6178, lng: 127.0754, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î®πÍ≥®', lat: 37.6173, lng: 127.0773, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï§ëÌôî', lat: 37.6100, lng: 127.0778, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÉÅÎ¥â', lat: 37.5967, lng: 127.0851, lines: ['7Ìò∏ÏÑ†', 'Í≤ΩÏùòÏ§ëÏïôÏÑ†'], type: 'subway'},
            {name: 'Î©¥Î™©', lat: 37.5892, lng: 127.0895, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÇ¨Í∞ÄÏ†ï', lat: 37.5815, lng: 127.0941, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïö©ÎßàÏÇ∞', lat: 37.5743, lng: 127.0988, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï§ëÍ≥°', lat: 37.5668, lng: 127.0841, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïñ¥Î¶∞Ïù¥ÎåÄÍ≥µÏõê', lat: 37.5482, lng: 127.0743, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï≤≠Îã¥', lat: 37.5199, lng: 127.0565, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í∞ïÎÇ®Íµ¨Ï≤≠', lat: 37.5176, lng: 127.0417, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÌïôÎèô', lat: 37.5143, lng: 127.0312, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎÖºÌòÑ', lat: 37.5104, lng: 127.0227, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î∞òÌè¨', lat: 37.4979, lng: 127.0118, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎÇ¥Î∞©', lat: 37.4918, lng: 126.9967, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎÇ®ÏÑ±', lat: 37.4844, lng: 126.9709, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïà≠Ïã§ÎåÄÏûÖÍµ¨', lat: 37.4964, lng: 126.9575, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÉÅÎèÑ', lat: 37.5028, lng: 126.9484, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïû•ÏäπÎ∞∞Í∏∞', lat: 37.5100, lng: 126.9366, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïã†ÎåÄÎ∞©ÏÇºÍ±∞Î¶¨', lat: 37.4949, lng: 126.9137, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î≥¥ÎùºÎß§', lat: 37.4939, lng: 126.9258, lines: ['7Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎãπÍ≥°', lat: 37.4904, lng: 126.9253, lines: ['7Ìò∏ÏÑ†'], type: 'subway'}, // Ï¢åÌëú ÏàòÏ†ï
            {name: 'ÎåÄÎ¶º', lat: 37.4932, lng: 126.8955, lines: ['2Ìò∏ÏÑ†', '7Ìò∏ÏÑ†'], type: 'subway'},
            
            // === 8Ìò∏ÏÑ† Ï£ºÏöîÏó≠ ===
            {name: 'Î™®ÎûÄ', lat: 37.2934, lng: 127.1283, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎÇ®ÌïúÏÇ∞ÏÑ±ÏûÖÍµ¨', lat: 37.4520, lng: 127.1376, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Îã®ÎåÄÏò§Í±∞Î¶¨', lat: 37.4607, lng: 127.1282, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïã†Ìù•', lat: 37.4685, lng: 127.1194, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏàòÏßÑ', lat: 37.4849, lng: 127.1019, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î™ΩÏ¥åÌÜ†ÏÑ±', lat: 37.5053, lng: 127.0972, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÑùÏ¥å', lat: 37.5051, lng: 127.1059, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÜ°Ìåå', lat: 37.5051, lng: 127.1137, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í∞ÄÎùΩÏãúÏû•', lat: 37.4919, lng: 127.1189, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Î¨∏Ï†ï', lat: 37.4846, lng: 127.1226, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïû•ÏßÄ', lat: 37.4784, lng: 127.1264, lines: ['8Ìò∏ÏÑ†'], type: 'subway'},
            
            // === 9Ìò∏ÏÑ† Ï£ºÏöîÏó≠ ===
            {name: 'Í∞úÌôî', lat: 37.5777, lng: 126.7986, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í≥µÌï≠ÏãúÏû•', lat: 37.5624, lng: 126.8125, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïã†Î∞©Ìôî', lat: 37.5573, lng: 126.8130, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎßàÍ≥°ÎÇòÎ£®', lat: 37.5660, lng: 126.8252, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏñëÏ≤úÌñ•Íµê', lat: 37.5517, lng: 126.8329, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Í∞ÄÏñë', lat: 37.5614, lng: 126.8547, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï¶ùÎØ∏', lat: 37.5580, lng: 126.8642, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Îì±Ï¥å', lat: 37.5504, lng: 126.8606, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏóºÏ∞Ω', lat: 37.5463, lng: 126.8746, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïã†Î™©Îèô', lat: 37.5374, lng: 126.8746, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÑ†Ïú†ÎèÑ', lat: 37.5354, lng: 126.8937, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎÖ∏ÎüâÏßÑ', lat: 37.5134, lng: 126.9427, lines: ['1Ìò∏ÏÑ†', '9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎÖ∏Îì§', lat: 37.5183, lng: 126.9518, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÌùëÏÑù', lat: 37.5056, lng: 126.9615, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Íµ¨Î∞òÌè¨', lat: 37.5048, lng: 127.0047, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïã†ÎÖºÌòÑ', lat: 37.5048, lng: 127.0252, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïñ∏Ï£º', lat: 37.5178, lng: 127.0371, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÑ†Ï†ïÎ¶â', lat: 37.5045, lng: 127.0493, lines: ['2Ìò∏ÏÑ†', '9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÇºÏ†Ñ', lat: 37.4971, lng: 127.0830, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÑùÏ¥åÍ≥†Î∂Ñ', lat: 37.5051, lng: 127.1059, lines: ['8Ìò∏ÏÑ†', '9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÏÜ°ÌååÎÇòÎ£®', lat: 37.5152, lng: 127.1119, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÌïúÏÑ±Î∞±Ï†ú', lat: 37.5086, lng: 127.1263, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ïò¨Î¶ºÌîΩÍ≥µÏõê', lat: 37.5152, lng: 127.1365, lines: ['5Ìò∏ÏÑ†', '9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'ÎëîÏ¥åÏò§Î•ú', lat: 37.5267, lng: 127.1366, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            {name: 'Ï§ëÏïôÎ≥¥ÌõàÎ≥ëÏõê', lat: 37.5346, lng: 127.1363, lines: ['9Ìò∏ÏÑ†'], type: 'subway'},
            
            // === Ïã†Î¶ºÏÑ† (Í≤ΩÏ†ÑÏ≤†) ===
            {name:'ÏÉõÍ∞ïÏó≠', lat: 37.518173, lng: 126.929871, lines: ['Ïã†Î¶ºÏÑ†'], type: 'subway'},
            {name:'ÎåÄÎ∞©Ïó≠', lat: 37.513366, lng: 126.926442, lines: ['Ïã†Î¶ºÏÑ†'], type: 'subway'},
            {name:'ÏÑúÏö∏ÏßÄÎ∞©Î≥ëÎ¨¥Ï≤≠Ïó≠', lat: 37.505706, lng: 126.923838, lines: ['Ïã†Î¶ºÏÑ†'], type: 'subway'},
            {name:'Î≥¥ÎùºÎß§Í≥µÏõêÏó≠', lat: 37.498565, lng: 126.923838, lines: ['Ïã†Î¶ºÏÑ†'], type: 'subway'}, 
            {name:'Î≥¥ÎùºÎß§Î≥ëÏõêÏó≠', lat: 37.492778, lng: 126.924167, lines: ['Ïã†Î¶ºÏÑ†'], type: 'subway'},
            {name:'ÎãπÍ≥°Ïó≠', lat: 37.489167, lng: 126.928056, lines: ['Ïã†Î¶ºÏÑ†'], type: 'subway'},
            {name:'Ïã†Î¶ºÏó≠', lat: 37.484251, lng: 126.929864, lines: ['Ïã†Î¶ºÏÑ†'], type: 'subway'},
            {name:'ÏÑúÏõêÏó≠', lat: 37.478056, lng: 126.933333, lines: ['Ïã†Î¶ºÏÑ†'], type: 'subway'},
            {name:'ÏÑúÏö∏ÎåÄÎ≤§Ï≤òÌÉÄÏö¥Ïó≠', lat: 37.470535, lng: 126.93874, lines: ['Ïã†Î¶ºÏÑ†'], type: 'subway'},
            {name:'Í¥ÄÏïÖÏÇ∞Ïó≠', lat: 37.464673, lng: 126.942911, lines: ['Ïã†Î¶ºÏÑ†'], type: 'subway'},
            
            // === Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ† (Í≤ΩÏ†ÑÏ≤†) ===
            {name: 'Î∂ÅÌïúÏÇ∞Ïö∞Ïù¥', lat: 37.6634, lng: 127.0126, lines: ['Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            {name: 'ÏÜîÎ∞≠Í≥µÏõê', lat: 37.6593, lng: 127.0099, lines: ['Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            {name: '4.19ÎØºÏ£ºÎ¨òÏßÄ', lat: 37.6532, lng: 127.0095, lines: ['Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            {name: 'Í∞ÄÏò§Î¶¨', lat: 37.6460, lng: 127.0115, lines: ['Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            {name: 'ÌôîÍ≥Ñ', lat: 37.6394, lng: 127.0153, lines: ['Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            {name: 'ÏÇºÏñë', lat: 37.6307, lng: 127.0196, lines: ['Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            {name: 'ÏÇºÏñëÏÇ¨Í±∞Î¶¨', lat: 37.6265, lng: 127.0218, lines: ['Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            {name: 'ÏÜîÏÉò', lat: 37.6195, lng: 127.0264, lines: ['Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            {name: 'Î∂ÅÌïúÏÇ∞Î≥¥Íµ≠Î¨∏', lat: 37.6138, lng: 127.0307, lines: ['Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            {name: 'Ï†ïÎ¶â', lat: 37.6061, lng: 127.0366, lines: ['Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            {name: 'ÏÑ±Ïã†Ïó¨ÎåÄÏûÖÍµ¨', lat: 37.5926, lng: 127.0177, lines: ['4Ìò∏ÏÑ†', 'Ïö∞Ïù¥Ïã†ÏÑ§ÏÑ†'], type: 'subway'},
            
            // === Ï†ÑÍµ≠ ÏΩîÎ†àÏùº Í∏∞Ï∞®Ïó≠ (ÎåÄÌè≠ ÌôïÏû•) ===

            // === ÏàòÎèÑÍ∂å ===
            {name: 'ÏÑúÏö∏Ïó≠', lat: 37.5547, lng: 126.9706, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏', 'ITX-ÏÉàÎßàÏùÑ'], type: 'korail'},
            {name: 'Ïö©ÏÇ∞Ïó≠', lat: 37.5297, lng: 126.9645, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï≤≠ÎüâÎ¶¨Ïó≠', lat: 37.5806, lng: 127.0472, lines: ['KTX', 'ITX-Ï≤≠Ï∂ò', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏòÅÎì±Ìè¨Ïó≠', lat: 37.5150, lng: 126.9076, lines: ['ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏàòÏõêÏó≠', lat: 37.2663, lng: 127.0011, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏïàÏñëÏó≠', lat: 37.4019, lng: 126.9227, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏùòÏ†ïÎ∂ÄÏó≠', lat: 37.7386, lng: 127.0477, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎèôÎëêÏ≤úÏó≠', lat: 37.9034, lng: 127.0606, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏÜåÏöîÏÇ∞Ïó≠', lat: 37.9484, lng: 127.0778, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎçïÏÜåÏó≠', lat: 37.6133, lng: 127.3161, lines: ['ITX-Ï≤≠Ï∂ò', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏñëÌèâÏó≠', lat: 37.4919, lng: 127.4873, lines: ['ITX-Ï≤≠Ï∂ò', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ïö©Î¨∏Ïó≠', lat: 37.5451, lng: 127.5829, lines: ['ITX-Ï≤≠Ï∂ò', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},

            // === Í≤ΩÍ∏∞ÎèÑ ===
            {name: 'ÌèâÌÉùÏó≠', lat: 36.9912, lng: 127.0845, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï≤úÏïàÏó≠', lat: 36.8101, lng: 127.1436, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï≤úÏïàÏïÑÏÇ∞Ïó≠', lat: 36.7947, lng: 127.1044, lines: ['KTX'], type: 'korail'},
            {name: 'Ïò§ÏÇ∞Ïó≠', lat: 37.1477, lng: 127.0773, lines: ['ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏÑ±ÌôòÏó≠', lat: 36.9189, lng: 127.1378, lines: ['ÏÉàÎßàÏùÑÌôî'], type: 'korail'},
            {name: 'ÏßÅÏÇ∞Ïó≠', lat: 36.8813, lng: 127.1644, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎëêÏ†ïÏó≠', lat: 36.8356, lng: 127.1256, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},

            // === Ï∂©Ï≤≠Î∂ÅÎèÑ ===
            {name: 'Ï°∞ÏπòÏõêÏó≠', lat: 36.5894, lng: 127.2900, lines: ['ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï≤≠Ï£ºÏó≠', lat: 36.6425, lng: 127.4408, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï∂©Ï£ºÏó≠', lat: 36.9748, lng: 127.9364, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï†úÏ≤úÏó≠', lat: 37.1326, lng: 128.1906, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Îã®ÏñëÏó≠', lat: 36.9845, lng: 128.3651, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎèÑÎã¥Ïó≠', lat: 36.9389, lng: 128.3267, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},

            // === Ï∂©Ï≤≠ÎÇ®ÎèÑ ===
            {name: 'ÎåÄÏ†ÑÏó≠', lat: 36.3315, lng: 127.4344, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏÑúÎåÄÏ†ÑÏó≠', lat: 36.3154, lng: 127.3838, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Í≥µÏ£ºÏó≠', lat: 36.4465, lng: 127.1189, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎÖºÏÇ∞Ïó≠', lat: 36.1875, lng: 127.0982, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Í∞ïÍ≤ΩÏó≠', lat: 36.0695, lng: 126.9889, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Î∂ÄÏó¨Ïó≠', lat: 36.2756, lng: 126.9100, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÌôçÏÑ±Ïó≠', lat: 36.6013, lng: 126.6817, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏòàÏÇ∞Ïó≠', lat: 36.6789, lng: 126.8456, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ïã†Î°ÄÏõêÏó≠', lat: 36.6656, lng: 126.9033, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ïò®ÏñëÏò®Ï≤úÏó≠', lat: 36.7817, lng: 127.0014, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏïÑÏÇ∞Ïó≠', lat: 36.7947, lng: 127.1044, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},

            // === Ï†ÑÎùºÎ∂ÅÎèÑ ===
            {name: 'ÏùµÏÇ∞Ïó≠', lat: 35.9482, lng: 126.9547, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï†ÑÏ£ºÏó≠', lat: 35.8486, lng: 127.1286, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï†ïÏùçÏó≠', lat: 35.5697, lng: 126.8658, lines: ['ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏûÑÏã§Ïó≠', lat: 35.6178, lng: 127.2881, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏàúÏ∞ΩÏó≠', lat: 35.3667, lng: 127.1372, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎÇ®ÏõêÏó≠', lat: 35.4172, lng: 127.3906, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Í≥°ÏÑ±Ïó≠', lat: 35.2819, lng: 127.2906, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},

            // === Ï†ÑÎùºÎÇ®ÎèÑ ===
            {name: 'Í¥ëÏ£ºÏÜ°Ï†ïÏó≠', lat: 35.1401, lng: 126.7935, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏'], type: 'korail'},
            {name: 'Í¥ëÏ£ºÏó≠', lat: 35.1472, lng: 126.9161, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Î™©Ìè¨Ïó≠', lat: 34.7947, lng: 126.3849, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎÇòÏ£ºÏó≠', lat: 35.0161, lng: 126.7111, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ìï®ÌèâÏó≠', lat: 35.0667, lng: 126.5167, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏùºÎ°úÏó≠', lat: 34.9289, lng: 126.4506, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏûÑÏÑ±Î¶¨Ïó≠', lat: 34.8456, lng: 126.4006, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Î™ΩÌÉÑÏó≠', lat: 34.8122, lng: 126.3789, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏàúÏ≤úÏó≠', lat: 34.9508, lng: 127.4878, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ïó¨Ï≤úÏó≠', lat: 34.8661, lng: 127.7414, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Í¥ëÏñëÏó≠', lat: 34.9403, lng: 127.5958, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÌïòÎèôÏó≠', lat: 35.0661, lng: 127.7514, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},

            // === Í≤ΩÏÉÅÎ∂ÅÎèÑ ===
            {name: 'ÍπÄÏ≤úÍµ¨ÎØ∏Ïó≠', lat: 36.1203, lng: 128.3447, lines: ['KTX'], type: 'korail'},
            {name: 'ÍπÄÏ≤úÏó≠', lat: 36.1394, lng: 128.1133, lines: ['ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Íµ¨ÎØ∏Ïó≠', lat: 36.1194, lng: 128.3456, lines: ['ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎåÄÍµ¨Ïó≠', lat: 35.8794, lng: 128.6289, lines: ['ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎèôÎåÄÍµ¨Ïó≠', lat: 35.8790, lng: 128.6286, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Í≤ΩÏ£ºÏó≠', lat: 35.8394, lng: 129.2278, lines: ['ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ìè¨Ìï≠Ïó≠', lat: 36.0413, lng: 129.3456, lines: ['ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏïàÎèôÏó≠', lat: 36.5683, lng: 128.7289, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏòÅÏ£ºÏó≠', lat: 36.8056, lng: 128.6228, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Î¨∏Í≤ΩÏó≠', lat: 36.7861, lng: 128.1889, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï†êÏ¥åÏó≠', lat: 36.7794, lng: 128.0944, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏòÅÏ≤úÏó≠', lat: 35.9764, lng: 128.9386, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ïã†Í≤ΩÏ£ºÏó≠', lat: 35.7564, lng: 129.3278, lines: ['KTX'], type: 'korail'},

            // === Í≤ΩÏÉÅÎÇ®ÎèÑ ===
            {name: 'Î∂ÄÏÇ∞Ïó≠', lat: 35.1155, lng: 129.0422, lines: ['KTX', 'ÏÉàÎßàÏùÑÌò∏', 'Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Íµ¨Ìè¨Ïó≠', lat: 35.2056, lng: 128.9978, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Î¨ºÍ∏àÏó≠', lat: 35.3281, lng: 129.0642, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Î∞ÄÏñëÏó≠', lat: 35.5042, lng: 128.7464, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏÇºÎûëÏßÑÏó≠', lat: 35.3428, lng: 128.8156, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏßÑÏ£ºÏó≠', lat: 35.1928, lng: 128.0864, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎßàÏÇ∞Ïó≠', lat: 35.2278, lng: 128.5639, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï∞ΩÏõêÏó≠', lat: 35.2331, lng: 128.6831, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï∞ΩÏõêÏ§ëÏïôÏó≠', lat: 35.2278, lng: 128.6917, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ìï®ÏïàÏó≠', lat: 35.2667, lng: 128.4139, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏùòÎ†πÏó≠', lat: 35.3222, lng: 128.2639, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Î∞òÏÑ±Ïó≠', lat: 35.0006, lng: 128.0019, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},

            // === Í∞ïÏõêÎèÑ ===
            {name: 'ÏõêÏ£ºÏó≠', lat: 37.3422, lng: 127.9473, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï†úÏ≤úÏó≠', lat: 37.1326, lng: 128.1906, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÌÉúÎ∞±Ïó≠', lat: 37.1642, lng: 128.9856, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎèôÌï¥Ïó≠', lat: 37.5242, lng: 129.1142, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Í∞ïÎ¶âÏó≠', lat: 37.7635, lng: 128.8989, lines: ['KTX'], type: 'korail'},
            {name: 'Ï†ïÎèôÏßÑÏó≠', lat: 37.6922, lng: 129.0342, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Î¨µÌò∏Ïó≠', lat: 37.5506, lng: 129.1164, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏÇºÏ≤ôÏó≠', lat: 37.4481, lng: 129.1656, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï∂òÏ≤úÏó≠', lat: 37.8853, lng: 127.7181, lines: ['ITX-Ï≤≠Ï∂ò'], type: 'korail'},
            {name: 'ÎÇ®Ï∂òÏ≤úÏó≠', lat: 37.8644, lng: 127.7297, lines: ['ITX-Ï≤≠Ï∂ò'], type: 'korail'},
            {name: 'ÍπÄÏú†Ï†ïÏó≠', lat: 37.7975, lng: 127.5817, lines: ['ITX-Ï≤≠Ï∂ò'], type: 'korail'},
            {name: 'Í∞ïÏ¥åÏó≠', lat: 37.8033, lng: 127.6031, lines: ['ITX-Ï≤≠Ï∂ò'], type: 'korail'},

            // === Í≤ΩÍ∏∞ ÎèôÎ∂Ä ===
            {name: 'ÏñëÌèâÏó≠', lat: 37.4919, lng: 127.4873, lines: ['Î¨¥Í∂ÅÌôîÌò∏', 'ITX-Ï≤≠Ï∂ò'], type: 'korail'},
            {name: 'Ïö©Î¨∏Ïó≠', lat: 37.5451, lng: 127.5829, lines: ['Î¨¥Í∂ÅÌôîÌò∏', 'ITX-Ï≤≠Ï∂ò'], type: 'korail'},
            {name: 'ÏßÄÌèâÏó≠', lat: 37.6306, lng: 127.6094, lines: ['Î¨¥Í∂ÅÌôîÌò∏', 'ITX-Ï≤≠Ï∂ò'], type: 'korail'},

            // === ÌôîÎ¨º Ï†ÑÏö©Ïó≠ Î∞è Í∏∞ÌÉÄ ===
            {name: 'ÏùòÏôïÏó≠', lat: 37.3444, lng: 126.9681, lines: ['ÌôîÎ¨º'], type: 'korail'},
            {name: 'Î∂ÄÍ≥°Ïó≠', lat: 37.2978, lng: 126.9706, lines: ['ÌôîÎ¨º'], type: 'korail'},
            {name: 'Ïò§Î¥âÏó≠', lat: 37.2456, lng: 127.0031, lines: ['ÌôîÎ¨º'], type: 'korail'},
            {name: 'ÏÜ°ÌÉÑÏó≠', lat: 36.9672, lng: 127.0561, lines: ['Î¨¥Í∂ÅÌôîÌò∏', 'ÌôîÎ¨º'], type: 'korail'},
            {name: 'ÏÑúÏ†ïÎ¶¨Ïó≠', lat: 36.9311, lng: 127.0806, lines: ['ÌôîÎ¨º'], type: 'korail'},

            // === Ï†úÏ£ºÎèÑ (Ìï¥ÎãπÏóÜÏùå) ===
            // Ï†úÏ£ºÎèÑÎäî Ï≤†ÎèÑÍ∞Ä ÏóÜÏúºÎØÄÎ°ú Ï†úÏô∏

            // === Ïù∏Ï≤ú ===
            {name: 'Ïù∏Ï≤úÏó≠', lat: 37.4759, lng: 126.6162, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎèôÏù∏Ï≤úÏó≠', lat: 37.4756, lng: 126.6325, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ï†úÎ¨ºÌè¨Ïó≠', lat: 37.4733, lng: 126.6467, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},

            // === Í∏∞ÌÉÄ ÏßÄÏÑ† Ïó≠Îì§ Ï∂îÍ∞Ä ===
            {name: 'Î∂ÑÎãπÏó≠', lat: 37.3595, lng: 127.1072, lines: ['Î∂ÑÎãπÏÑ†'], type: 'subway'},
            {name: 'ÏàòÏÑúÏó≠', lat: 37.4875, lng: 127.1017, lines: ['Î∂ÑÎãπÏÑ†', 'SRT'], type: 'both'},
            {name: 'ÏßÄÏ†úÏó≠', lat: 37.1019, lng: 127.0894, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏÑúÎèôÌÉÑÏó≠', lat: 37.0772, lng: 127.0656, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Î≥ëÏ†êÏó≠', lat: 37.2356, lng: 127.0481, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏÑ∏ÎßàÏó≠', lat: 37.2033, lng: 127.0744, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},

            // === Ï∂îÍ∞Ä ÏòÅÎÇ®Í∂å Ïó≠Îì§ ===
            {name: 'Ïö∏ÏÇ∞Ïó≠', lat: 35.5664, lng: 129.2650, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'Ïã†ÌôîÏó≠', lat: 35.5289, lng: 129.2486, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÎèôÎûòÏó≠', lat: 35.2064, lng: 129.0814, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            {name: 'ÏÑúÎ©¥Ïó≠', lat: 35.1578, lng: 129.0592, lines: ['Î¨¥Í∂ÅÌôîÌò∏'], type: 'korail'},
            
            // Îçî ÎßéÏùÄ Ïó≠Îì§ÏùÑ Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏßÄÎßå, Ï£ºÏöî Ïó≠Îì§ÏùÑ Ï§ëÏã¨ÏúºÎ°ú Ï†ÑÍµ≠ÏùÑ Ïª§Î≤ÑÌïòÎèÑÎ°ù Íµ¨ÏÑ±ÌñàÏäµÎãàÎã§.
        ];


        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // HTTPS Ï≤¥ÌÅ¨
            checkHTTPS();
            
            // Ïò§ÎîîÏò§ Ï¥àÍ∏∞Ìôî
            alarmSound = document.getElementById('alarm-sound');
            
            // ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî
            initializeMap();
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            setupEventListeners();
            
            // GPS Í∂åÌïú ÏöîÏ≤≠
            requestLocationPermission();
        }

        function checkHTTPS() {
            const httpsWarning = document.getElementById('https-warning');
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                httpsWarning.className = 'https-warning show';
                updateDebugInfo('HTTP ÌôòÍ≤ΩÏóêÏÑúÎäî GPS Ï†ëÍ∑ºÏù¥ Ï†úÌïúÎê† Ïàò ÏûàÏäµÎãàÎã§');
            } else {
                httpsWarning.className = 'https-warning hide';
            }
        }

        function updateDebugInfo(info) {
            const debugDiv = document.getElementById('gps-debug');
            const debugInfo = document.getElementById('debug-info');
            debugInfo.textContent = info;
            debugDiv.style.display = 'block';
        }

        function setupEventListeners() {
            // GPS Î™®Îìú Î≤ÑÌäºÎì§
            document.getElementById('start-monitoring').addEventListener('click', startGPSMonitoring);
            document.getElementById('stop-monitoring').addEventListener('click', stopGPSMonitoring);
            document.getElementById('retry-gps').addEventListener('click', requestLocationPermission);
            
            // ÏàòÎèô Î™®Îìú Î≤ÑÌäºÎì§
            document.getElementById('start-manual-monitoring').addEventListener('click', startManualMonitoring);
            document.getElementById('stop-manual-monitoring').addEventListener('click', stopManualMonitoring);
            
            // Í∞±Ïã† Ï£ºÍ∏∞ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
            document.getElementById('update-interval').addEventListener('change', function() {
                if (isMonitoring) {
                    stopGPSMonitoring();
                    setTimeout(() => startGPSMonitoring(), 100);
                }
            });
            
            document.getElementById('manual-update-interval').addEventListener('change', function() {
                if (isMonitoring) {
                    stopManualMonitoring();
                    setTimeout(() => startManualMonitoring(), 100);
                }
            });
        }

        function switchMode(mode) {
            // ÌôúÏÑ± Î≤ÑÌäº Î≥ÄÍ≤Ω
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ÏΩòÌÖêÏ∏† ÏÑπÏÖò Î≥ÄÍ≤Ω
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            if (mode === 'gps') {
                document.getElementById('gps-mode').classList.add('active');
            } else {
                document.getElementById('manual-mode').classList.add('active');
            }
            
            // Í∏∞Ï°¥ Î™®ÎãàÌÑ∞ÎßÅ Ï§ëÏßÄ
            if (isMonitoring) {
                stopAllMonitoring();
            }
        }

        function initializeMap() {
            // Leaflet ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî
            map = L.map('map').setView([37.5665, 126.9780], 10);

            // OpenStreetMap ÌÉÄÏùº Ï∂îÍ∞Ä
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            // ÏßÄÎèÑ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            map.on('click', function(e) {
                setSelectedPosition(e.latlng.lat, e.latlng.lng);
            });

            // Í∏∞Ï∞®Ïó≠Îì§ ÎßàÏª§ Ï∂îÍ∞Ä
            TRAIN_STATIONS.forEach(station => {
                let markerColor = '#2196F3';
                let markerSize = 8;
                
                if (station.type === 'korail') {
                    markerColor = '#FF5722';
                    markerSize = 10;
                } else if (station.type === 'both') {
                    markerColor = '#9C27B0';
                    markerSize = 12;
                }
                
                const stationMarker = L.marker([station.lat, station.lng])
                    .bindPopup(`<b>${station.name}</b><br>${station.lines.join(', ')}<br><small>(${station.type === 'subway' ? 'ÏßÄÌïòÏ≤†/Í≤ΩÏ†ÑÏ≤†' : station.type === 'korail' ? 'ÏΩîÎ†àÏùº' : 'ÏßÄÌïòÏ≤†+ÏΩîÎ†àÏùº'})</small>`)
                    .addTo(map);
                
                stationMarker.setIcon(L.divIcon({
                    html: `<div style="background:${markerColor};width:${markerSize}px;height:${markerSize}px;border-radius:50%;border:2px solid white;"></div>`,
                    iconSize: [markerSize + 4, markerSize + 4],
                    className: 'train-station-marker'
                }));
            });
        }

        function requestLocationPermission() {
            if (!navigator.geolocation) {
                updateGPSStatus('GPS ÎØ∏ÏßÄÏõê', 'Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî GPSÎ•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§');
                updateDebugInfo('Geolocation APIÍ∞Ä ÏßÄÏõêÎêòÏßÄ ÏïäÏäµÎãàÎã§');
                document.getElementById('retry-gps').style.display = 'block';
                return;
            }

            document.getElementById('gps-status-text').textContent = 'GPS Í∂åÌïú ÏöîÏ≤≠ Ï§ë...';
            updateDebugInfo('GPS Í∂åÌïú ÏöîÏ≤≠ Ï§ë...');
            
            const options = {
                enableHighAccuracy: true,
                timeout: 15000,
                maximumAge: 300000
            };

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    currentPosition = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                    
                    updateGPSStatus('ÏúÑÏπò ÌôïÏù∏ ÏôÑÎ£å', `ÏúÑÎèÑ: ${currentPosition.lat.toFixed(6)}, Í≤ΩÎèÑ: ${currentPosition.lng.toFixed(6)}`);
                    updateDebugInfo(`Ï†ïÌôïÎèÑ: ${Math.round(position.coords.accuracy)}m, ÏãúÍ∞Ñ: ${new Date(position.timestamp).toLocaleTimeString()}`);
                    
                    findNearbyStations(currentPosition);
                    document.getElementById('retry-gps').style.display = 'none';
                },
                function(error) {
                    let errorMsg = 'GPS Ïò§Î•ò: ';
                    let debugMsg = '';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg += 'ÏúÑÏπò Í∂åÌïúÏù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§';
                            debugMsg = 'PERMISSION_DENIED - ÏÇ¨Ïö©ÏûêÍ∞Ä ÏúÑÏπò Ï†ëÍ∑ºÏùÑ Í±∞Î∂ÄÌñàÏäµÎãàÎã§';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg += 'ÏúÑÏπò Ï†ïÎ≥¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§';
                            debugMsg = 'POSITION_UNAVAILABLE - GPS Ïã†Ìò∏Î•º Î∞õÏùÑ Ïàò ÏóÜÏäµÎãàÎã§';
                            break;
                        case error.TIMEOUT:
                            errorMsg += 'ÏúÑÏπò ÏöîÏ≤≠ ÏãúÍ∞ÑÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§';
                            debugMsg = 'TIMEOUT - 15Ï¥à ÎÇ¥Ïóê ÏúÑÏπòÎ•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§';
                            break;
                        default:
                            errorMsg += 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§';
                            debugMsg = `UNKNOWN ERROR (${error.code}): ${error.message}`;
                            break;
                    }
                    
                    updateGPSStatus('GPS Ïò§Î•ò', errorMsg);
                    updateDebugInfo(debugMsg);
                    document.getElementById('retry-gps').style.display = 'block';
                    
                    console.error('GPS Error:', error);
                },
                options
            );
        }

        function updateGPSStatus(status, location) {
            document.getElementById('gps-status-text').textContent = status;
            document.getElementById('gps-location-text').textContent = location;
        }

        function setSelectedPosition(lat, lng) {
            selectedPosition = { lat: lat, lng: lng };
            
            // Í∏∞Ï°¥ ÎßàÏª§ Ï†úÍ±∞
            if (marker) {
                map.removeLayer(marker);
            }
            
            // ÏÉà ÎßàÏª§ Ï∂îÍ∞Ä
            marker = L.marker([lat, lng]).addTo(map);
            marker.bindPopup('ÏÑ†ÌÉùÌïú ÏúÑÏπò').openPopup();
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('selected-lat').textContent = lat.toFixed(6);
            document.getElementById('selected-lng').textContent = lng.toFixed(6);
            document.getElementById('start-manual-monitoring').disabled = false;
            
            document.getElementById('selected-address').textContent = `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
            document.getElementById('manual-status-text').textContent = 'ÏúÑÏπò ÏÑ†ÌÉù ÏôÑÎ£å';
        }

        function findNearbyStations(position) {
            nearbyStations = TRAIN_STATIONS.filter(station => {
                const distance = calculateDistance(position.lat, position.lng, station.lat, station.lng);
                return distance <= 10000; // 10km Ïù¥ÎÇ¥
            }).map(station => ({
                ...station,
                distance: calculateDistance(position.lat, position.lng, station.lat, station.lng)
            })).sort((a, b) => a.distance - b.distance);

            console.log(`üöÉ Í∑ºÏ≤ò Ïó≠ ${nearbyStations.length}Í∞ú Î∞úÍ≤¨:`);
            nearbyStations.slice(0, 10).forEach(station => {
                console.log(`   ${station.type === 'subway' ? 'üöá' : station.type === 'korail' ? 'üöÑ' : 'üöÜ'} ${station.name}: ${Math.round(station.distance)}m`);
            });

            document.getElementById('nearby-stations-count').textContent = nearbyStations.length;
            
            if (nearbyStations.length > 0) {
                updateDebugInfo(`Í∑ºÏ≤ò Ïó≠: ${nearbyStations.length}Í∞ú Î∞úÍ≤¨ (10km Î∞òÍ≤Ω)`);
            } else {
                updateDebugInfo('Í∑ºÏ≤òÏóê Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§ (10km Î∞òÍ≤Ω)');
            }
        }

        function startGPSMonitoring() {
            if (!currentPosition) {
                alert('GPS ÏúÑÏπò Ï†ïÎ≥¥Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§');
                return;
            }
            
            isMonitoring = true;
            document.getElementById('start-monitoring').style.display = 'none';
            document.getElementById('stop-monitoring').style.display = 'block';
            document.getElementById('monitoring-status').textContent = 'ÏòàÏ∏° Î™®ÎãàÌÑ∞ÎßÅ Ï§ë';
            document.getElementById('prediction-panel').style.display = 'block';
            
            const updateInterval = parseInt(document.getElementById('update-interval').value);
            
            monitoringInterval = setInterval(() => {
                performTrainPrediction(currentPosition, false);
            }, updateInterval);
            
            // Ï¶âÏãú Ìïú Î≤à Ïã§Ìñâ
            performTrainPrediction(currentPosition, false);
        }

        function stopGPSMonitoring() {
            stopAllMonitoring();
            document.getElementById('start-monitoring').style.display = 'block';
            document.getElementById('stop-monitoring').style.display = 'none';
            document.getElementById('monitoring-status').textContent = 'ÎåÄÍ∏∞ Ï§ë';
            document.getElementById('prediction-panel').style.display = 'none';
        }

        function startManualMonitoring() {
            if (!selectedPosition) {
                alert('ÏßÄÎèÑÏóêÏÑú ÏúÑÏπòÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî');
                return;
            }
            
            isMonitoring = true;
            document.getElementById('start-manual-monitoring').style.display = 'none';
            document.getElementById('stop-manual-monitoring').style.display = 'block';
            document.getElementById('manual-monitoring-status').textContent = 'ÏòàÏ∏° Î™®ÎãàÌÑ∞ÎßÅ Ï§ë';
            document.getElementById('manual-prediction-panel').style.display = 'block';
            
            const updateInterval = parseInt(document.getElementById('manual-update-interval').value);
            
            monitoringInterval = setInterval(() => {
                performTrainPrediction(selectedPosition, true);
            }, updateInterval);
            
            // Ï¶âÏãú Ìïú Î≤à Ïã§Ìñâ
            performTrainPrediction(selectedPosition, true);
        }

        function stopManualMonitoring() {
            stopAllMonitoring();
            document.getElementById('start-manual-monitoring').style.display = 'block';
            document.getElementById('stop-manual-monitoring').style.display = 'none';
            document.getElementById('manual-monitoring-status').textContent = 'ÎåÄÍ∏∞ Ï§ë';
            document.getElementById('manual-prediction-panel').style.display = 'none';
        }

        function stopAllMonitoring() {
            isMonitoring = false;
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
            
            // Í≤ΩÍ≥† ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            hideWarning();
            stopAlarm();
            currentWarningState.isActive = false;
            currentWarningState.lastWarningTrain = null;
            currentWarningState.warningStartTime = null;
            currentWarningState.countdownValue = null;
            
            activePredictions = [];
            document.getElementById('train-list').style.display = 'none';
            document.getElementById('prediction-panel').style.display = 'none';
            document.getElementById('manual-prediction-panel').style.display = 'none';
        }

        async function performTrainPrediction(position, isManualMode) {
            const alertTime = parseInt(
                isManualMode ? 
                document.getElementById('manual-alert-time').value : 
                document.getElementById('alert-time').value
            );
            
            try {
                // Í∑ºÏ≤ò Ïó≠ÏÇ¨Îì§Ïóê ÎåÄÌï¥ Ïó¥Ï∞® Ï†ïÎ≥¥ ÏàòÏßë
                const stationsToCheck = nearbyStations.length > 0 ? 
                    nearbyStations.filter(station => station.distance <= 5000).slice(0, 5) :
                    TRAIN_STATIONS.filter(station => {
                        const distance = calculateDistance(position.lat, position.lng, station.lat, station.lng);
                        return distance <= 5000;
                    }).slice(0, 5);

                let allPredictions = [];
                let trainData = [];

                for (const station of stationsToCheck) {
                    try {
                        // Ïó¥Ï∞® ÎèÑÏ∞©/Ï∂úÎ∞ú Ï†ïÎ≥¥ ÏàòÏßë
                        let stationTrains = [];
                        
                        if (station.type === 'subway' || station.type === 'both') {
                            const subwayData = await fetchSubwayRealtime(station.name, station.lines);
                            stationTrains = [...stationTrains, ...subwayData];
                        }
                        
                        if (station.type === 'korail' || station.type === 'both') {
                            const korailData = await generateKorailData(station.name, station.lines, position);
                            stationTrains = [...stationTrains, ...korailData];
                        }
                        
                        trainData = [...trainData, ...stationTrains];
                        
                        // Í∞Å Ïó¥Ï∞®Ïóê ÎåÄÌï¥ GPS ÏúÑÏπò ÌÜµÍ≥º ÏãúÍ∞Ñ ÏòàÏ∏°
                        for (const train of stationTrains) {
                            const prediction = predictTrainPassingTime(train, station, position);
                            if (prediction && prediction.timeToPass <= alertTime * 2) { // Í≤ΩÍ≥†ÏãúÍ∞ÑÏùò 2Î∞∞ Ïù¥ÎÇ¥Îßå ÌëúÏãú
                                allPredictions.push(prediction);
                            }
                        }
                        
                    } catch (error) {
                        console.error(`${station.name} ÏòàÏ∏° Ïò§Î•ò:`, error);
                    }
                }

                // ÏòàÏ∏° Í≤∞Í≥º Ï†ïÎ†¨ (ÌÜµÍ≥º ÏãúÍ∞ÑÏù¥ Îπ†Î•∏ Ïàú)
                allPredictions.sort((a, b) => a.timeToPass - b.timeToPass);
                activePredictions = allPredictions;

                console.log(`üîÆ Ï¥ù ÏòàÏ∏°: ${allPredictions.length}Í∞ú`);
                
                // Í≤ΩÍ≥† Ï≤òÎ¶¨
                const imminentTrains = allPredictions.filter(p => p.timeToPass <= alertTime);
                
                if (imminentTrains.length > 0) {
                    if (!currentWarningState.isActive) {
                        currentWarningState.isActive = true;
                        currentWarningState.warningStartTime = new Date();
                        triggerAlarm();
                    }
                    
                    currentWarningState.lastWarningTrain = imminentTrains[0];
                    currentWarningState.countdownValue = imminentTrains[0].timeToPass;
                    showPredictionWarning(imminentTrains, isManualMode);
                    
                } else {
                    if (currentWarningState.isActive) {
                        hideWarning();
                        currentWarningState.isActive = false;
                        currentWarningState.countdownValue = null;
                        stopAlarm();
                    }
                }

                // UI ÏóÖÎç∞Ïù¥Ìä∏
                displayPredictions(allPredictions, isManualMode);
                displayTrainInfo(trainData);
                updateMonitoringInfo(stationsToCheck.length, isManualMode, allPredictions.length);
                
            } catch (error) {
                console.error('ÏòàÏ∏° ÏàòÌñâ Ïò§Î•ò:', error);
                showError('ÏòàÏ∏° ÏàòÌñâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
            }
        }

        function predictTrainPassingTime(train, station, gpsPosition) {
            try {
                // Ïó¥Ï∞®Í∞Ä ÌòÑÏû¨ Ïñ¥ÎîîÏóê ÏûàÎäîÏßÄ Ï∂îÏ†ï
                const trainCurrentLocation = estimateTrainLocation(train, station);
                if (!trainCurrentLocation) return null;
                
                // GPS ÏúÑÏπòÏôÄ Ïó≠ÏÇ¨ ÏÇ¨Ïù¥Ïùò Í±∞Î¶¨
                const distanceToGPS = calculateDistance(
                    gpsPosition.lat, gpsPosition.lng,
                    station.lat, station.lng
                );
                
                // Ïó¥Ï∞®Í∞Ä GPS ÏúÑÏπòÎ•º ÌÜµÍ≥ºÌïòÎäî ÏãúÍ∞Ñ Í≥ÑÏÇ∞
                const timeToPass = calculatePassingTime(train, trainCurrentLocation, station, gpsPosition, distanceToGPS);
                
                if (timeToPass === null || timeToPass < 0) return null;
                
                return {
                    train: train,
                    station: station,
                    timeToPass: Math.round(timeToPass),
                    confidence: calculatePredictionConfidence(train, distanceToGPS),
                    estimatedLocation: trainCurrentLocation.description,
                    gpsDistance: Math.round(distanceToGPS)
                };
                
            } catch (error) {
                console.error('Ïó¥Ï∞® ÌÜµÍ≥ºÏãúÍ∞Ñ ÏòàÏ∏° Ïò§Î•ò:', error);
                return null;
            }
        }

        function estimateTrainLocation(train, station) {
            try {
                // ÏßÄÌïòÏ≤†Ïùò Í≤ΩÏö∞
                if (train.type === 'subway') {
                    const arrivalMsg = train.arrivalMessage || '';
                    
                    if (arrivalMsg.includes('Í≥ß ÎèÑÏ∞©') || arrivalMsg.includes('ÏßÑÏûÖ')) {
                        return { 
                            distanceFromStation: 0.2, // 200m Ï†Ñ
                            description: 'Ïó≠ ÏßÑÏûÖ Ï§ë',
                            speed: 25 // km/h
                        };
                    } else if (arrivalMsg.includes('1Î∂Ñ')) {
                        return { 
                            distanceFromStation: 1.0, 
                            description: '1Î∂Ñ Í±∞Î¶¨',
                            speed: 35 
                        };
                    } else if (arrivalMsg.includes('2Î∂Ñ')) {
                        return { 
                            distanceFromStation: 2.0, 
                            description: '2Î∂Ñ Í±∞Î¶¨',
                            speed: 35 
                        };
                    } else if (arrivalMsg.includes('3Î∂Ñ')) {
                        return { 
                            distanceFromStation: 2.5, 
                            description: '3Î∂Ñ Í±∞Î¶¨',
                            speed: 35 
                        };
                    } else {
                        // Î©îÏãúÏßÄÏóêÏÑú ÏãúÍ∞Ñ Ï∂îÏ∂ú
                        const timeMatch = arrivalMsg.match(/(\d+)Î∂Ñ/);
                        if (timeMatch) {
                            const minutes = parseInt(timeMatch[1]);
                            return { 
                                distanceFromStation: minutes * 0.8, 
                                description: `${minutes}Î∂Ñ Í±∞Î¶¨`,
                                speed: 35 
                            };
                        }
                    }
                }
                
                // ÏΩîÎ†àÏùºÏùò Í≤ΩÏö∞
                if (train.type === 'korail') {
                    const arrivalMsg = train.arrivalMessage || '';
                    const timeMatch = arrivalMsg.match(/(\d+)Î∂Ñ/);
                    
                    if (timeMatch) {
                        const minutes = parseInt(timeMatch[1]);
                        let speed = TRAIN_SPEEDS.korail.Î¨¥Í∂ÅÌôîÌò∏.average;
                        
                        // Ïó¥Ï∞® Ï¢ÖÎ•òÎ≥Ñ ÏÜçÎèÑ Ï†ÅÏö©
                        if (train.line?.includes('KTX')) {
                            speed = TRAIN_SPEEDS.korail.KTX.average;
                        } else if (train.line?.includes('ÏÉàÎßàÏùÑ')) {
                            speed = TRAIN_SPEEDS.korail.ÏÉàÎßàÏùÑÌò∏.average;
                        } else if (train.line?.includes('ITX')) {
                            speed = TRAIN_SPEEDS.korail['ITX-Ï≤≠Ï∂ò'].average;
                        }
                        
                        const distance = (minutes / 60) * speed; // km
                        
                        return { 
                            distanceFromStation: distance, 
                            description: `${minutes}Î∂Ñ Í±∞Î¶¨ (ÏïΩ ${Math.round(distance)}km)`,
                            speed: speed 
                        };
                    }
                }
                
                return null;
                
            } catch (error) {
                console.error('Ïó¥Ï∞® ÏúÑÏπò Ï∂îÏ†ï Ïò§Î•ò:', error);
                return null;
            }
        }

        function calculatePassingTime(train, trainLocation, station, gpsPosition, distanceToGPS) {
            try {
                // Ïó¥Ï∞®Í∞Ä Ïó≠Ïóê ÎèÑÏ∞©ÌïòÎäî ÏãúÍ∞Ñ
                const timeToStation = (trainLocation.distanceFromStation / trainLocation.speed) * 60; // Î∂Ñ Îã®ÏúÑ
                
                // Ïó≠ÏóêÏÑú GPS ÏúÑÏπòÍπåÏßÄÏùò Ï∂îÍ∞Ä ÏãúÍ∞Ñ (Ïó¥Ï∞®Í∞Ä Ïó≠ÏùÑ ÏßÄÎÇòÏÑú GPS ÏúÑÏπòÍπåÏßÄ)
                let additionalTime = 0;
                
                if (distanceToGPS > 500) { // GPSÍ∞Ä Ïó≠ÏóêÏÑú 500m Ïù¥ÏÉÅ Îñ®Ïñ¥Ï†∏ ÏûàÏúºÎ©¥
                    // Ïó¥Ï∞®Í∞Ä Ïó≠ÏùÑ ÏßÄÎÇò GPS ÏúÑÏπòÍπåÏßÄ Í∞ÄÎäî ÏãúÍ∞Ñ Ï∂îÍ∞Ä Í≥ÑÏÇ∞
                    const additionalDistance = (distanceToGPS - 500) / 1000; // km Îã®ÏúÑ
                    additionalTime = (additionalDistance / trainLocation.speed) * 60; // Î∂Ñ Îã®ÏúÑ
                }
                
                const totalTimeMinutes = timeToStation + additionalTime;
                const totalTimeSeconds = totalTimeMinutes * 60;
                
                console.log(`üöÇ ${train.line} ÌÜµÍ≥º ÏòàÏ∏°: Ïó≠ÍπåÏßÄ ${timeToStation.toFixed(1)}Î∂Ñ, GPSÍπåÏßÄ Ï∂îÍ∞Ä ${additionalTime.toFixed(1)}Î∂Ñ = Ï¥ù ${totalTimeSeconds.toFixed(0)}Ï¥à`);
                
                return totalTimeSeconds;
                
            } catch (error) {
                console.error('ÌÜµÍ≥º ÏãúÍ∞Ñ Í≥ÑÏÇ∞ Ïò§Î•ò:', error);
                return null;
            }
        }

        function calculatePredictionConfidence(train, distanceToGPS) {
            let confidence = 80; // Í∏∞Î≥∏ Ïã†Î¢∞ÎèÑ
            
            // ÏßÄÌïòÏ≤†ÏùÄ Îçî Ï†ïÌôïÌï®
            if (train.type === 'subway') {
                confidence += 10;
            }
            
            // Í±∞Î¶¨Í∞Ä Í∞ÄÍπåÏö∏ÏàòÎ°ù Ï†ïÌôïÌï®
            if (distanceToGPS < 1000) confidence += 10;
            else if (distanceToGPS > 5000) confidence -= 20;
            
            // ÎèÑÏ∞© Î©îÏãúÏßÄÍ∞Ä Íµ¨Ï≤¥Ï†ÅÏùºÏàòÎ°ù Ï†ïÌôïÌï®
            const msg = train.arrivalMessage || '';
            if (msg.includes('Í≥ß') || msg.includes('ÏßÑÏûÖ') || msg.includes('1Î∂Ñ')) {
                confidence += 15;
            }
            
            return Math.min(95, Math.max(50, confidence));
        }

        async function fetchSubwayRealtime(stationName, stationLines) {
            try {
                // Ïã§Ï†ú ÏÑúÏö∏Ïãú ÏßÄÌïòÏ≤† Ïã§ÏãúÍ∞Ñ ÎèÑÏ∞©Ï†ïÎ≥¥ API Ìò∏Ï∂ú ÏãúÎèÑ
                const url = `http://swopenAPI.seoul.go.kr/api/subway/${API_KEYS.subway}/json/realtimeStationArrival/0/10/${encodeURIComponent(stationName)}`;
                
                const response = await fetch(url, { method: 'GET', mode: 'cors' });
                
                if (!response.ok) {
                    throw new Error(`API ÏùëÎãµ Ïò§Î•ò: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.errorMessage) {
                    throw new Error(data.errorMessage.message || 'API Ïò§Î•ò');
                }
                
                const arrivals = data.realtimeArrivalList || [];
                
                return arrivals.map(arrival => ({
                    type: 'subway',
                    station: stationName,
                    line: arrival.subwayId || arrival.trainLineNm,
                    direction: arrival.updnLine,
                    destination: arrival.bstatnNm,
                    arrivalMessage: arrival.arvlMsg2 || arrival.arvlMsg3,
                    arrivalCode: arrival.arvlCd,
                    currentStation: arrival.arvlMsg3,
                    timestamp: arrival.recptnDt
                }));
                
            } catch (error) {
                console.error(`${stationName} ÏßÄÌïòÏ≤† Ï†ïÎ≥¥ Ï°∞Ìöå Ïã§Ìå®:`, error);
                // ÍµêÏú°Ïö© Î™®Ïùò Îç∞Ïù¥ÌÑ∞ Î∞òÌôò
                return generateEnhancedSubwayData(stationName, stationLines);
            }
        }

        function generateEnhancedSubwayData(stationName, stationLines) {
            // ÏãúÍ∞Ñ Í∏∞Î∞ò Ìñ•ÏÉÅÎêú ÏßÄÌïòÏ≤† Î™®Ïùò Îç∞Ïù¥ÌÑ∞
            const hour = new Date().getHours();
            let probability = 0.9; // ÎÜíÏùÄ ÌôïÎ•†Î°ú Ïó¥Ï∞® Ï°¥Ïû¨
            
            if (hour >= 6 && hour <= 9) probability = 0.95;
            if (hour >= 17 && hour <= 20) probability = 0.95;
            if (hour >= 23 || hour <= 5) probability = 0.7;
            
            if (Math.random() > probability) return [];
            
            const trains = [];
            const numTrains = Math.floor(Math.random() * 3) + 2; // 2-4ÎåÄ
            
            const arrivalPatterns = [
                { message: 'Í≥ß ÎèÑÏ∞©', weight: 0.1 },
                { message: 'ÏßÑÏûÖ Ï§ë', weight: 0.05 },
                { message: '1Î∂Ñ ÌõÑ ÎèÑÏ∞©', weight: 0.15 },
                { message: '2Î∂Ñ ÌõÑ ÎèÑÏ∞©', weight: 0.2 },
                { message: '3Î∂Ñ ÌõÑ ÎèÑÏ∞©', weight: 0.2 },
                { message: '4Î∂Ñ ÌõÑ ÎèÑÏ∞©', weight: 0.15 },
                { message: '5Î∂Ñ ÌõÑ ÎèÑÏ∞©', weight: 0.1 },
                { message: '7Î∂Ñ ÌõÑ ÎèÑÏ∞©', weight: 0.05 }
            ];
            
            for (let i = 0; i < numTrains; i++) {
                const line = stationLines[Math.floor(Math.random() * stationLines.length)];
                const pattern = selectWeightedRandom(arrivalPatterns);
                
                trains.push({
                    type: 'subway',
                    station: stationName,
                    line: line,
                    direction: Math.random() > 0.5 ? 'ÏÉÅÌñâ' : 'ÌïòÌñâ',
                    destination: getRandomDestination(line),
                    arrivalMessage: pattern.message,
                    arrivalCode: pattern.message.includes('Í≥ß') || pattern.message.includes('ÏßÑÏûÖ') ? '0' : '1',
                    timestamp: new Date().toISOString()
                });
            }
            
            return trains;
        }

        function selectWeightedRandom(items) {
            const total = items.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * total;
            
            for (const item of items) {
                random -= item.weight;
                if (random <= 0) return item;
            }
            
            return items[items.length - 1];
        }

        function getRandomDestination(line) {
            const destinations = {
                '1Ìò∏ÏÑ†': ['Ïù∏Ï≤ú', 'Ïã†ÎèÑÎ¶º', 'ÏÑúÏö∏Ïó≠', 'ÎèôÎ¨òÏïû', 'Ï≤≠ÎüâÎ¶¨'],
                '2Ìò∏ÏÑ†': ['Ïû†Ïã§', 'Í∞ïÎÇ®', 'ÌôçÎåÄÏûÖÍµ¨', 'Ïã†ÎèÑÎ¶º', 'ÏÑ±Ïàò'],
                '3Ìò∏ÏÑ†': ['ÎåÄÌôî', 'Ïò§Í∏à'],
                '4Ìò∏ÏÑ†': ['ÎãπÍ≥†Í∞ú', 'ÏÇ¨Îãπ'],
                '5Ìò∏ÏÑ†': ['Î∞©Ìôî', 'ÎßàÏ≤ú', 'ÏÉÅÏùºÎèô'],
                '6Ìò∏ÏÑ†': ['ÏùëÏïî', 'Î¥âÌôîÏÇ∞'],
                '7Ìò∏ÏÑ†': ['Ïû•Ïïî', 'Î∂ÄÌèâÍµ¨Ï≤≠'],
                '8Ìò∏ÏÑ†': ['ÏïîÏÇ¨', 'Î™®ÎûÄ'],
                '9Ìò∏ÏÑ†': ['Í∞úÌôî', 'Ï§ëÏïôÎ≥¥ÌõàÎ≥ëÏõê']
            };
            
            const dests = destinations[line] || ['ÌÑ∞ÎØ∏ÎÑê'];
            return dests[Math.floor(Math.random() * dests.length)];
        }

        async function generateKorailData(stationName, stationLines, position) {
            // ÏΩîÎ†àÏùº ÎÖ∏ÏÑ†Ïù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
            const korailLines = stationLines.filter(line => 
                line.includes('KTX') || line.includes('ÏÉàÎßàÏùÑ') || line.includes('Î¨¥Í∂ÅÌôî') || 
                line.includes('ITX') || line === 'ÏΩîÎ†àÏùº'
            );
            
            if (korailLines.length === 0) return [];
            
            const hour = new Date().getHours();
            let probability = 0.6;
            
            if (hour >= 6 && hour <= 9) probability = 0.8;
            if (hour >= 17 && hour <= 20) probability = 0.8;
            if (hour >= 22 || hour <= 5) probability = 0.4;
            
            if (Math.random() > probability) return [];
            
            const trains = [];
            const numTrains = Math.floor(Math.random() * 2) + 1; // 1-2ÎåÄ
            
            for (let i = 0; i < numTrains; i++) {
                const trainLine = korailLines[Math.floor(Math.random() * korailLines.length)];
                const minutesUntil = Math.floor(Math.random() * 45) + 5; // 5-50Î∂Ñ
                
                trains.push({
                    type: 'korail',
                    station: stationName,
                    line: trainLine,
                    trainNo: generateTrainNumber(trainLine),
                    direction: Math.random() > 0.5 ? 'ÏÉÅÌñâ' : 'ÌïòÌñâ',
                    destination: getKorailDestination(trainLine),
                    arrivalMessage: `${minutesUntil}Î∂Ñ ÌõÑ ÌÜµÍ≥º`,
                    arrivalCode: minutesUntil <= 10 ? '0' : '1',
                    departureStation: getRandomDepartureStation(),
                    timestamp: new Date().toISOString()
                });
            }
            
            return trains;
        }

        function generateTrainNumber(trainType) {
            const prefixes = {
                'KTX': '1',
                'ÏÉàÎßàÏùÑÌò∏': '3',
                'Î¨¥Í∂ÅÌôîÌò∏': '8',
                'ITX-Ï≤≠Ï∂ò': '2'
            };
            
            const prefix = prefixes[trainType] || '8';
            const number = Math.floor(Math.random() * 999).toString().padStart(3, '0');
            return prefix + number;
        }

        function getKorailDestination(trainType) {
            const destinations = {
                'KTX': ['Î∂ÄÏÇ∞', 'ÎåÄÍµ¨ÎèôÎåÄÍµ¨', 'Í¥ëÏ£ºÏÜ°Ï†ï', 'Î™©Ìè¨', 'Í∞ïÎ¶â', 'Ïó¨ÏàòEXPO'],
                'ÏÉàÎßàÏùÑÌò∏': ['Î∂ÄÏÇ∞', 'ÎåÄÏ†Ñ', 'ÎåÄÍµ¨', 'Í¥ëÏ£º', 'Î™©Ìè¨', 'Ïó¨Ïàò', 'Ìè¨Ìï≠'],
                'Î¨¥Í∂ÅÌôîÌò∏': ['Î∂ÄÏÇ∞', 'ÎåÄÏ†Ñ', 'ÎåÄÍµ¨', 'Í¥ëÏ£º', 'Î™©Ìè¨', 'Ïó¨Ïàò', 'Ìè¨Ìï≠', 'Ï∂òÏ≤ú', 'Í∞ïÎ¶â', 'Ï†úÏ≤ú', 'ÏïàÎèô'],
                'ITX-Ï≤≠Ï∂ò': ['Ï∂òÏ≤ú', 'Í∞ïÎ¶â', 'ÎÇ®Ï∂òÏ≤ú'],
                'ITX-ÏÉàÎßàÏùÑ': ['Î∂ÄÏÇ∞', 'ÎåÄÏ†Ñ', 'ÎèôÎåÄÍµ¨']
            };
            
            // Ï†ïÌôïÌïú Ïó¥Ï∞® ÌÉÄÏûÖ Ï∞æÍ∏∞
            for (const [type, dests] of Object.entries(destinations)) {
                if (trainType.includes(type) || trainType === type) {
                    return dests[Math.floor(Math.random() * dests.length)];
                }
            }
            
            // Í∏∞Î≥∏Í∞í
            return ['Î∂ÄÏÇ∞', 'ÎåÄÏ†Ñ', 'ÎåÄÍµ¨', 'Í¥ëÏ£º'][Math.floor(Math.random() * 4)];
        }

        function getRandomDepartureStation() {
            const stations = ['ÏÑúÏö∏', 'ÎåÄÏ†Ñ', 'ÎåÄÍµ¨', 'Î∂ÄÏÇ∞', 'Í¥ëÏ£º', 'Ïö©ÏÇ∞', 'Ï≤≠ÎüâÎ¶¨', 'ÏàòÏõê'];
            return stations[Math.floor(Math.random() * stations.length)];
        }

        function displayPredictions(predictions, isManualMode) {
            const prefix = isManualMode ? 'manual-' : '';
            const countdownElement = document.getElementById(prefix + 'countdown-display');
            const predictionsList = document.getElementById(prefix + 'predictions-list');
            
            if (predictions.length === 0) {
                countdownElement.textContent = 'ÏïàÏ†Ñ Íµ¨Í∞Ñ';
                countdownElement.className = 'countdown-display countdown-safe';
                predictionsList.innerHTML = '<div style="text-align: center; color: #666;">Í∑ºÏ≤òÏóê Ï†ëÍ∑ºÌïòÎäî Ïó¥Ï∞®Í∞Ä ÏóÜÏäµÎãàÎã§</div>';
                return;
            }
            
            // Í∞ÄÏû• Îπ†Î•∏ Ïó¥Ï∞®Ïùò Ïπ¥Ïö¥Ìä∏Îã§Ïö¥ ÌëúÏãú
            const closestTrain = predictions[0];
            const countdownText = `${Math.floor(closestTrain.timeToPass / 60)}:${(closestTrain.timeToPass % 60).toString().padStart(2, '0')}`;
            
            countdownElement.textContent = `${countdownText} - ${closestTrain.train.line}`;
            
            if (closestTrain.timeToPass <= 60) {
                countdownElement.className = 'countdown-display countdown-danger';
            } else if (closestTrain.timeToPass <= 120) {
                countdownElement.className = 'countdown-display countdown-warning';
            } else {
                countdownElement.className = 'countdown-display countdown-safe';
            }
            
            // ÏòàÏ∏° Î™©Î°ù ÌëúÏãú
            predictionsList.innerHTML = '';
            predictions.slice(0, 5).forEach(prediction => {
                const predictionDiv = document.createElement('div');
                predictionDiv.className = 'prediction-item';
                
                if (prediction.timeToPass <= 60) {
                    predictionDiv.className += ' imminent';
                } else if (prediction.timeToPass <= 120) {
                    predictionDiv.className += ' warning';
                }
                
                const minutes = Math.floor(prediction.timeToPass / 60);
                const seconds = prediction.timeToPass % 60;
                const timeDisplay = minutes > 0 ? `${minutes}Î∂Ñ ${seconds}Ï¥à` : `${seconds}Ï¥à`;
                
                const typeIcon = prediction.train.type === 'subway' ? 'üöá' : 'üöÑ';
                
                predictionDiv.innerHTML = `
                    <div style="font-weight: bold;">${typeIcon} ${prediction.train.line} - ${prediction.station.name}</div>
                    <div style="margin-top: 5px; color: #666;">
                        ÌÜµÍ≥º ÏòàÏÉÅ: ${timeDisplay} ÌõÑ<br>
                        ÌòÑÏû¨ ÏúÑÏπò: ${prediction.estimatedLocation}<br>
                        Ïã†Î¢∞ÎèÑ: ${prediction.confidence}% | GPS Í±∞Î¶¨: ${prediction.gpsDistance}m
                    </div>
                `;
                
                predictionsList.appendChild(predictionDiv);
            });
        }

        function showPredictionWarning(imminentTrains, isManualMode) {
            const warningElement = isManualMode ? 
                document.getElementById('manual-warning') : 
                document.getElementById('gps-warning');
            
            const urgentTrain = imminentTrains[0];
            const timeLeft = urgentTrain.timeToPass;
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeDisplay = minutes > 0 ? `${minutes}Î∂Ñ ${seconds}Ï¥à` : `${seconds}Ï¥à`;
            
            const typeIcon = urgentTrain.train.type === 'subway' ? 'üöá' : 'üöÑ';
            
            const warningDuration = currentWarningState.warningStartTime ? 
                Math.floor((new Date() - currentWarningState.warningStartTime) / 1000) : 0;
            
            warningElement.innerHTML = `
                <div class="warning-header">
                    <span>‚ö†Ô∏è Ïó¥Ï∞® Ï†ëÍ∑º Í≤ΩÍ≥†!</span>
                    <span class="warning-time">Í≤ΩÍ≥† ${warningDuration}Ï¥à</span>
                </div>
                <div>${typeIcon} ${urgentTrain.train.line} - ${urgentTrain.station.name}</div>
                <div style="font-size: 18px; font-weight: bold; margin-top: 8px; color: #d32f2f;">
                    ${timeDisplay} ÌõÑ ÌÜµÍ≥º ÏòàÏÉÅ
                </div>
                <div style="font-size: 12px; margin-top: 5px; opacity: 0.8;">
                    ÌòÑÏû¨ ÏúÑÏπò: ${urgentTrain.estimatedLocation} (Ïã†Î¢∞ÎèÑ: ${urgentTrain.confidence}%)
                </div>
            `;
            
            warningElement.classList.add('show');
            
            // ÏÉÅÌÉú ÌëúÏãúÍ∏∞ ÏóÖÎç∞Ïù¥Ìä∏
            const indicator = isManualMode ? 
                document.getElementById('manual-status-indicator') : 
                document.getElementById('gps-status-indicator');
            
            indicator.className = 'status-indicator status-danger';
            indicator.textContent = '‚ö†Ô∏è';
        }

        function hideWarning() {
            document.getElementById('gps-warning').classList.remove('show');
            document.getElementById('manual-warning').classList.remove('show');
            
            // ÏÉÅÌÉú ÌëúÏãúÍ∏∞ ÏóÖÎç∞Ïù¥Ìä∏
            const indicators = [
                document.getElementById('gps-status-indicator'),
                document.getElementById('manual-status-indicator')
            ];
            
            indicators.forEach(indicator => {
                indicator.className = 'status-indicator status-safe';
                indicator.textContent = 'üìç';
            });
        }

        function displayTrainInfo(trainData) {
            const trainList = document.getElementById('train-list');
            const trainItems = document.getElementById('train-items');
            
            if (trainData.length === 0) {
                trainList.style.display = 'none';
                return;
            }
            
            trainItems.innerHTML = '';
            
            trainData.sort((a, b) => {
                if (a.arrivalCode === '0' && b.arrivalCode !== '0') return -1;
                if (b.arrivalCode === '0' && a.arrivalCode !== '0') return 1;
                return 0;
            });
            
            trainData.forEach(train => {
                const trainDiv = document.createElement('div');
                trainDiv.className = `train-item ${train.type}`;
                
                let statusColor = '#4caf50';
                let typeIcon = train.type === 'subway' ? 'üöá' : 'üöÑ';
                
                if (train.arrivalCode === '0' || 
                    train.arrivalMessage?.includes('ÏßÑÏûÖ') || 
                    train.arrivalMessage?.includes('Í≥ß')) {
                    statusColor = '#f44336';
                    trainDiv.className += ' urgent';
                } else if (train.arrivalMessage?.includes('1Î∂Ñ') || 
                           train.arrivalMessage?.includes('2Î∂Ñ')) {
                    statusColor = '#ff9800';
                    trainDiv.className += ' warning';
                }
                
                trainDiv.style.borderLeftColor = statusColor;
                
                trainDiv.innerHTML = `
                    <div class="train-line">${typeIcon} ${train.line} - ${train.station}</div>
                    <div class="train-info">
                        ${train.direction || ''} | ${train.destination || 'Î™©Ï†ÅÏßÄ'} Î∞©Î©¥<br>
                        <span style="color:${statusColor};font-weight:bold;">${train.arrivalMessage}</span>
                        ${train.trainNo ? `<br><small>Ïó¥Ï∞®Î≤àÌò∏: ${train.trainNo}</small>` : ''}
                    </div>
                `;
                trainItems.appendChild(trainDiv);
            });
            
            trainList.style.display = 'block';
        }

        function triggerAlarm() {
            // ÏßÑÎèô (Î™®Î∞îÏùºÏóêÏÑúÎßå ÏûëÎèô)
            if (navigator.vibrate) {
                navigator.vibrate([500, 200, 500, 200, 500]);
            }
            
            // ÏïåÎûåÏùå Ïû¨ÏÉù - 3Ï¥àÎßå Ïû¨ÏÉù
            if (alarmSound) {
                alarmSound.play().catch(e => console.log('ÏïåÎûåÏùå Ïû¨ÏÉù Ïã§Ìå®:', e));
                
                setTimeout(() => {
                    if (alarmSound && !alarmSound.paused) {
                        alarmSound.pause();
                        alarmSound.currentTime = 0;
                    }
                }, 3000);
            }
        }

        function stopAlarm() {
            if (alarmSound) {
                alarmSound.pause();
                alarmSound.currentTime = 0;
            }
        }

        function updateMonitoringInfo(stationCount, isManualMode, predictionsCount) {
            const prefix = isManualMode ? 'manual-' : '';
            
            document.getElementById(prefix + 'last-update').textContent = new Date().toLocaleTimeString();
            document.getElementById(prefix + 'active-predictions').textContent = `${predictionsCount}Í∞ú`;
            
            const warningStatusElement = document.getElementById(prefix + 'warning-status');
            if (currentWarningState.isActive) {
                const duration = Math.floor((new Date() - currentWarningState.warningStartTime) / 1000);
                warningStatusElement.textContent = `üö® Í≤ΩÍ≥† Ï§ë (${duration}Ï¥à)`;
                warningStatusElement.style.color = '#f44336';
                warningStatusElement.style.fontWeight = 'bold';
            } else {
                warningStatusElement.textContent = '‚úÖ ÏïàÏ†Ñ';
                warningStatusElement.style.color = '#4caf50';
                warningStatusElement.style.fontWeight = 'normal';
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-display');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Îëê ÏßÄÏ†ê Í∞ÑÏùò Í±∞Î¶¨ Í≥ÑÏÇ∞ (ÎØ∏ÌÑ∞ Îã®ÏúÑ)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // Earth's radius in meters
            const œÜ1 = lat1 * Math.PI/180;
            const œÜ2 = lat2 * Math.PI/180;
            const ŒîœÜ = (lat2-lat1) * Math.PI/180;
            const ŒîŒª = (lng2-lng1) * Math.PI/180;

            const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) +
                      Math.cos(œÜ1) * Math.cos(œÜ2) *
                      Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c;
        }

        // PWA ÏßÄÏõêÏùÑ ÏúÑÌïú ÏÑúÎπÑÏä§ ÏõåÏª§ Îì±Î°ù
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // ÌïÑÏöîÏãú ÏÑúÎπÑÏä§ ÏõåÏª§ Íµ¨ÌòÑ
            });
        }
    </script>
</body>
</html>
